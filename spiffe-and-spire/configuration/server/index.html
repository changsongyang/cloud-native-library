<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
    
    
    
  
  

  <meta name="author" content="宋净超" />

  
  
  
    
  
  <meta name="description" content="本文描述了 SPIRE Server 的命令行选项、server.conf 设置和内置插件。 本文档是 SPIRE Server 的配置参考。它包括有关插件类型、内置插件、服务器配置文件、插件配置和 spire-server 命令的命令行选项的信息。 插件类型 类型 描述 DataStore 提供持久存" />

  
  <link rel="alternate" hreflang="zh" href="https://lib.jimmysong.io/spiffe-and-spire/configuration/server/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.b26eb9b802629dccab300faa82cc98c7.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-MP490FS739"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-MP490FS739");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a4b7f65b1839466beaa48d633aa60c1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://lib.jimmysong.io/spiffe-and-spire/configuration/server/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@jimmysongio" />
    <meta property="twitter:creator" content="@jimmysongio" />
  
  <meta property="og:site_name" content="云原生资料库" />
  <meta property="og:url" content="https://lib.jimmysong.io/spiffe-and-spire/configuration/server/" />
  <meta property="og:title" content="SPIRE Server 配置参考 | 云原生资料库" />
  <meta property="og:description" content="本文描述了 SPIRE Server 的命令行选项、server.conf 设置和内置插件。 本文档是 SPIRE Server 的配置参考。它包括有关插件类型、内置插件、服务器配置文件、插件配置和 spire-server 命令的命令行选项的信息。 插件类型 类型 描述 DataStore 提供持久存" /><meta property="og:image" content="https://lib.jimmysong.io/media/sharing.png" />
    <meta property="twitter:image" content="https://lib.jimmysong.io/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2023-10-23T00:00:00&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2023-11-29T18:56:41&#43;08:00">
  

  



  

  

  





  <title>SPIRE Server 配置参考 | 云原生资料库</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="f0b5c1cc13627d972abdd5417a3443de" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#books"><span>图书</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>教程</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/kubernetes-handbook"><span>Kubernetes 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/istio-fundamentals-zh"><span>Istio 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh"><span>Envoy 基础教程</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://jimmysong.io/blog/" target="_blank" rel="noopener"><span>原创</span></a>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/blog"><span>译文</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#feed"><span>更新</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://jimmysong.io" target="_blank" rel="noopener"><span>Jimmy Song</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://jimmysong.io/contact/" data-toggle="tooltip" data-placement="bottom" title="联系" target="_blank" rel="noopener" aria-label="联系">
                <i class="fab fa-weixin" aria-hidden="true"></i>
              </a>
            </li>
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/jimmysongio" data-toggle="tooltip" data-placement="bottom" title="关注" target="_blank" rel="noopener" aria-label="关注">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        <li class="nav-item">
            <a class="nav-link" href="https://jimmysong.io" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="首页" aria-label="首页"><i class="fas fa-home" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="https://github.com/rootsongjc/cloud-native-library/" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="查看源码" aria-label="查看源码" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          配置
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      



  
    
    
    
    
      
    
    

    
      <ul class="nav docs-sidenav">
          <li class="level1 "><a href="/spiffe-and-spire/"><i class="fas fa-book pr-1"></i>SPIFFE 和 SPIRE</a></li>
    
      



  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id0dd3a073bbd11379ac38f7f6c5dacaf6&#34;)" href="#id0dd3a073bbd11379ac38f7f6c5dacaf6" aria-expanded="false" aria-controls="id0dd3a073bbd11379ac38f7f6c5dacaf6" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/spiffe-and-spire/concept/">概念</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id0dd3a073bbd11379ac38f7f6c5dacaf6" aria-expanded="false" aria-controls="id0dd3a073bbd11379ac38f7f6c5dacaf6">
    
        <i class="fa-solid fa-angle-right" id="caret-id0dd3a073bbd11379ac38f7f6c5dacaf6"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id0dd3a073bbd11379ac38f7f6c5dacaf6">
      



  <li class="child level1 "><a href="/spiffe-and-spire/concept/spiffe/">SPIFFE</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/concept/spire/">SPIRE</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id08d74eab9959f912121923239e826d00&#34;)" href="#id08d74eab9959f912121923239e826d00" aria-expanded="false" aria-controls="id08d74eab9959f912121923239e826d00" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/spiffe-and-spire/standard/">规范</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id08d74eab9959f912121923239e826d00" aria-expanded="false" aria-controls="id08d74eab9959f912121923239e826d00">
    
        <i class="fa-solid fa-angle-right" id="caret-id08d74eab9959f912121923239e826d00"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id08d74eab9959f912121923239e826d00">
      



  <li class="child level1 "><a href="/spiffe-and-spire/standard/spiffe-id/">SPIFFE ID 和 SVID</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/standard/x509-svid/">X.509 SVID</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/standard/jwt-svid/">JWT SVID</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/standard/spiffe-workload-api/">SPIFFE 工作负载 API</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/standard/spiffe-workload-endpoint/">SPIFFE 工作负载端点</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/standard/spiffe-trust-domain-and-bundle/">SPIFFE 信任域和 Bundle</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/standard/spiffe-federation/">SPIFFE 联邦</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id2063c5244f912b650aeb3dfcd7deb2ff&#34;)" href="#id2063c5244f912b650aeb3dfcd7deb2ff" aria-expanded="false" aria-controls="id2063c5244f912b650aeb3dfcd7deb2ff" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/spiffe-and-spire/architecture/">架构</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id2063c5244f912b650aeb3dfcd7deb2ff" aria-expanded="false" aria-controls="id2063c5244f912b650aeb3dfcd7deb2ff">
    
        <i class="fa-solid fa-angle-right" id="caret-id2063c5244f912b650aeb3dfcd7deb2ff"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id2063c5244f912b650aeb3dfcd7deb2ff">
      



  <li class="child level1 "><a href="/spiffe-and-spire/architecture/scaling-spire/">扩展 SPIRE 部署</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/architecture/nested/">SPIRE 嵌套架构</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/architecture/federation/">SPIRE 联邦架构</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id42aa4c02696846e806f7376ae72936ee&#34;)" href="#id42aa4c02696846e806f7376ae72936ee" aria-expanded="false" aria-controls="id42aa4c02696846e806f7376ae72936ee" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/spiffe-and-spire/installation/">安装</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id42aa4c02696846e806f7376ae72936ee" aria-expanded="false" aria-controls="id42aa4c02696846e806f7376ae72936ee">
    
        <i class="fa-solid fa-angle-right" id="caret-id42aa4c02696846e806f7376ae72936ee"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id42aa4c02696846e806f7376ae72936ee">
      



  <li class="child level1 "><a href="/spiffe-and-spire/installation/getting-spire/">获取 SPIRE</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/installation/install-server/">安装 SPIRE 服务器</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/installation/install-agent/">安装 SPIRE 代理</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id7bc7dc92b3d5d644c76b9ba50ae55659&#34;)" href="#id7bc7dc92b3d5d644c76b9ba50ae55659" aria-expanded="false" aria-controls="id7bc7dc92b3d5d644c76b9ba50ae55659" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/spiffe-and-spire/configuration/">配置</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id7bc7dc92b3d5d644c76b9ba50ae55659" aria-expanded="false" aria-controls="id7bc7dc92b3d5d644c76b9ba50ae55659">
    
    <i class="fa-solid fa-angle-down" id="caret-id7bc7dc92b3d5d644c76b9ba50ae55659"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  show " id="id7bc7dc92b3d5d644c76b9ba50ae55659">
      



  <li class="child level1 "><a href="/spiffe-and-spire/configuration/configuring/">配置 SPIRE</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/configuration/registering/">注册工作负载</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/configuration/svids/">使用 SVID</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/configuration/agent/">SPIRE Agent</a></li>




  <li class="child level1 active"><a href="/spiffe-and-spire/configuration/server/">SPIRE Server</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id083a3548f3d319b55684a0a387f78a06&#34;)" href="#id083a3548f3d319b55684a0a387f78a06" aria-expanded="false" aria-controls="id083a3548f3d319b55684a0a387f78a06" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/spiffe-and-spire/examples/">SPIRE 集成示例</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id083a3548f3d319b55684a0a387f78a06" aria-expanded="false" aria-controls="id083a3548f3d319b55684a0a387f78a06">
    
        <i class="fa-solid fa-angle-right" id="caret-id083a3548f3d319b55684a0a387f78a06"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id083a3548f3d319b55684a0a387f78a06">
      



  <li class="child level1 "><a href="/spiffe-and-spire/examples/envoy/">Envoy</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/examples/envoy-x509/">Envoy &#43; X.509</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/examples/envoy-jwt/">Envoy &#43; JWT-SVID</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/examples/envoy-opa/">使用 Envoy 和 X.509-SVID 进行 OPA 授权</a></li>




  <li class="child level1 "><a href="/spiffe-and-spire/examples/envoy-jwt-opa/">使用 Envoy 和 JWT-SVIDs 进行 OPA 授权</a></li>

      
        </ul>
      
    

    
      </div>
    

      
    

    
      </ul>
    

  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">目录</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#插件类型">插件类型</a></li>
    <li><a href="#内置插件">内置插件</a></li>
    <li><a href="#服务器配置文件">服务器配置文件</a>
      <ul>
        <li><a href="#分析名称">分析名称</a></li>
      </ul>
    </li>
    <li><a href="#插件配置">插件配置</a></li>
    <li><a href="#联邦配置">联邦配置</a>
      <ul>
        <li><a href="#federationbundle_endpoint-的配置选项"><code>federation.bundle_endpoint</code> 的配置选项</a></li>
        <li><a href="#federationbundle_endpointprofile-的配置选项"><code>federation.bundle_endpoint.profile</code> 的配置选项</a></li>
        <li><a href="#federationbundle_endpointprofile-https_webacme-的配置选项"><code>federation.bundle_endpoint.profile &quot;https_web&quot;.acme</code> 的配置选项</a></li>
        <li><a href="#federationbundle_endpointprofile-https_spiffe-的配置选项"><code>federation.bundle_endpoint.profile &quot;https_spiffe&quot;</code> 的配置选项</a></li>
        <li><a href="#federationfederates_withtrust-domainbundle_endpoint-的配置选项"><code>federation.federates_with[&quot;&lt;trust domain&gt;&quot;].bundle_endpoint</code> 的配置选项</a></li>
      </ul>
    </li>
    <li><a href="#遥测配置">遥测配置</a></li>
    <li><a href="#健康检查配置">健康检查配置</a></li>
    <li><a href="#命令行选项">命令行选项</a>
      <ul>
        <li><a href="#spire-server-run"><code>spire-server run</code></a></li>
        <li><a href="#spire-server-token-generate"><code>spire-server token generate</code></a></li>
        <li><a href="#spire-server-entry-create"><code>spire-server entry create</code></a></li>
        <li><a href="#spire-server-entry-update"><code>spire-server entry update</code></a></li>
        <li><a href="#spire-server-entry-count"><code>spire-server entry count</code></a></li>
        <li><a href="#spire-server-entry-delete"><code>spire-server entry delete</code></a></li>
        <li><a href="#spire-server-entry-show"><code>spire-server entry show</code></a></li>
        <li><a href="#spire-server-bundle-count"><code>spire-server bundle count</code></a></li>
        <li><a href="#spire-server-bundle-show"><code>spire-server bundle show</code></a></li>
        <li><a href="#spire-server-bundle-list"><code>spire-server bundle list</code></a></li>
        <li><a href="#spire-server-bundle-set"><code>spire-server bundle set</code></a></li>
        <li><a href="#spire-server-bundle-delete"><code>spire-server bundle delete</code></a></li>
        <li><a href="#spire-server-federation-create"><code>spire-server federation create</code></a></li>
        <li><a href="#spire-server-federation-delete"><code>spire-server federation delete</code></a></li>
        <li><a href="#spire-server-federation-list"><code>spire-server federation list</code></a></li>
        <li><a href="#spire-server-federation-refresh"><code>spire-server federation refresh</code></a></li>
        <li><a href="#spire-server-federation-show"><code>spire-server federation show</code></a></li>
        <li><a href="#spire-server-federation-update"><code>spire-server federation update</code></a></li>
        <li><a href="#spire-server-agent-ban"><code>spire-server agent ban</code></a></li>
        <li><a href="#spire-server-agent-count"><code>spire-server agent count</code></a></li>
        <li><a href="#spire-server-agent-evict"><code>spire-server agent evict</code></a></li>
        <li><a href="#spire-server-agent-list"><code>spire-server agent list</code></a></li>
        <li><a href="#spire-server-agent-show"><code>spire-server agent show</code></a></li>
        <li><a href="#spire-server-healthcheck"><code>spire-server healthcheck</code></a></li>
        <li><a href="#spire-server-validate"><code>spire-server validate</code></a></li>
        <li><a href="#spire-server-x509-mint"><code>spire-server x509 mint</code></a></li>
        <li><a href="#spire-server-jwt-mint"><code>spire-server jwt mint</code></a></li>
      </ul>
    </li>
    <li><a href="#-data-的-json-对象"><code>-data</code> 的 JSON 对象</a></li>
    <li><a href="#配置文件示例">配置文件示例</a></li>
  </ul>
</nav>

      
<div class="subscribe-module col-12 mt-1">
    <img src="/img/wechat.webp" alt="image" title="Jimmy Song的微信公众号"/>
    <p class="text-center pt-1">扫码联系站长</p>
    
    
     <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4029167986768912"
     crossorigin="anonymous"></script>
     <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-4029167986768912"
       data-ad-slot="6856371908"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
    <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    
    
</div>



    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          
            
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
    
  
    
  
    
  

    <li class="breadcrumb-item">
      <a href="/">
        
          首页
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/spiffe-and-spire/">
        
          SPIFFE 和 SPIRE
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/spiffe-and-spire/configuration/">
        
          配置
        
      </a>
    </li>
  

      <li class="breadcrumb-item active" aria-current="page">
        SPIRE Server
      </li>
    </ol>
  </nav>




          

          <h1>SPIRE Server 配置参考</h1>

          <div class="article-style">
            <p>本文描述了 SPIRE Server 的命令行选项、server.conf 设置和内置插件。</p>
<p>本文档是 SPIRE Server 的配置参考。它包括有关插件类型、内置插件、服务器配置文件、插件配置和 <code>spire-server</code> 命令的命令行选项的信息。</p>
<h2 id="插件类型">插件类型</h2>
<table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataStore</td>
<td>提供持久存储和 HA 功能。注意：不再支持数据存储的可插入性。只能使用内置的 SQL 插件。</td>
</tr>
<tr>
<td>KeyManager</td>
<td>为服务器的签名操作实现签名和密钥存储逻辑。对于利用基于硬件的关键操作很有用。</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td>为尝试断言其身份的节点实现验证逻辑。一般与同类型的代理插件搭配使用。</td>
</tr>
<tr>
<td>UpstreamAuthority</td>
<td>允许 SPIRE 服务器与现有 PKI 系统集成。</td>
</tr>
<tr>
<td>Notifier</td>
<td>由 SPIRE 服务器通知正在发生或已经发生的某些事件。对于正在发生的事件，通知者可以将结果告知 SPIRE 服务器。</td>
</tr>
</tbody>
</table>
<h2 id="内置插件">内置插件</h2>
<table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataStore</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_datastore_sql.md" target="_blank" rel="noopener">sql</a></td>
<td>用于 SPIRE 数据存储的 SQLite、PostgreSQL 和 MySQL 数据库的 SQL 数据库存储</td>
</tr>
<tr>
<td>KeyManager</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_keymanager_aws_kms.md" target="_blank" rel="noopener">aws_kms</a></td>
<td>管理 AWS KMS 中密钥的密钥管理器</td>
</tr>
<tr>
<td>KeyManager</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_keymanager_disk.md" target="_blank" rel="noopener">disk</a></td>
<td>管理保存在磁盘上的密钥的密钥管理器</td>
</tr>
<tr>
<td>KeyManager</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_keymanager_memory.md" target="_blank" rel="noopener">memory</a></td>
<td>管理内存中非持久密钥的密钥管理器</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_nodeattestor_aws_iid.md" target="_blank" rel="noopener">aws_iid</a></td>
<td>使用 AWS 实例身份文档证明代理身份的节点证明者</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_nodeattestor_azure_msi.md" target="_blank" rel="noopener">azure_msi</a></td>
<td>使用 Azure MSI 令牌证明代理身份的节点证明者</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_nodeattestor_gcp_iit.md" target="_blank" rel="noopener">gcp_iit</a></td>
<td>使用 GCP 实例身份令牌证明代理身份的节点证明者</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_nodeattestor_jointoken.md" target="_blank" rel="noopener">join_token</a></td>
<td>节点证明器，用于验证使用服务器生成的加入令牌进行证明的代理</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_nodeattestor_k8s_sat.md" target="_blank" rel="noopener">k8s_sat</a></td>
<td>使用 Kubernetes 服务帐户令牌证明代理身份的节点证明者</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_nodeattestor_k8s_psat.md" target="_blank" rel="noopener">k8s_psat</a></td>
<td>使用 Kubernetes 投影服务帐户令牌证明代理身份的节点证明者</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_nodeattestor_sshpop.md" target="_blank" rel="noopener">sshpop</a></td>
<td>使用现有 ssh 证书证明代理身份的节点证明者</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_nodeattestor_tpm_devid.md" target="_blank" rel="noopener">tpm_devid</a></td>
<td>节点证明者，使用已配置 DevID 证书的 TPM 证明代理身份</td>
</tr>
<tr>
<td>NodeAttestor</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_nodeattestor_x509pop.md" target="_blank" rel="noopener">x509pop</a></td>
<td>使用现有 X.509 证书证明代理身份的节点证明者</td>
</tr>
<tr>
<td>Notifier</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_notifier_gcs_bundle.md" target="_blank" rel="noopener">gcs_bundle</a></td>
<td>将最新信任包内容推送到 Google Cloud Storage 中的对象的通知程序。</td>
</tr>
<tr>
<td>Notifier</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_notifier_k8sbundle.md" target="_blank" rel="noopener">k8sbundle</a></td>
<td>将最新信任包内容推送到 Kubernetes ConfigMap 的通知程序。</td>
</tr>
<tr>
<td>UpstreamAuthority</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_upstreamauthority_disk.md" target="_blank" rel="noopener">disk</a></td>
<td>使用从磁盘加载的 CA 来签署 SPIRE 服务器中间证书。</td>
</tr>
<tr>
<td>UpstreamAuthority</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_upstreamauthority_aws_pca.md" target="_blank" rel="noopener">aws_pca</a></td>
<td>使用 AWS Certificate Manager 中的私有证书颁发机构来签署 SPIRE 服务器中间证书。</td>
</tr>
<tr>
<td>UpstreamAuthority</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_upstreamauthority_awssecret.md" target="_blank" rel="noopener">awssecret</a></td>
<td>使用从 AWS SecretsManager 加载的 CA 来签署 SPIRE 服务器中间证书。</td>
</tr>
<tr>
<td>UpstreamAuthority</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_upstreamauthority_gcp_cas.md" target="_blank" rel="noopener">gcp_cas</a></td>
<td>使用 GCP 证书颁发机构服务中的私有证书颁发机构来签署 SPIRE 服务器中间证书。</td>
</tr>
<tr>
<td>UpstreamAuthority</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_upstreamauthority_vault.md" target="_blank" rel="noopener">vault</a></td>
<td>使用 HashiCorp Vault 中的 PKI 秘密引擎来签署 SPIRE 服务器中间证书。</td>
</tr>
<tr>
<td>UpstreamAuthority</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_upstreamauthority_spire.md" target="_blank" rel="noopener">spire</a></td>
<td>使用同一信任域中的上游 SPIRE 服务器来获取 SPIRE 服务器的中间签名证书。</td>
</tr>
<tr>
<td>UpstreamAuthority</td>
<td><a href="https://github.com/spiffe/spire/blob/v1.8.2/doc/plugin_server_upstreamauthority_cert_manager.md" target="_blank" rel="noopener">cert-manager</a></td>
<td>使用引用的证书管理器颁发者来请求中间签名证书。</td>
</tr>
</tbody>
</table>
<h2 id="服务器配置文件">服务器配置文件</h2>
<p>下表概述了 SPIRE 服务器的配置选项。这些可以在配置文件的顶级 <code>server { ... }</code> 部分中设置。大多数选项都有一个相应的 CLI 标志，如果设置了该标志，则该标志优先于文件中定义的值。</p>
<p>SPIRE 配置文件可以用 HCL 或 JSON 表示。请参阅示例配置文件部分以获取完整示例。</p>
<p>如果 -expandEnv 标志传递给 SPIRE，则在解析之前扩展 <code>$VARIABLE</code> 或 <code>${VARIABLE}</code> 样式环境变量。这对于模板化配置文件（例如跨不同信任域）或插入数据库连接密码等机密可能很有用。</p>
<table>
<thead>
<tr>
<th>配置</th>
<th>描述</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>admin_ids</code></td>
<td>SPIFFE ID，当出现在呼叫者的 X509-SVID 中时，会授予该呼叫者管理员权限。管理 ID 必须驻留在服务器信任域或联合域中，并且不需要在服务器上有相应的管理注册条目。</td>
<td></td>
</tr>
<tr>
<td><code>agent_ttl</code></td>
<td>用于代理 SVID 的 TTL</td>
<td><code>default_x509_svid_ttl</code> 的值</td>
</tr>
<tr>
<td><code>audit_log_enabled</code></td>
<td>如果为 true，则启用审核日志记录</td>
<td>错误的</td>
</tr>
<tr>
<td><code>bind_address</code></td>
<td>SPIRE 服务器的 IP 地址或 DNS 名称</td>
<td>0.0.0.0</td>
</tr>
<tr>
<td><code>bind_port</code></td>
<td>SPIRE 服务器的 HTTP 端口号</td>
<td>8081</td>
</tr>
<tr>
<td><code>ca_key_type</code></td>
<td>用于服务器 CA 的密钥类型（X509 和 JWT），<code>&lt;rsa-2048|rsa-4096|ec-p256|ec-p384&gt;</code></td>
<td>ec-p256（JWT 密钥类型可以被 <code>jwt_key_type</code> 覆盖）</td>
</tr>
<tr>
<td><code>ca_subject</code></td>
<td>CA 证书应使用的主题（见下文）</td>
<td></td>
</tr>
<tr>
<td><code>ca_ttl</code></td>
<td>默认 CA/签名密钥 TTL</td>
<td>24h</td>
</tr>
<tr>
<td><code>data_dir</code></td>
<td>服务器运行时可以使用的目录</td>
<td></td>
</tr>
<tr>
<td><code>default_x509_svid_ttl</code></td>
<td>默认 X509-SVID TTL</td>
<td>1h</td>
</tr>
<tr>
<td><code>default_jwt_svid_ttl</code></td>
<td>默认 JWT-SVID TTL</td>
<td>5m</td>
</tr>
<tr>
<td><code>experimental</code></td>
<td>可能会更改或删除的实验选项（见下文）</td>
<td></td>
</tr>
<tr>
<td><code>federation</code></td>
<td>用于联合的捆绑端点配置部分</td>
<td></td>
</tr>
<tr>
<td><code>jwt_key_type</code></td>
<td>用于服务器 CA (JWT) 的密钥类型，</td>
<td>如果未定义，则为 <code>ca_key_type</code> 或 ec-p256 的值</td>
</tr>
<tr>
<td><code>jwt_issuer</code></td>
<td>发行 JWT-SVID 时使用的发行者声明</td>
<td></td>
</tr>
<tr>
<td><code>log_file</code></td>
<td>将日志写入的文件</td>
<td></td>
</tr>
<tr>
<td><code>log_level</code></td>
<td>设置日志记录级别</td>
<td>信息</td>
</tr>
<tr>
<td><code>log_format</code></td>
<td>日志格式，text 或 json</td>
<td>文本</td>
</tr>
<tr>
<td><code>log_source_location</code></td>
<td>如果为 true，日志将包含源文件、行号和方法名称字段（增加一点运行时成本）</td>
<td>错误的</td>
</tr>
<tr>
<td><code>profiling_enabled</code></td>
<td>如果为 true，则启用 net/http/pprof 端点</td>
<td>错误的</td>
</tr>
<tr>
<td><code>profiling_freq</code></td>
<td>将分析数据转储到磁盘的频率。仅当 <code>profiling_enabled</code> 为 <code>true</code> 且 <code>profiling_freq</code> &gt; 0 时启用。</td>
<td></td>
</tr>
<tr>
<td><code>profiling_names</code></td>
<td>将在每个分析标记上转储到磁盘的配置文件名称列表，请参阅分析名称</td>
<td></td>
</tr>
<tr>
<td><code>profiling_port</code></td>
<td>net/http/pprof 端点的端口号。仅当 <code>profiling_enabled</code> 为 <code>true</code> 时使用。</td>
<td></td>
</tr>
<tr>
<td><code>ratelimit</code></td>
<td>速率限制配置，通常在服务器位于负载均衡器后面时使用（见下文）</td>
<td></td>
</tr>
<tr>
<td><code>socket_path</code></td>
<td>将 SPIRE 服务器 API 套接字绑定到的路径（仅限 Unix）</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>trust_domain</code></td>
<td>该服务器所属的信任域（不应超过 255 个字符）</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>ca_subject</th>
<th>描述</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>country</code></td>
<td><code>Country</code> 值数组</td>
<td></td>
</tr>
<tr>
<td><code>organization</code></td>
<td><code>Organization</code> 值数组</td>
<td></td>
</tr>
<tr>
<td><code>common_name</code></td>
<td><code>CommonName</code> 值</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>实验性的</th>
<th>描述</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cache_reload_interval</code></td>
<td>两次重新加载内存条目缓存之间的时间量。增加此值将减轻超大型部署的高数据库负载，但也会减慢新条目或更新条目向代理的传播速度。</td>
<td>5s</td>
</tr>
<tr>
<td><code>auth_opa_policy_engine</code></td>
<td>用于授权决策的 auth opa_policy 引擎</td>
<td>默认 SPIRE 授权策略</td>
</tr>
<tr>
<td><code>named_pipe_name</code></td>
<td>SPIRE Server API 命名管道的管道名称（仅限 Windows）</td>
<td>\spire-server\private\api</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>速率限制</th>
<th>描述</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>attestation</code></td>
<td>是否对节点证明进行速率限制。如果为 true，则节点证明的速率限制为每个 IP 地址每秒一次尝试。</td>
<td>真的</td>
</tr>
<tr>
<td><code>signing</code></td>
<td>是否对 JWT 和 X509 签名进行速率限制。如果为 true，JWT 和 X509 签名的速率限制为每个 IP 地址每秒 500 个请求（单独）。</td>
<td>真的</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>auth_opa_policy_engine</th>
<th>描述</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>local</code></td>
<td>授权策略的本地 OPA 配置。</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>auth_opa_policy_engine.local</th>
<th>描述</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rego_path</code></td>
<td>用于检索 OPA rego 策略以进行授权的文件。</td>
<td></td>
</tr>
<tr>
<td><code>policy_data_path</code></td>
<td>用于检索数据绑定以进行策略评估的文件。</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="分析名称">分析名称</h3>
<p>这些是可以在 <code>profiling_freq</code> 配置值中设置的可用配置文件：</p>
<ul>
<li><code>goroutine</code></li>
<li><code>threadcreate</code></li>
<li><code>heap</code></li>
<li><code>block</code></li>
<li><code>mutex</code></li>
<li><code>trace</code></li>
<li><code>cpu</code></li>
</ul>
<h2 id="插件配置">插件配置</h2>
<p>服务器配置文件还包含各种 SPIRE 服务器插件的配置部分。插件配置位于顶级 <code>plugins { ... }</code> 部分，其格式如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">plugins</span> {
</span></span><span class="line"><span class="cl">    <span class="k">pluginType</span> <span class="s2">&#34;pluginName&#34;</span> {
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">        <span class="k">plugin</span> <span class="k">configuration</span> <span class="k">options</span> <span class="k">here</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>以下配置选项可用于配置插件：</p>
<table>
<thead>
<tr>
<th>配置</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>插件命令</td>
<td>插件实现二进制文件的路径（可选，内置插件不需要）</td>
</tr>
<tr>
<td>插件校验和</td>
<td>插件二进制文件的可选 sha256（可选，内置不需要）</td>
</tr>
<tr>
<td>已启用</td>
<td>启用或禁用插件（默认启用）</td>
</tr>
<tr>
<td>插件数据</td>
<td>插件特定数据</td>
</tr>
</tbody>
</table>
<p>请参阅下面的内置插件部分，了解有关开箱即用的插件的信息。</p>
<h2 id="联邦配置">联邦配置</h2>
<p>SPIRE 服务器可以配置为与位于不同信任域中的其他 SPIRE 服务器联合。SPIRE 支持在 SPIRE 服务器配置文件中（静态关系）和通过信任域 API（动态关系）配置联合关系。本节介绍如何在配置文件中配置静态定义的关系。</p>
<p><em>注意：静态关系优先于动态关系。如果需要配置动态关系，请参见 <code>federation</code> 命令。静态关系不会反映在 <code>federation</code> 命令中。</em></p>
<p>配置联合信任域允许信任域对其他 SPIFFE 机构颁发的身份进行身份验证，从而允许一个信任域中的工作负载安全地对外部信任域中的工作负载进行身份验证。实现联合的一个关键要素是使用 SPIFFE 捆绑端点，这些资源（由 URL 表示）为信任域提供信任捆绑的副本。使用 <code>federation</code> 部分，你将能够将 SPIRE 设置为 SPIFFE 捆绑包端点服务器，并配置此 SPIRE 服务器将从中获取捆绑包的联合信任域。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">server</span> {
</span></span><span class="line"><span class="cl">    <span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">federation</span> {
</span></span><span class="line"><span class="cl">        <span class="k">bundle_endpoint</span> {
</span></span><span class="line"><span class="cl"><span class="n">            address</span> <span class="o">=</span> <span class="s2">&#34;0.0.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">            port</span> <span class="o">=</span> <span class="m">8443</span>
</span></span><span class="line"><span class="cl"><span class="n">            refresh_hint</span> <span class="o">=</span> <span class="s2">&#34;10m&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">profile</span> <span class="s2">&#34;https_web&#34;</span> {
</span></span><span class="line"><span class="cl">                <span class="k">acme</span> {
</span></span><span class="line"><span class="cl"><span class="n">                    domain_name</span> <span class="o">=</span> <span class="s2">&#34;example.org&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">                    email</span> <span class="o">=</span> <span class="s2">&#34;mail@example.org&#34;</span>
</span></span><span class="line"><span class="cl">                }
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        <span class="k">federates_with</span> <span class="s2">&#34;domain1.test&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">            bundle_endpoint_url</span> <span class="o">=</span> <span class="s2">&#34;https://1.2.3.4:8443&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">bundle_endpoint_profile</span> <span class="s2">&#34;https_web&#34;</span> {}
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        <span class="k">federates_with</span> <span class="s2">&#34;domain2.test&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">            bundle_endpoint_url</span> <span class="o">=</span> <span class="s2">&#34;https://5.6.7.8:8443&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">bundle_endpoint_profile</span> <span class="s2">&#34;https_spiffe&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">                endpoint_spiffe_id</span> <span class="o">=</span> <span class="s2">&#34;spiffe://domain2.test/beserver&#34;</span>
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p><code>federation.bundle_endpoint</code> 部分是可选的，用于在 SPIRE 服务器中设置 SPIFFE 捆绑端点服务器。 <code>federation.federates_with</code> 部分也是可选的，用于配置与外部信任域的联合关系。此部分用于 SPIRE 服务器将定期获取捆绑包的每个联合信任域。</p>
<h3 id="federationbundle_endpoint-的配置选项"><code>federation.bundle_endpoint</code> 的配置选项</h3>
<p>此可选部分包含 SPIRE 服务器用于公开捆绑端点的配置。</p>
<table>
<thead>
<tr>
<th>配置</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>address</td>
<td>该服务器将侦听 HTTP 请求的 IP 地址</td>
</tr>
<tr>
<td>port</td>
<td>该服务器将侦听 HTTP 请求的 TCP 端口号</td>
</tr>
<tr>
<td>refresh_hint</td>
<td>允许手动指定刷新提示。如果未设置，则根据捆绑包中密钥的生命周期确定。小值允许及时检索信任包更新</td>
</tr>
<tr>
<td>profile &ldquo;&lt;https_web|https_spiffe&gt;&rdquo;</td>
<td>允许配置捆绑配置文件</td>
</tr>
</tbody>
</table>
<h3 id="federationbundle_endpointprofile-的配置选项"><code>federation.bundle_endpoint.profile</code> 的配置选项</h3>
<p>当设置 <code>bundle_endpoint</code> 时，它是 <code>required</code> 来指定捆绑配置文件。</p>
<p>允许的配置文件：</p>
<ul>
<li><code>https_web</code> 允许配置自动证书管理环境部分。</li>
<li><code>https_spiffe</code></li>
</ul>
<h3 id="federationbundle_endpointprofile-https_webacme-的配置选项"><code>federation.bundle_endpoint.profile &quot;https_web&quot;.acme</code> 的配置选项</h3>
<table>
<thead>
<tr>
<th>配置</th>
<th>描述</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td>directory_url</td>
<td>目录端点 URL</td>
<td><a href="https://acme-v02.api.letsencrypt.org/directory" target="_blank" rel="noopener">https://acme-v02.api.letsencrypt.org/directory</a></td>
</tr>
<tr>
<td>domain_name</td>
<td>证书管理器尝试检索新证书的域</td>
<td></td>
</tr>
<tr>
<td>email</td>
<td>联系电子邮件地址。Let&rsquo;s Encrypt 等 CA 使用它来通知已颁发证书的问题</td>
<td></td>
</tr>
<tr>
<td>tos_acceptted</td>
<td>接受 ACME 服务条款。如果没有设置为 true，并且提供商要求接受，则证书检索将失败</td>
<td>false</td>
</tr>
</tbody>
</table>
<h3 id="federationbundle_endpointprofile-https_spiffe-的配置选项"><code>federation.bundle_endpoint.profile &quot;https_spiffe&quot;</code> 的配置选项</h3>
<p>默认捆绑配置文件配置。</p>
<h3 id="federationfederates_withtrust-domainbundle_endpoint-的配置选项"><code>federation.federates_with[&quot;&lt;trust domain&gt;&quot;].bundle_endpoint</code> 的配置选项</h3>
<p>可选的 <code>federates_with</code> 部分是捆绑端点配置文件配置的映射，以该服务器想要联合的 <code>&quot;&lt;trust domain&gt;&quot;</code> 的名称为键。此部分具有以下可配置项：</p>
<table>
<thead>
<tr>
<th>配置</th>
<th>描述</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td>bundle_endpoint_url</td>
<td>提供要联合的信任捆绑包的 SPIFFE 捆绑包端点的 URL。必须使用 HTTPS 协议。</td>
<td></td>
</tr>
<tr>
<td>bundle_endpoint_profile &ldquo;&lt;https_web | https_spiffe&gt;&rdquo;</td>
<td>SPIFFE 端点配置文件类型的配置。</td>
<td></td>
</tr>
</tbody>
</table>
<p>SPIRE 支持 <code>https_web</code> 和 <code>https_spiffe</code> 捆绑端点配置文件。</p>
<p><code>https_web</code> 配置文件不需要额外的设置。</p>
<p>使用 <code>https_spiffe</code> 捆绑端点配置文件配置的信任域必须使用 <code>endpoint_spiffe_id</code> 设置作为配置的一部分来指定远程 SPIFFE 捆绑端点服务器的预期 SPIFFE ID。</p>
<p>有关 SPIFFE 中定义的不同配置文件的更多信息，以及设置 SPIFFE 联合的安全注意事项，请参阅 <a href="../../standard/spiffe-federation/">SPIFFE 联邦标准</a>。</p>
<h2 id="遥测配置">遥测配置</h2>
<p>请参阅遥测配置指南，了解有关配置 SPIRE 服务器以发出遥测数据的更多信息。</p>
<h2 id="健康检查配置">健康检查配置</h2>
<p>服务器可以公开可用于健康检查的附加端点。它可以通过设置 <code>listener_enabled = true</code> 来启用。目前它公开了 2 条路径：一条用于活动（服务器是否已启动？），另一条用于准备（服务器是否准备好服务请求？）。默认情况下，健康检查端点将侦听 localhost:80，除非另有配置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">health_checks</span> {
</span></span><span class="line"><span class="cl"><span class="n">        listener_enabled</span> <span class="o">=</span> <span class="kt">true</span>
</span></span><span class="line"><span class="cl"><span class="n">        bind_address</span> <span class="o">=</span> <span class="s2">&#34;localhost&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">        bind_port</span> <span class="o">=</span> <span class="s2">&#34;8080&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">        live_path</span> <span class="o">=</span> <span class="s2">&#34;/live&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">        ready_path</span> <span class="o">=</span> <span class="s2">&#34;/ready&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><h2 id="命令行选项">命令行选项</h2>
<h3 id="spire-server-run"><code>spire-server run</code></h3>
<p>上面的大多数配置文件选项都有相同的命令行对应项。此外，还可以使用以下标志。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-bindAddress</code></td>
<td>SPIRE 服务器的 IP 地址或 DNS 名称</td>
<td></td>
</tr>
<tr>
<td><code>-config</code></td>
<td>SPIRE 配置文件的路径</td>
<td>conf/服务器/服务器.conf</td>
</tr>
<tr>
<td><code>-dataDir</code></td>
<td>存储运行时数据的目录</td>
<td></td>
</tr>
<tr>
<td><code>-expandEnv</code></td>
<td>展开配置文件中的环境 $VARIABLES</td>
<td></td>
</tr>
<tr>
<td><code>-logFile</code></td>
<td>将日志写入的文件</td>
<td></td>
</tr>
<tr>
<td><code>-logFormat</code></td>
<td>日志格式，</td>
<td></td>
</tr>
<tr>
<td><code>-logLevel</code></td>
<td>调试、信息、警告或错误</td>
<td></td>
</tr>
<tr>
<td><code>-serverPort</code></td>
<td>SPIRE 服务器的端口号</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>将 SPIRE 服务器 API 套接字绑定到的路径</td>
<td></td>
</tr>
<tr>
<td><code>-trustDomain</code></td>
<td>该服务器所属的信任域（不应超过 255 个字符）</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="将-spire-server-作为-windows-服务运行">将 SPIRE Server 作为 Windows 服务运行</h4>
<p>在 Windows 平台上，SPIRE Server 可以选择作为 Windows 服务运行。作为 Windows 服务运行时，唯一支持的命令是 <code>run</code> 命令。</p>
<p><em>注意：SPIRE 不会自动在系统中创建该服务，必须由用户创建。启动服务时，使用 <code>run</code> 命令执行 SPIRE Server 的所有参数都必须作为服务参数传递。</em></p>
<h5 id="创建-spire-server-windows-服务的示例">创建 SPIRE Server Windows 服务的示例</h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt; sc.exe create spire-server <span class="nv">binpath</span><span class="o">=</span>c:<span class="se">\s</span>pire<span class="se">\b</span>in<span class="se">\s</span>pire-server.exe
</span></span></code></pre></div><h5 id="运行-spire-server-windows-服务的示例">运行 SPIRE Server Windows 服务的示例</h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt; sc.exe start spire-server run -config c:<span class="se">\s</span>pire<span class="se">\c</span>onf<span class="se">\s</span>erver<span class="se">\s</span>erver.conf
</span></span></code></pre></div><h3 id="spire-server-token-generate"><code>spire-server token generate</code></h3>
<p>生成一个节点加入令牌并为其创建一个注册条目。该令牌可用于引导一个 spire-agent 安装。除了基于令牌的 ID 之外，可选的 <code>-spiffeID</code> 可用于为令牌提供人类可读的注册条目名称。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-spiffeID</code></td>
<td>用于分配令牌所有者的附加 SPIFFE ID（可选）</td>
<td></td>
</tr>
<tr>
<td><code>-ttl</code></td>
<td>令牌 TTL（以秒为单位）</td>
<td>600</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-entry-create"><code>spire-server entry create</code></h3>
<p>创建注册条目。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-admin</code></td>
<td>如果设置，此条目中的 SPIFFE ID 将被授予对服务器 API 的访问权限</td>
<td></td>
</tr>
<tr>
<td><code>-data</code></td>
<td>包含 JSON 格式的注册数据的文件的路径（可选，如果指定，则必须省略与条目信息相关的其他标志）。如果设置为“-”，则从 stdin 读取 JSON。</td>
<td></td>
</tr>
<tr>
<td><code>-dns</code></td>
<td>DNS 名称将包含在基于此条目发布的 SVID 中（如果适用）。可以多次使用</td>
<td></td>
</tr>
<tr>
<td><code>-downstream</code></td>
<td>布尔值，设置后表示该条目描述下游 SPIRE 服务器</td>
<td></td>
</tr>
<tr>
<td><code>-entryExpiry</code></td>
<td>从数据存储中删除生成的注册条目的到期时间（以秒为单位）。请注意，这是一项数据管理功能，而不是安全功能（可选）。</td>
<td></td>
</tr>
<tr>
<td><code>-entryID</code></td>
<td>新创建的注册条目的用户指定 ID（可选）。如果没有提供条目 ID，则会在创建时生成一个</td>
<td></td>
</tr>
<tr>
<td><code>-federatesWith</code></td>
<td>代表与此注册条目联合的信任域的信任域 SPIFFE ID 列表。该信任域的捆绑包必须已存在</td>
<td></td>
</tr>
<tr>
<td><code>-node</code></td>
<td>如果设置，此条目将应用于匹配节点而不是工作负载</td>
<td></td>
</tr>
<tr>
<td><code>-parentID</code></td>
<td>该记录父记录的 SPIFFE ID。</td>
<td></td>
</tr>
<tr>
<td><code>-selector</code></td>
<td>用于证明的冒号分隔的类型：值选择器。该参数可以多次使用，以指定必须满足的多个选择器。</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-spiffeID</code></td>
<td>该记录代表的 SPIFFE ID 并将被设置为颁发的 SVID。</td>
<td></td>
</tr>
<tr>
<td><code>-x509SVIDTTL</code></td>
<td>作为此记录的结果而发出的任何 X509-SVID 的 TTL（以秒为单位）。覆盖 <code>-ttl</code> 值。</td>
<td>使用 <code>default_x509_svid_ttl</code> 配置的 TTL</td>
</tr>
<tr>
<td><code>-jwtSVIDTTL</code></td>
<td>作为此记录的结果而发出的任何 JWT-SVID 的 TTL（以秒为单位）。覆盖 <code>-ttl</code> 值。</td>
<td>使用 <code>default_jwt_svid_ttl</code> 配置的 TTL</td>
</tr>
<tr>
<td><code>-storeSVID</code></td>
<td>一个布尔值，设置后表示必须通过 SVIDStore 插件存储从此条目生成的 SVID</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-entry-update"><code>spire-server entry update</code></h3>
<p>更新注册条目。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-admin</code></td>
<td>如果为 true，则此条目中的 SPIFFE ID 将被授予对服务器 API 的访问权限</td>
<td></td>
</tr>
<tr>
<td><code>-data</code></td>
<td>包含 JSON 格式的注册数据的文件的路径（可选，如果指定，则必须省略与条目信息相关的其他标志）。如果设置为“-”，则从 stdin 读取 JSON。</td>
<td></td>
</tr>
<tr>
<td><code>-dns</code></td>
<td>DNS 名称将包含在基于此条目发布的 SVID 中（如果适用）。可以多次使用</td>
<td></td>
</tr>
<tr>
<td><code>-downstream</code></td>
<td>布尔值，设置后表示该条目描述下游 SPIRE 服务器</td>
<td></td>
</tr>
<tr>
<td><code>-entryExpiry</code></td>
<td>到期时间（以秒为单位），用于修剪生成的注册条目</td>
<td></td>
</tr>
<tr>
<td><code>-entryID</code></td>
<td>要更新的记录的注册条目 ID</td>
<td></td>
</tr>
<tr>
<td><code>-federatesWith</code></td>
<td>代表与此注册条目联合的信任域的信任域 SPIFFE ID 列表。该信任域的捆绑包必须已存在</td>
<td></td>
</tr>
<tr>
<td><code>-parentID</code></td>
<td>该记录父记录的 SPIFFE ID。</td>
<td></td>
</tr>
<tr>
<td><code>-selector</code></td>
<td>用于证明的冒号分隔的类型：值选择器。该参数可以多次使用，以指定必须满足的多个选择器。</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-spiffeID</code></td>
<td>该记录代表的 SPIFFE ID 并将被设置为颁发的 SVID。</td>
<td></td>
</tr>
<tr>
<td><code>-x509SVIDTTL</code></td>
<td>作为此记录的结果而发出的任何 X509-SVID 的 TTL（以秒为单位）。覆盖 <code>-ttl</code> 值。</td>
<td>使用 <code>default_x509_svid_ttl</code> 配置的 TTL</td>
</tr>
<tr>
<td><code>-jwtSVIDTTL</code></td>
<td>作为此记录的结果而发出的任何 JWT-SVID 的 TTL（以秒为单位）。覆盖 <code>-ttl</code> 值。</td>
<td>使用 <code>default_jwt_svid_ttl</code> 配置的 TTL</td>
</tr>
<tr>
<td><code>storeSVID</code></td>
<td>一个布尔值，设置后表示必须通过 SVIDStore 插件存储从此条目生成的 SVID</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-entry-count"><code>spire-server entry count</code></h3>
<p>显示注册条目总数。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-entry-delete"><code>spire-server entry delete</code></h3>
<p>删除指定的注册条目。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-entryID</code></td>
<td>要删除的记录的注册条目 ID</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-entry-show"><code>spire-server entry show</code></h3>
<p>显示配置的注册条目。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-downstream</code></td>
<td>布尔值，设置后表示该条目描述下游 SPIRE 服务器</td>
<td></td>
</tr>
<tr>
<td><code>-entryID</code></td>
<td>要显示的记录的条目 ID。</td>
<td></td>
</tr>
<tr>
<td><code>-federatesWith</code></td>
<td>与条目联合的信任域的 SPIFFE ID。可以多次使用</td>
<td></td>
</tr>
<tr>
<td><code>-parentID</code></td>
<td>要显示的记录的父 ID。</td>
<td></td>
</tr>
<tr>
<td><code>-selector</code></td>
<td>以冒号分隔的类型：值选择器。可以多次使用来指定多个选择器。</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-spiffeID</code></td>
<td>要显示的记录的 SPIFFE ID。</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-bundle-count"><code>spire-server bundle count</code></h3>
<p>显示捆绑包的总数。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-bundle-show"><code>spire-server bundle show</code></h3>
<p>显示服务器信任域的捆绑包。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-format</code></td>
<td>显示捆绑包的格式。 <code>pem</code> 或 <code>spiffe</code></td>
<td>pem</td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-bundle-list"><code>spire-server bundle list</code></h3>
<p>显示联合捆绑包。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-id</code></td>
<td>要显示的捆绑包的信任域 SPIFFE ID。如果未设置，则显示所有信任包</td>
<td></td>
</tr>
<tr>
<td><code>-format</code></td>
<td>显示联合捆绑包的格式。 <code>pem</code> 或 <code>spiffe</code></td>
<td>pem</td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-bundle-set"><code>spire-server bundle set</code></h3>
<p>创建或更新信任域的捆绑数据。此命令不能用于更改服务器信任域捆绑，只能用于其他信任域的捆绑。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-id</code></td>
<td>要设置的捆绑包的信任域 SPIFFE ID。</td>
<td></td>
</tr>
<tr>
<td><code>-path</code></td>
<td>包含捆绑数据的文件在磁盘上的路径。如果未设置，则从标准输入读取数据。</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-format</code></td>
<td>要设置的捆绑包的格式。 <code>pem</code> 或 <code>spiffe</code></td>
<td>pem</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-bundle-delete"><code>spire-server bundle delete</code></h3>
<p>删除信任域的捆绑数据。该命令不能用于删除服务器信任域捆绑，只能删除其他信任域的捆绑。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-id</code></td>
<td>要删除的捆绑包的信任域 SPIFFE ID。</td>
<td></td>
</tr>
<tr>
<td><code>-mode</code></td>
<td>以下之一： <code>restrict</code> 、 <code>dissociate</code> 、 <code>delete</code> 。 <code>restrict</code> 如果捆绑包与注册条目关联（即联合），则防止该捆绑包被删除。 <code>dissociate</code> 允许删除捆绑包并从注册条目中删除关联。 <code>delete</code> 删除捆绑包以及关联的注册条目。</td>
<td><code>restrict</code></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-federation-create"><code>spire-server federation create</code></h3>
<p>创建与外部信任域的动态联合关系。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-bundleEndpointProfile</code></td>
<td>端点配置文件类型。 <code>https_web</code> 或 <code>https_spiffe</code> 。</td>
<td></td>
</tr>
<tr>
<td><code>-bundleEndpointURL</code></td>
<td>提供信任捆绑包的 SPIFFE 捆绑包端点的 URL（必须使用 HTTPS 协议）。</td>
<td></td>
</tr>
<tr>
<td><code>-data</code></td>
<td>包含 JSON 格式的联合关系的文件的路径（可选，如果指定，则必须省略与联合关系信息相关的其他标志）。如果设置为“-”，则从 stdin 读取 JSON。</td>
<td></td>
</tr>
<tr>
<td><code>-endpointSpiffeID</code></td>
<td>SPIFFE 捆绑端点服务器的 SPIFFE ID。仅用于 <code>https_spiffe</code> 配置文件。</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径。</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-trustDomain</code></td>
<td>要联合的信任域的名称（例如 example.org）</td>
<td></td>
</tr>
<tr>
<td><code>-trustDomainBundleFormat</code></td>
<td>捆绑数据的格式（可选）。 <code>pem</code> 或 <code>spiffe</code> 。</td>
<td>pem</td>
</tr>
<tr>
<td><code>-trustDomainBundlePath</code></td>
<td>信任域捆绑数据的路径（可选）。</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-federation-delete"><code>spire-server federation delete</code></h3>
<p>删除动态联合关系。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-id</code></td>
<td>关系的信任域的 SPIFFE ID。</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径。</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-federation-list"><code>spire-server federation list</code></h3>
<p>列出所有动态联合关系。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-id</code></td>
<td>关系信任域的 SPIFFE ID</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径。</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-federation-refresh"><code>spire-server federation refresh</code></h3>
<p>从指定的联合信任域刷新捆绑包。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-id</code></td>
<td>关系信任域的 SPIFFE ID</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径。</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-federation-show"><code>spire-server federation show</code></h3>
<p>显示动态的联邦关系。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径。</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-trustDomain</code></td>
<td>要显示的联合关系的信任域名（例如 example.org）</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-federation-update"><code>spire-server federation update</code></h3>
<p>更新与外部信任域的动态联合关系。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-bundleEndpointProfile</code></td>
<td>端点配置文件类型。 <code>https_web</code> 或 <code>https_spiffe</code> 。</td>
<td></td>
</tr>
<tr>
<td><code>-bundleEndpointURL</code></td>
<td>提供信任捆绑包的 SPIFFE 捆绑包端点的 URL（必须使用 HTTPS 协议）。</td>
<td></td>
</tr>
<tr>
<td><code>-data</code></td>
<td>包含 JSON 格式的联合关系的文件的路径（可选，如果指定，则必须省略与联合关系信息相关的其他标志）。如果设置为“-”，则从 stdin 读取 JSON。</td>
<td></td>
</tr>
<tr>
<td><code>-endpointSpiffeID</code></td>
<td>SPIFFE 捆绑端点服务器的 SPIFFE ID。仅用于 <code>https_spiffe</code> 配置文件。</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径。</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-trustDomain</code></td>
<td>要联合的信任域的名称（例如 example.org）</td>
<td></td>
</tr>
<tr>
<td><code>-trustDomainBundleFormat</code></td>
<td>捆绑数据的格式（可选）。 <code>pem</code> 或 <code>spiffe</code> 。</td>
<td>pem</td>
</tr>
<tr>
<td><code>-trustDomainBundlePath</code></td>
<td>信任域捆绑数据的路径（可选）。</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-agent-ban"><code>spire-server agent ban</code></h3>
<p>根据 spiffeID 禁止已证明的节点。被禁止的证明节点无法重新证明。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-spiffeID</code></td>
<td>要禁止的代理的 SPIFFE ID（代理身份）</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-agent-count"><code>spire-server agent count</code></h3>
<p>显示已证明的节点总数。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-agent-evict"><code>spire-server agent evict</code></h3>
<p>在给定 spiffeID 的情况下取消对已认证节点的认证。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-spiffeID</code></td>
<td>要驱逐的代理的 SPIFFE ID（代理身份）</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-agent-list"><code>spire-server agent list</code></h3>
<p>显示已证明的节点。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-agent-show"><code>spire-server agent show</code></h3>
<p>显示给定 spiffeID 的已证明节点的详细信息（包括节点选择器）。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-spiffeID</code></td>
<td>要显示的代理的 SPIFFE ID（代理身份）</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-healthcheck"><code>spire-server healthcheck</code></h3>
<p>检查 SPIRE 服务器的健康状况。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-shallow</code></td>
<td>执行不太严格的健康检查</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-verbose</code></td>
<td>打印详细信息</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-validate"><code>spire-server validate</code></h3>
<p>验证 SPIRE 服务器配置文件。参数与 <code>spire-server run</code> 相同。通常，你可能至少需要：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-config</code></td>
<td>SPIRE 服务器配置文件的路径</td>
<td>服务器配置文件</td>
</tr>
<tr>
<td><code>-expandEnv</code></td>
<td>展开配置文件中的环境 $VARIABLES</td>
<td>错误的</td>
</tr>
</tbody>
</table>
<h3 id="spire-server-x509-mint"><code>spire-server x509 mint</code></h3>
<p>铸造 X509-SVID。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-dns</code></td>
<td>将包含在 SVID 中的 DNS 名称。可以多次使用</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-spiffeID</code></td>
<td>X509-SVID 的 SPIFFE ID</td>
<td></td>
</tr>
<tr>
<td><code>-ttl</code></td>
<td>X509-SVID 的 TTL</td>
<td><code>Entry.x509_svid_ttl</code> 、 <code>Entry.ttl</code> 、 <code>default_x509_svid_ttl</code> 、 <code>1h</code> 中的第一个非零值</td>
</tr>
<tr>
<td><code>-write</code></td>
<td>将输出写入而不是 stdout 的目录</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="spire-server-jwt-mint"><code>spire-server jwt mint</code></h3>
<p>铸造 JWT-SVID。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>行动</th>
<th>默认</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-audience</code></td>
<td>观众声称将包含在 SVID 中。可以多次使用</td>
<td></td>
</tr>
<tr>
<td><code>-socketPath</code></td>
<td>SPIRE 服务器 API 套接字的路径</td>
<td>/tmp/spire-server/private/api.sock</td>
</tr>
<tr>
<td><code>-spiffeID</code></td>
<td>JWT-SVID 的 SPIFFE ID</td>
<td></td>
</tr>
<tr>
<td><code>-ttl</code></td>
<td>JWT-SVID 的 TTL</td>
<td><code>Entry.jwt_svid_ttl</code> 、 <code>Entry.ttl</code> 、 <code>default_jwt_svid_ttl</code> 、 <code>5m</code> 中的第一个非零值</td>
</tr>
<tr>
<td><code>-write</code></td>
<td>要写入令牌而不是标准输出的文件</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="-data-的-json-对象"><code>-data</code> 的 JSON 对象</h2>
<p>传递给 <code>entry create/update</code> 的 <code>-data</code> 的 JSON 对象需要以下形式：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;entries&#34;</span><span class="p">:[]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>入口对象在公共 protobuf 文件中由 <code>RegistrationEntry</code> 描述。</p>
<p><em>注意：要创建节点条目，请将 <code>parent_id</code> 设置为特殊值 <code>spiffe://&lt;your-trust-domain&gt;/spire/server</code> 。这就是在 cli 上传递 <code>-node</code> 标志时代码所做的事情。</em></p>
<h2 id="配置文件示例">配置文件示例</h2>
<p>本节包括用于格式化和语法参考的示例配置文件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">server</span> {
</span></span><span class="line"><span class="cl"><span class="n">    trust_domain</span> <span class="o">=</span> <span class="s2">&#34;example.org&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">    bind_address</span> <span class="o">=</span> <span class="s2">&#34;0.0.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    bind_port</span> <span class="o">=</span> <span class="s2">&#34;8081&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    log_level</span> <span class="o">=</span> <span class="s2">&#34;INFO&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    data_dir</span> <span class="o">=</span> <span class="s2">&#34;/opt/spire/.data/&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    default_x509_svid_ttl</span> <span class="o">=</span> <span class="s2">&#34;6h&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    default_jwt_svid_ttl</span> <span class="o">=</span> <span class="s2">&#34;5m&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    ca_ttl</span> <span class="o">=</span> <span class="s2">&#34;72h&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">ca_subject</span> {
</span></span><span class="line"><span class="cl"><span class="n">        country</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;US&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">        organization</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;SPIRE&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">        common_name</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">telemetry</span> {
</span></span><span class="line"><span class="cl">    <span class="k">Prometheus</span> {
</span></span><span class="line"><span class="cl"><span class="n">        port</span> <span class="o">=</span> <span class="m">1234</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">plugins</span> {
</span></span><span class="line"><span class="cl">    <span class="k">DataStore</span> <span class="s2">&#34;sql&#34;</span> {
</span></span><span class="line"><span class="cl">        <span class="k">plugin_data</span> {
</span></span><span class="line"><span class="cl"><span class="n">            database_type</span> <span class="o">=</span> <span class="s2">&#34;sqlite3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">            connection_string</span> <span class="o">=</span> <span class="s2">&#34;/opt/spire/.data/datastore.sqlite3&#34;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    <span class="k">NodeAttestor</span> <span class="s2">&#34;join_token&#34;</span> {
</span></span><span class="line"><span class="cl">        <span class="k">plugin_data</span> {}
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    <span class="k">KeyManager</span> <span class="s2">&#34;disk&#34;</span> {
</span></span><span class="line"><span class="cl">        <span class="k">plugin_data</span> {
</span></span><span class="line"><span class="cl"><span class="n">            keys_path</span> <span class="o">=</span> <span class="s2">&#34;/opt/spire/.data/keys.json&#34;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div>
          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/spiffe/">SPIFFE</a>
  
  <a class="badge badge-light" href="/tag/spire/">SPIRE</a>
  
  <a class="badge badge-light" href="/tag/%E5%AE%89%E5%85%A8/">安全</a>
  
</div>



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/spiffe-and-spire/configuration/agent/" rel="next">
    <div class="meta-nav">上一页</div>
    <p>SPIRE Agent 配置参考</p></a>
  
  
</div>

          </div>
          

        <div class="body-footer">
          <p>最近更新于 2023-11-29</p>

          





  

<p class="edit-page">
  <a href="https://github.com/rootsongjc/cloud-native-library//edit/master/content/spiffe-and-spire/configuration/server.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>



          


  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    <script>
  let themeNumber = localStorage.getItem('wcTheme');
  var giscusTheme = "light";
  if (themeNumber == 1){
    giscusTheme = "dark";
  }
  console.log(giscusTheme)
  let giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-theme": giscusTheme,
    "data-repo":"rootsongjc/cloud-native-library",
    "data-repo-id":"MDEwOlJlcG9zaXRvcnkyMTQ2MjY2NDg=",
    "data-category":"Announcements",
    "data-category-id":"DIC_kwDODMrxWM4CPL7J",
    "data-mapping":"pathname",
    "data-reactions-enabled":"1",
    "data-emit-metadata":"0",
    "data-input-position":"top",
    "data-theme":giscusTheme,
    "data-lang":"zh-CN",
    "data-loading":"lazy",
    "crossorigin":"anonymous",
    "origins":"https://jimmysong.io",
    "originsRegex":"http://localhost:[0-9]+",
    "async": "",
  };

  let giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.querySelector('#comments').appendChild(giscusScript);
</script>

  </section>
  



          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2017-2023 jimmysong.io all rights reserved</p>
        </div>
    </div>
  </div>

</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  


<script src="/js/vendor-bundle.min.46271ef31da3f018e9cd1b59300aa265.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.24983018b0e5661cd5fe1822254286ea.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">引用</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> 复制
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> 下载
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

  <script src="/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>
<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
