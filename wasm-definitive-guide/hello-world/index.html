<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
    
    
    
  
  

  <meta name="author" content="宋净超" />

  
  
  
    
  
  <meta name="description" content="从 Hello world 开始。" />

  
  <link rel="alternate" hreflang="zh" href="https://lib.jimmysong.io/wasm-definitive-guide/hello-world/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.b26eb9b802629dccab300faa82cc98c7.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-MP490FS739"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-MP490FS739");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a4b7f65b1839466beaa48d633aa60c1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://lib.jimmysong.io/wasm-definitive-guide/hello-world/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@jimmysongio" />
    <meta property="twitter:creator" content="@jimmysongio" />
  
  <meta property="og:site_name" content="云原生资料库" />
  <meta property="og:url" content="https://lib.jimmysong.io/wasm-definitive-guide/hello-world/" />
  <meta property="og:title" content="WebAssembly 入门 | 云原生资料库" />
  <meta property="og:description" content="从 Hello world 开始。" /><meta property="og:image" content="https://lib.jimmysong.io/media/sharing.png" />
    <meta property="twitter:image" content="https://lib.jimmysong.io/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2023-01-16T00:00:00&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2023-02-13T17:50:26&#43;08:00">
  

  



  

  

  





  <title>WebAssembly 入门 | 云原生资料库</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="856703075543943eca7b89b7342c8325" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#books"><span>图书</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>教程</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/kubernetes-handbook"><span>Kubernetes 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/istio-fundamentals-zh"><span>Istio 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh"><span>Envoy 基础教程</span></a>
              
            </div>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/blog"><span>译文</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#feed"><span>更新</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://jimmysong.io" target="_blank" rel="noopener"><span>Jimmy Song</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://jimmysong.io/contact/" data-toggle="tooltip" data-placement="bottom" title="联系" target="_blank" rel="noopener" aria-label="联系">
                <i class="fab fa-weixin" aria-hidden="true"></i>
              </a>
            </li>
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/jimmysongio" data-toggle="tooltip" data-placement="bottom" title="关注" target="_blank" rel="noopener" aria-label="关注">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        <li class="nav-item">
            <a class="nav-link" href="https://jimmysong.io" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="主站" aria-label="主站"><i class="fas fa-home" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="https://github.com/rootsongjc/cloud-native-library/" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="查看源码" aria-label="查看源码" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          WebAssembly 权威指南
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      



  
    
    
    
    
      
    
    

    
      <ul class="nav docs-sidenav">
          <li class="level "><a href="/wasm-definitive-guide/"><i class="fas fa-book-open pr-1"></i>WebAssembly 权威指南</a></li>
    
      



  <li class="child level "><a href="/wasm-definitive-guide/foreword/">译者序</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/introduction/">第 1 章：简介</a></li>




  <li class="child level active"><a href="/wasm-definitive-guide/hello-world/">第 2 章：入门</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/wasm-modules/">第 3 章：WebAssembly 模块</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/wasm-memory/">第 4 章：WebAssembly 内存</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/using-c-cpp-and-wasm/">第 5 章：使用 C/C&#43;&#43; 和 WebAssembly</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/apply-wasm-lagacy-code-in-the-browser/">第 6 章：应用 WebAssembly—— 在浏览器中运行遗留代码</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/wasm-tables/">第 7 章：WebAssembly 表</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/wasm-in-the-server/">第 8 章：在服务器中运行 WebAssembly</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/applied-wasm-tensorflow-js/">第 9 章：应用 WebAssembly——TensorFlow.js</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/rust/">第 10 章：Rust</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/wasi/">第 11 章：WASI（WebAssembly 系统接口）</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/extending-wasm-platform/">第 12 章：扩展 WebAssembly 平台</a></li>




  <li class="child level "><a href="/wasm-definitive-guide/appendix/">附录</a></li>

      
    

    
      </ul>
    

  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">目录</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#webassembly-文本格式wat">WebAssembly 文本格式（Wat）</a></li>
    <li><a href="#将-wat-转换为-wasm">将 Wat 转换为 Wasm</a></li>
    <li><a href="#在-repl-中运行-wasm">在 Repl 中运行 Wasm</a></li>
    <li><a href="#在浏览器中运行-wasm">在浏览器中运行 Wasm</a></li>
    <li><a href="#注释">注释</a></li>
  </ul>
</nav>

      
<div class="subscribe-module col-12 mt-1">
    <img src="/img/wechat.webp" alt="image" title="Jimmy Song的微信公众号"/>
    <p class="text-center pt-1">关注「几米宋」微信公众号，获取本站更新</p>
    
    
     <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4029167986768912"
     crossorigin="anonymous"></script>
     <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-4029167986768912"
       data-ad-slot="6856371908"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
    <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    
    
</div>



    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          

          <h1>WebAssembly 入门</h1>

          <div class="article-style">
            <blockquote>
<p>它是如何，嗯，它是如何工作的？</p>
<p>—— 亚瑟王，《巨蟒与圣杯》（Monty Python and the Holy Grail）</p>
</blockquote>
<p>学习 WebAssembly 的难点在于入门资料很多。作为一名 C/C++ 或 Rust 开发者，你都可以从这里开始，但也可以直接了解 WebAssembly 的机制，不需要考虑语言生成的问题。本章将从不考虑语言的角度介绍 WebAssembly，随着我们深入学习底层细节，在后面的章节中，我们将与高级语言建立联系。虽然这些细节最初看起来简单，但对于理解 WebAssembly 的基本机制却非常重要，它们不会是你的最终目的。</p>
<p>在 <a href="../introduction/">第 1 章</a>，我曾经在讨论 asm.js 时介绍了大多数人编写新编程语言或技术的第一个程序。在例 2-1 中，我们再次展示了这个程序，它被称为 &ldquo;Hello, World!&quot;，以向 Brian Kernighan 和 Dennis Ritchie 的开创性著作《C 程序设计语言》致敬。很多优秀的编程书籍 <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> 都从这个例子开始，因为它使读者了解了程序的基本概念，而不会深入细节。这是一种有趣，简洁的方法，也是确保读者正确设置工具的有效方法。</p>
<p>例 2-1. 典型的 &ldquo;Hello, world!&rdquo; 程序，用 C 语言编写</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span> <span class="p">{</span><span class="n">printf</span> <span class="p">(</span><span class="s">&#34;Hello, World!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>不幸的是，WebAssembly 没有办法打印到控制台，所以我们不能以这种方式开始。</p>
<p>等等，什么？</p>
<p>我将给你一点时间来消化这句话，也许可以重读几遍，以确保你能理解。</p>
<p>是不是感觉很困惑？是的，可以说，WebAssembly 没有办法打印到控制台、读取文件或打开网络连接&hellip;&hellip; 除非有对应的 API 可以调用。</p>
<p>在检查例 2-1 时，你会发现问题所在。要使该程序正常运行，它需要 printf () 函数的工作副本，这个函数可以在标准库中找到。C 语言程序具有可移植性的原因之一是，这种标准库在各种平台上都存在。POSIX 库，把这些常见的功能扩展到了控制台以外，包括文件操作、信号处理、消息传递等。应用程序会写入诸如 POSIX 的 API，但可执行文件还需要一个静态或动态库，提供在目标平台上运行的调用方法的行为，这就是你打算使用的操作系统的本地可执行格式。</p>
<p>因此，WebAssembly 使代码可移植，但我们仍然需要其他工具来帮助使应用程序可移植。我们会在书中重新探讨这个话题，但现在请记住，WebAssembly 没有直接的方法来写入控制台。</p>
<p>在<a href="../using-c-cpp-and-wasm/">第 5 章</a>，我们将向 Kernighan 和 Ritchie 致敬，并运行那个程序。但首先，我们需要学习 WebAssembly 的人类友好格式，以及如何让低级指令与堆栈机交互。然而，我仍然希望你在这里有一个 “Hello, world!” 的体验，所以我们将挑选其他内容来编写和运行，这不是太有挑战性，但仍然是合理的。这也算是一种 &ldquo;Hello, world!&rdquo; 吧！</p>
<h2 id="webassembly-文本格式wat">WebAssembly 文本格式（Wat）</h2>
<p>WebAssembly 的二进制格式（Wasm）的设计目的是为了加速 WebAssembly 模块的传输、加载和验证。我们将在 <a href="../wasm-modules/">第 3 章</a> 更深入地了解模块，但现在只需把它们理解为部署的单元，就像 Java 中的库或 Jar 文件。另外，还有一种描述模块行为的文本格式，方便人类阅读，这就是 Wat。虽然你可以手写文本格式的代码，但很少有人这样做。这种格式有时也被称为 &ldquo;Wast&rdquo;，但这是原名。很多工具都支持这两种写法，因此容易混淆。本书将使用 Wat 和它的后缀 .wat。</p>
<p>例 2-2 展示了一个完整的、有效的使用 Wat 表达的 Wasm 模块。它通过函数签名和堆栈机指令的集合来表示，类似于 Lisp 格式。WebAssembly 抽象机是一个虚拟堆栈机，在后面我们将对此进行详细解释。大多数编译后的软件都会被编译成特定硬件架构的可执行格式。例如，如果你的目标是 Intel x86 机器，那么代码将被编译为一系列的指令，可以在该芯片上运行。如果没有某种仿真器，它将无法在其他地方运行。平台如 Java 和.NET 有中间的字节码表示，这些字节码可以被解释并在各种平台的运行环境中执行。与此类似，WebAssembly 指令也具有类似的特征，但它通过对堆栈执行少量指令来实现目标。最后，当在 WebAssembly 主机中执行时，这些指令将被映射到特定芯片上的机器指令中。</p>
<p>例 2-2. 一个简单的 WebAssembly 文本文件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">(</span><span class="n">module</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">func</span> <span class="err">$</span><span class="n">how_old</span> <span class="p">(</span><span class="n">param</span> <span class="err">$</span><span class="n">year_now</span> <span class="n">i32</span><span class="p">)</span> <span class="p">(</span><span class="n">param</span> <span class="err">$</span><span class="n">year_born</span> <span class="n">i32</span><span class="p">)</span> <span class="p">(</span><span class="n">result</span> <span class="n">i32</span><span class="p">)</span> <span class="err">①</span>
</span></span><span class="line"><span class="cl">        <span class="n">local</span><span class="p">.</span><span class="n">get</span> <span class="err">$</span><span class="n">year_now</span> 
</span></span><span class="line"><span class="cl">        <span class="n">local</span><span class="p">.</span><span class="n">get</span> <span class="err">$</span><span class="n">year_born</span>
</span></span><span class="line"><span class="cl">        <span class="n">i32</span><span class="p">.</span><span class="n">sub</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">export</span> <span class="s">&#34;how_old&#34;</span> <span class="p">(</span><span class="n">func</span> <span class="err">$</span><span class="n">how_old</span><span class="p">))</span> <span class="err">②</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><ol>
<li>内部函数<code>$how_old</code>2. 导出的函数<code>how_old</code>在这里，函数被称为<code>$how_old</code>，直到明确导出它，它在模块外是不可见的。请注意命名方式的不同。内部命名以<code>$</code> 开头，而导出版本则没有。如果有人从外部调用它，它仅执行内部函数。</li>
</ol>
<p>本模块定义了一个接受两个整数参数并返回一个整数的函数。根据 MVP 的定义，WebAssembly 是一个 32 位环境 <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>。随着时间的推移，这种限制正在放松，在本书出版时，可能会有某种形式的 64 位 Wasm 环境（请参阅 <a href="https://github.com/WebAssembly/memory64" target="_blank" rel="noopener">Memory64 Proposal for WebAssembly</a>）。WebAssembly 支持 32 位和 64 位整数（分别称为 i32 和 i64）和 32 位和 64 位浮点数（分别称为 f32 和 f64）。</p>
<p>在 WebAssembly 层面上，没有我们熟悉的数据类型，例如字符串、对象、字典等。不用担心，在后面的章节中我们会讨论如何处理这些问题。这是我们不能编写典型的 &ldquo;Hello, World!&rdquo; 应用程序的原因之一。在我们开始介绍更多想法之前，我们仅处理数字，这样会更简单。因此，本书的风格是逐渐向你展示足够的知识，使你能够看到它的工作方式，而不会让你感到压抑。</p>
<p>这个内部函数用于计算一个人的年龄，根据他的出生年份和当前年份。WebAssembly 并不拥有日期概念，也无法请求当前时间，不过不用担心。它精通数学运算，如果给它当前年份和一个人的出生年份，它可以减去一个年份得出一个结果。我们把这些操作分开，是为了更清楚地知道系统的各部分功能。</p>
<p>堆栈是一种常用的数据结构，经常被比作一摞托盘，就像餐厅里的。工人会把干净的盘子放在其他盘子的顶部。客人可以从顶部取一个。</p>
<p>考虑一个空栈，如图 2-1 所示，我们说我们把某物品推到栈顶，然后从栈顶弹出。我们只对栈顶进行操作，所以如果需要遍历列表，堆栈并不是一个适合的数据结构。并且，只有一个位置可以找到我们感兴趣的东西，因此我们不需要指定位置、索引或键。这是一种快速且有效的操作结构。</p>
<p>















<figure  id="figure-图-2-1-一个空的堆栈">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../images/f2-1.png" alt="图 2-1. 一个空的堆栈" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      图 2-1. 一个空的堆栈
    </figcaption></figure>
</p>
<p>回顾一下例 2-2 函数中的指令列表。第一条是 <code>get_local</code>。WebAssembly 主机环境将检索名为 <code>$year_now</code> 的参数值，然后把它推到堆栈。假设现在的年份是 2021 年，结果如图 2-2 所示。</p>
<p>















<figure  id="figure-图-2-2-一个有一个值的堆栈">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../images/f2-2.png" alt="图 2-2. 一个有一个值的堆栈" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      图 2-2. 一个有一个值的堆栈
    </figcaption></figure>
</p>
<p>在这一点上，WebAssembly 主机环境将推进到第二个指令。这也是一条 <code>get_local</code> 指令，它将检索名为 <code>$year_born</code> 的参数值，并将其推到堆栈中。现在堆栈上有两个值，但堆栈的顶部指向推送的最新值。假设调用该函数的人是在 2000 年出生的，那么堆栈将看起来如图 2-3。</p>
<p>















<figure  id="figure-图-2-3-一个有两个值的堆栈">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../images/f2-3.png" alt="图 2-3. 一个有两个值的堆栈" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      图 2-3. 一个有两个值的堆栈
    </figcaption></figure>
</p>
<p>执行环境将继续，因为还有一条指令。这条指令是 <code>i32.sub</code>，它表示一个 i32 值减去另一个 i32 值的算术运算。由于它需要两个值才有意义，它将通过弹出栈上的两个值来查询，结果是一个空栈，看起来如图 2-1。然后，它用第一个参数减去第二个参数，并将结果推回堆栈的顶部。其结果如图 2-4。</p>
<p>















<figure  id="figure-图-2-4-推回堆栈的减法结果">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../images/f2-4.png" alt="图 2-4. 推回堆栈的减法结果" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      图 2-4. 推回堆栈的减法结果
    </figcaption></figure>
</p>
<p>在这一点上，没有更多的指令要执行，我们在堆栈的顶部只剩下一个值。在例 2-2 中，我们看到我们的函数定义了一个 i32 的返回值。无论堆栈顶部的是什么，都将作为调用函数的结果返回。</p>
<p>我们可能觉得为两个数相减做了太多工作，但实际上我们已经用平台中立的方式表达了一系列数学事件。当代码被转换成运行时主机的本地指令时，这些值会被加载到 CPU 寄存器中，一条指令就可以用 CPU 指令集的机械原理将它们相加。我们不用担心目标平台的细节或差异，因为转换过程会快速而简单，随时可以完成。但在此之前，我们需要将文本格式转换为它的二进制表示。</p>
<h2 id="将-wat-转换为-wasm">将 Wat 转换为 Wasm</h2>
<p>任何长期担任程序员的人都会注意到我们实施的所有潜在问题。 我们没有处理有人颠倒参数，使函数返回负数的情况。为了使示例简单，我们忽略这些现实。虽然这不是一个非常令人兴奋的功能，但我们已经了解了通过 WebAssembly 的原生文本格式表达一些基本行为的机制。 下一步是将其转换为二进制可执行形式。我们有多种选择，但我们将重点介绍两种方法。</p>
<p>第一种方法不需要您安装任何东西。 事实上，您可以继续调用您的函数，看看它是如何工作的！ 如果您访问<a href="https://webassembly.github.io/wabt/demo/wat2wasm/index.html" target="_blank" rel="noopener">在线 wat2wasm 演示</a>，您将看到一个多面板网站。 左上角代表一个 <code>.wat</code> 文件。 右上角代表编译后的 <code>.wat</code> 文件注释的十六进制转储。 左下角代表使用 API 调用行为的 JavaScript 代码，稍后我们将更全面地介绍它。右下角代表执行这段代码的输出。</p>
<p>将示例2-2 中的代码复制并粘贴到左上角的 WAT 面板中。这会将文本格式转换为二进制格式。假设您没有任何拼写错误，您还可以通过单击同一面板上的下载按钮来下载二进制格式。</p>
<p>现在将示例2-3 中的代码复制到左下方的窗格中。这将在大多数现代浏览器（和Node.js）中调用 WebAssembly  JavaScript  API。我们稍后会讨论这个，但现在我们正在提取二进制模块的字节（可通过 <code>wasmModule</code>  变量在此处获得）并获取对 <code>how_old</code> 函数的引用，以便我们可以调用它。如您所见，可以像调用任何其他 JavaScript 函数一样调用此函数。结果将通过 <code>console.log()</code> 打印在右下角的面板上。</p>
<p>例 2-3. 使用 JavaScript 调用我们的函数</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">wasmInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">Instance</span> <span class="p">(</span><span class="nx">wasmModule</span><span class="p">,</span> <span class="p">{});</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span><span class="nx">how_old</span><span class="p">}</span> <span class="o">=</span> <span class="nx">wasmInstance</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span><span class="nx">how_old</span> <span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">2000</span><span class="p">));</span>
</span></span></code></pre></div><p>如果一切顺利，您应该会看到类似于图 2-5 的内容。 尝试更改当前年份的日期和出生年份参数以确保您的计算正确。</p>
<p>















<figure  id="figure-图-2-5-将-webassembly-文本文件转换为二进制文件并执行它译者注图片比原著有更新">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../images/f2-5.png" alt="图 2-5. 将 WebAssembly 文本文件转换为二进制文件并执行它（译者注：图片比原著有更新）" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      图 2-5. 将 WebAssembly 文本文件转换为二进制文件并执行它（译者注：图片比原著有更新）
    </figcaption></figure>
</p>
<p>此时，您可以下载该文件的二进制版本。 默认情况下，它将被命名为 <code>test.wasm</code>，但您可以将其重命名为您喜欢的任何名称。 我们称之为 <code>hello.wasm</code>。</p>
<p>您还可以选择使用 WebAssembly Binary Toolkit（WABT）<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>来生成这种二进制形式。有关安装 WABT 和我们将在本书中使用的其他工具的说明，请参阅<a href="../apendix/">附录</a>。</p>
<p>此安装中包含一个名为 wat2wasm 的命令。 它的功能如其名，将文本文件转换为二进制格式：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt; wat2wasm hello.wat
</span></span><span class="line"><span class="cl">&gt; ls -alF
</span></span><span class="line"><span class="cl">total <span class="m">16</span>
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">4</span> brian  staff  <span class="m">128</span> Dec  <span class="m">7</span> 07:59 ./
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">6</span> brian  staff  <span class="m">192</span> Dec  <span class="m">7</span> 07:53 ../
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> brian  staff   <span class="m">45</span> Dec  <span class="m">7</span> 07:59 hello.wasm
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> brian  staff  <span class="m">200</span> Dec  <span class="m">7</span> 07:59 hello.wat
</span></span></code></pre></div><p>仔细观察。 你的眼睛没有骗你。 它的作用不大，但二进制格式只有 45 个字节长！ 之前写过很多 Java 程序，有些类名比这个还长。 现在我们需要一种方法来执行我们的功能，因为我们不在浏览器中。 使用 Node.js 中的 JavaScript API 很容易做到这一点，但我们将使用不同的方法来展示一系列选项。</p>
<h2 id="在-repl-中运行-wasm">在 Repl 中运行 Wasm</h2>
<p>我在<a href="../appendix/">附录</a>中向您展示了如何安装的另一个工具是 <a href="https://github.com/wasm3/wasm3" target="_blank" rel="noopener">wasm3</a>，它允许您在命令行上或通过通常称为 “repl”<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> 的交互模式运行 Wasm 模块和函数。</p>
<p>执行下面的命令后，你会收到 wasm3 提示符。 我将它指向我的 Wasm 文件，所以我只能调用一个函数，但如果模块中有其他导出函数，它们也可以工作。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt; wasm3 --repl hello.wasm
</span></span><span class="line"><span class="cl">wasm3&gt; how_old <span class="m">2021</span> <span class="m">2000</span>
</span></span><span class="line"><span class="cl">Result: <span class="m">21</span>
</span></span><span class="line"><span class="cl">wasm3&gt; how_old <span class="m">2021</span> <span class="m">1980</span>
</span></span><span class="line"><span class="cl">Result: <span class="m">41</span>
</span></span><span class="line"><span class="cl">wasm3&gt; <span class="nv">$how_old</span> <span class="m">2021</span> <span class="m">2000</span>
</span></span><span class="line"><span class="cl">Error: <span class="k">function</span> lookup failed <span class="o">(</span><span class="s1">&#39;$how_old&#39;</span><span class="o">)</span> wasm3&gt; how_old <span class="m">1980</span> <span class="m">2021</span>
</span></span><span class="line"><span class="cl">Result: <span class="m">4294967255</span>
</span></span><span class="line"><span class="cl">wasm3&gt;
</span></span></code></pre></div><p>请注意，我只能调用导出函数，不能调用内部函数。 另请注意，如果我们按预期颠倒参数的顺序，则会失败。当你用高级语言构建 Wasm 模块时，这些将使你更容易做正确的事情（尽管当然也可以在 <code>.wat</code> 文件中手动编写这种错误检查代码，但那太麻烦了）。 要退出 repl，您只需键入 Ctrl-C 或 Ctrl-D。</p>
<p>然而，让我们回顾一下我们刚刚做了什么。我们通过抽象机器的指令集来表达一些任意功能。我们在浏览器中运行它。 它应该适用于任何主要操作系统上的任何主要浏览器。好吧，JavaScript 也应该如此。 但我们也在 MacOS 机器上以交互模式运行的 C 可执行文件中运行它：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brian@tweezer ~/g/w/build&gt; file wasm3
</span></span><span class="line"><span class="cl">wasm3: Mach-O 64-bit executable x86_64
</span></span></code></pre></div><p>在这里，它在编译为 Linux 二进制文件的同一应用程序中运行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brian@bbfcfm:~/g/w/build&gt; wasm3 --repl <span class="nv">$HOME</span>/hello.wasm wasm3&gt; how_old <span class="m">2021</span> <span class="m">2000</span>
</span></span><span class="line"><span class="cl">Result: <span class="m">21</span>
</span></span><span class="line"><span class="cl">wasm3&gt; ^C
</span></span><span class="line"><span class="cl">brian@bbfcfm:~/g/w/build&gt; file wasm3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wasm3: ELF 64-bit LSB shared object, x86-64, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>,
</span></span><span class="line"><span class="cl">dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2,
</span></span><span class="line"><span class="cl">BuildID <span class="o">[</span>sha1<span class="o">]=</span>b5e98161d08d2d180d0725f973b338c2a340d015, <span class="k">for</span> GNU/Linux
</span></span><span class="line"><span class="cl">3.2.0, not stripped
</span></span></code></pre></div><p>事实上，有几个独立的 WebAssembly 环境是用 Python、Rust、Scala、OCaml、Ruby 等编写的。我们的功能应该能够在任何一个环境中使用和工作。</p>
<h2 id="在浏览器中运行-wasm">在浏览器中运行 Wasm</h2>
<p>对于我们的下一个演示，我将向您展示如何使用 JavaScript API 在浏览器中调用此行为。 我们不会介绍 API，但您会看到一个基本示例。有更复杂的模块编译和参数化方法，但首先我们学会爬行，然后才学会走路，最后是跑。</p>
<p>在示例 2-4 中，我们看到了一段用于实例化 WebAssembly 模块实例的可重用代码。 执行此操作的 JavaScript API 在任何支持 WebAssembly MVP 的环境中都可用，但还有其他不需要 JavaScript 的环境，例如我们刚刚使用的 wasm3 运行时。 但是，此代码将在任何支持 WebAssembly 的浏览器<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>或 Node.js 中运行。请注意，我们使用了基于 Promise 的方法。 如果你的 JavaScript 环境支持 async/await，显然也可以使用它们。</p>
<div class="alert-note-title">
    <p>提示</p>
</div>
<div class="alert alert-note">
    如果您的浏览器支持流式编译，则示例 2-4 中的代码不是实例化 WebAssembly 模块的首选方式。 我们现在将使用它，只是为了让您看到步骤，但我将在本书后面讨论首选方法。
</div>

<p>示例 2-4. 在 JavaScript 中实例化 Wasm 模块</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">fetchAndInstantiate</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">importObject</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">fetch</span> <span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span> <span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">response</span><span class="p">.</span><span class="nx">arrayBuffer</span> <span class="p">()).</span><span class="nx">then</span> <span class="p">(</span><span class="nx">bytes</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">importObject</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">).</span><span class="nx">then</span> <span class="p">(</span><span class="nx">results</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">results</span><span class="p">.</span><span class="nx">instance</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>一旦拥有此功能，在 HTML 中使用它就很简单了。在示例 2-5 中，您可以看到这个过程是如何工作的。</p>
<p>示例 2-5. 在网页上实例化 Wasm 组件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!doctype html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;bootstrap.min.css&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello, World! (Sort of)<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;utils.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello, World! (Sort of)<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      I think you are <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;age&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> years old.
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">fetchAndInstantiate</span> <span class="p">(</span><span class="s1">&#39;hello.wasm&#39;</span><span class="p">).</span><span class="nx">then</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">ho</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">how_old</span> <span class="p">(</span><span class="mi">2021</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">ageEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span> <span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ageEl</span><span class="p">.</span><span class="nx">innerText</span><span class="o">=</span><span class="nx">ho</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>在这个例子中，我们建立了一个 ID 为 age 的 <code>&lt;span&gt;</code>。它目前是空的。我们将用调用 WebAssembly 函数的结果来填充它。我们的 HTML 文件的其余部分并不奇怪。我们在<code>&lt;head&gt;</code>元素中包括可重复使用的实例化代码。在这个文件的底部，我们看到一个嵌入的 <code>&lt;script&gt;</code> 元素，它调用 <code>fetchAndInstantiate ()</code> 函数。它传入了对 <code>hello.wasm</code> 文件的本地引用，所以我们也必须通过 HTTP 提供这个文件。</p>
<p>该函数返回一个 <em>Promise</em>。我们会收到实例化的 Wasm 模块实例的副本，并可以调用通过模块的导出部分公开的方法。 请注意，我们正在传递 JavaScript 的数字字符，但这些数字会被函数识别和接受。 调用过程请求数字 21，然后将其存储在<span>我们之前讨论的空 <code>&lt;/span&gt;</code> 的 <code>innerText </code> 中。</p>
<p>我们必须通过 HTTP 提供 HTML、JavaScript 和 Wasm 模块，以便在浏览器中运行。 您可以根据需要多次尝试此操作，但是使用 python3（或非 Mac 电脑上的 python），您可以启动服务器并指定一个端口来接受连接：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brian@tweezer ~/g/w/s/ch02&gt; python3 -m http.server <span class="m">10003</span>
</span></span><span class="line"><span class="cl">Serving HTTP on :: port <span class="m">10003</span> <span class="o">(</span>http://<span class="o">[</span>::<span class="o">]</span>:10003/<span class="o">)</span> ...
</span></span></code></pre></div><p>如果打开浏览器并将其指向 <a href="http://localhost:10003/index.html" target="_blank" rel="noopener">http://localhost:10003/index.html</a>，您应该会看到类似于图 2-6 的内容。随意更改嵌入的 <code>&lt;script&gt;</code> 元素中的参数，并验证它是否继续工作。</p>
<p>















<figure  id="figure-图-2-6-在网页的-javascript-中调用导出的-webassembly-模块函数">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../images/f2-6.png" alt="图 2-6. 在网页的 JavaScript 中调用导出的 WebAssembly 模块函数" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      图 2-6. 在网页的 JavaScript 中调用导出的 WebAssembly 模块函数
    </figcaption></figure>
</p>
<p>显然我们还有很多东西要学，但你现在已经看到了类似于 “Hello, World!” 的示例。 希望您了解 WebAssembly 工作原理的基础知识。</p>
<h2 id="注释">注释</h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>包括大部分 WebAssembly 教程！&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>计决定的细节和他们对基本 WebAssembly 功能的动机都记录在 <a href="https://github.com/WebAssembly/design/blob/main/MVP.md" target="_blank" rel="noopener">GitHub</a> 上。&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>读作 wabbit，就像那个 wascal，Bugs Bunny（兔八哥）。&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>如果你从未使用过这样的环境，你应该看看 <a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop" target="_blank" rel="noopener">维基百科上的这个页面</a>。&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>你可以看到哪些浏览器环境支持 WebAssembly（或其他功能），请点击 &ldquo;<a href="https://caniuse.com/?search=WebAssembly" target="_blank" rel="noopener">Can I use&hellip;</a>&rdquo;&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/webassembly/">WebAssembly</a>
  
</div>



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/wasm-definitive-guide/introduction/" rel="next">
    <div class="meta-nav">上一页</div>
    <p>WabAssembly 简介</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/wasm-definitive-guide/wasm-modules/" rel="prev">
    <div class="meta-nav">下一页</div>
    <p>WebAssembly 模块</p></a>
  
</div>

          </div>
          

        <div class="body-footer">
          <p>最近更新于 2023-02-13</p>

          



          


  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    <script>
  let themeNumber = localStorage.getItem('wcTheme');
  var giscusTheme = "light";
  if (themeNumber == 1){
    giscusTheme = "dark";
  }
  console.log(giscusTheme)
  let giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-theme": giscusTheme,
    "data-repo":"rootsongjc/cloud-native-library",
    "data-repo-id":"MDEwOlJlcG9zaXRvcnkyMTQ2MjY2NDg=",
    "data-category":"Announcements",
    "data-category-id":"DIC_kwDODMrxWM4CPL7J",
    "data-mapping":"pathname",
    "data-reactions-enabled":"1",
    "data-emit-metadata":"0",
    "data-input-position":"top",
    "data-theme":giscusTheme,
    "data-lang":"zh-CN",
    "data-loading":"lazy",
    "crossorigin":"anonymous",
    "origins":"https://jimmysong.io",
    "originsRegex":"http://localhost:[0-9]+",
    "async": "",
  };

  let giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.querySelector('#comments').appendChild(giscusScript);
</script>

  </section>
  



          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2017-2023 jimmysong.io all rights reserved</p>
        </div>
    </div>
  </div>

</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  


<script src="/js/vendor-bundle.min.46271ef31da3f018e9cd1b59300aa265.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.24983018b0e5661cd5fe1822254286ea.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">引用</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> 复制
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> 下载
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

  <script src="/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>
<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
