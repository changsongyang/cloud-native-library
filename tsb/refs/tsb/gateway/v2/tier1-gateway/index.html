<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
    
    
    
  
  

  <meta name="author" content="宋净超" />

  
  
  
    
  
  <meta name="description" content="DEPRECATION: The functionality provided by the Tier1Gateway is now provided in Gateway object, and using it is the recommended approach. The Tier1Gateway resource will be removed in future releases.
Tier1Gateway configures a workload to act as a gateway that distributes traffic across one or more ingress gateways in other clusters.
NOTE: Tier1 gateways cannot be used to route traffic to the same cluster. A cluster with tier1 gateway cannot have any other gateways or workloads.
The following example declares a tier1 gateway running on pods with app: gateway labels in the ns1 namespace. The gateway exposes host movieinfo.com on ports 8080, 8443 and kafka." />

  
  <link rel="alternate" hreflang="zh" href="https://lib.jimmysong.io/tsb/refs/tsb/gateway/v2/tier1-gateway/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.2c25b2854625561177dfe556e1065970.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-MP490FS739"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-MP490FS739");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a4b7f65b1839466beaa48d633aa60c1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hud79519197c2c386463324871b321d647_6772_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hud79519197c2c386463324871b321d647_6772_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://lib.jimmysong.io/tsb/refs/tsb/gateway/v2/tier1-gateway/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@jimmysongio" />
    <meta property="twitter:creator" content="@jimmysongio" />
  
  <meta property="og:site_name" content="云原生资料库" />
  <meta property="og:url" content="https://lib.jimmysong.io/tsb/refs/tsb/gateway/v2/tier1-gateway/" />
  <meta property="og:title" content="Tier1 Gateway | 云原生资料库" />
  <meta property="og:description" content="DEPRECATION: The functionality provided by the Tier1Gateway is now provided in Gateway object, and using it is the recommended approach. The Tier1Gateway resource will be removed in future releases.
Tier1Gateway configures a workload to act as a gateway that distributes traffic across one or more ingress gateways in other clusters.
NOTE: Tier1 gateways cannot be used to route traffic to the same cluster. A cluster with tier1 gateway cannot have any other gateways or workloads.
The following example declares a tier1 gateway running on pods with app: gateway labels in the ns1 namespace. The gateway exposes host movieinfo.com on ports 8080, 8443 and kafka." /><meta property="og:image" content="https://lib.jimmysong.io/media/sharing.png" />
    <meta property="twitter:image" content="https://lib.jimmysong.io/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2023-08-09T12:00:00&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2024-03-06T15:17:26&#43;08:00">
  

  



  

  

  





  <title>Tier1 Gateway | 云原生资料库</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#books"><span>图书</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>教程</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/kubernetes-handbook"><span>Kubernetes 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/istio-fundamentals-zh"><span>Istio 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh"><span>Envoy 基础教程</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://jimmysong.io/blog/" target="_blank" rel="noopener"><span>博客</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://cloudnative.to/" target="_blank" rel="noopener"><span>社区</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://jimmysong.io/contact/" data-toggle="tooltip" data-placement="bottom" title="联系" target="_blank" rel="noopener" aria-label="联系">
                <i class="fab fa-weixin" aria-hidden="true"></i>
              </a>
            </li>
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/jimmysongio" data-toggle="tooltip" data-placement="bottom" title="关注" target="_blank" rel="noopener" aria-label="关注">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        <li class="nav-item">
            <a class="nav-link" href="https://jimmysong.io" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="首页" aria-label="首页"><i class="fas fa-home" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          tsb
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">目录</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#tetrateio-api-tsb-gateway-v2-tier1externalserver">Tier1ExternalServer</a></li>
    <li><a href="#tetrateio-api-tsb-gateway-v2-tier1gateway">Tier1Gateway</a></li>
    <li><a href="#tetrateio-api-tsb-gateway-v2-tier1internalserver">Tier1InternalServer</a></li>
    <li><a href="#tetrateio-api-tsb-gateway-v2-tier1passthroughserver">Tier1PassthroughServer</a></li>
    <li><a href="#tetrateio-api-tsb-gateway-v2-tier1tcpexternalserver">Tier1TCPExternalServer</a></li>
    <li><a href="#tetrateio-api-tsb-gateway-v2-tier1tcpinternalserver">Tier1TCPInternalServer</a></li>
  </ul>
</nav>

      

    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          
            
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
    
  
    
  
    
  
    
  

    <li class="breadcrumb-item">
      <a href="/">
        
          首页
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/tsb/">
        
          TSB 手册
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/tsb/refs/">
        
          API
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/tsb/refs/tsb/">
        
          tsb
        
      </a>
    </li>
  

      <li class="breadcrumb-item active" aria-current="page">
        Tier1 Gateway
      </li>
    </ol>
  </nav>




          

          <h1>Tier1 Gateway</h1>

          <div class="article-style">
            <!-- WARNING: This page is generated. Please take a look at extensions/plugin-service-bridge-api-docs/src/files/doc/page.ejs -->
<p>DEPRECATION: The functionality provided by the <code>Tier1Gateway</code> is now provided in <code>Gateway</code> object, and
using it is the recommended approach. The <code>Tier1Gateway</code> resource will be removed in future releases.</p>
<p><code>Tier1Gateway</code> configures a workload to act as a gateway that
distributes traffic across one or more ingress gateways in other
clusters.</p>
<p><strong>NOTE:</strong> Tier1 gateways cannot be used to route traffic to the
same cluster. A cluster with tier1 gateway cannot have any other
gateways or workloads.</p>
<p>The following example declares a tier1 gateway running on pods with
<code>app: gateway</code> labels in the <code>ns1</code> namespace. The gateway exposes
host <code>movieinfo.com</code> on ports 8080, 8443 and <code>kafka.internal</code> on port 9000.
Traffic for these hosts at the ports 8443 and 9000 are TLS terminated and
forwarded over Istio mutual TLS to the ingress gateways hosting
<code>movieinfo.com</code> host on clusters <code>c3</code> and <code>c4</code> and the internal
<code>kafka.internal</code> service in cluster <code>c3</code> respectively. The server at
port 8080 is configured to receive plaintext HTTP traffic and redirect
to port 8443 with &ldquo;Permanently Moved&rdquo; (HTTP 301) status code.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.tsb.tetrate.io/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Tier1Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tier1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">g1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workspace</span><span class="p">:</span><span class="w"> </span><span class="l">w1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l">mycompany</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l">myorg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workloadSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">externalServers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo-plain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo.com</span><span class="w"> </span><span class="c"># Plaintext and HTTPS redirect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">redirect</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">authority</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">redirectCode</span><span class="p">:</span><span class="w"> </span><span class="m">301</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo.com</span><span class="w"> </span><span class="c"># TLS termination and Istio mTLS to upstream</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">SIMPLE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo-secrets</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">c3</span><span class="w"> </span><span class="c"># the target gateway IPs will be automatically determined</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">90</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">c4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">authentication</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">jwt</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;auth.mycompany.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">jwksUri</span><span class="p">:</span><span class="w"> </span><span class="l">https://auth.mycompany.com/oauth2/jwks</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;auth.othercompany.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">jwksUri</span><span class="p">:</span><span class="w"> </span><span class="l">https://auth.othercompany.com/oauth2/jwks</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">authorization</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">external</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://auth.company.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">includeRequestHeaders</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">authorization</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tcpExternalServers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kafka</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">kafka.internal</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">SIMPLE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">kafka-cred</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">c3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></span></span></code></pre></div><p>Tier1 gateways can also be used to forward mesh internal traffic
for Gateway hosts from one cluster to another. This form of
forwarding will work only if the two clusters cannot reach each
other directly (e.g., they are on different VPCs that are not
peered). The following example declares a tier1 gateway running on
pods with <code>app: gateway</code> labels in the <code>ns1</code> namespace. The gateway
exposes hosts <code>movieinfo.com</code>, <code>bookinfo.com</code>, and a non-HTTP server
called <code>kafka.org-internal</code> within the mesh. Traffic to <code>movieinfo.com</code>
is load balanced across all clusters on <code>vpc-02</code>, while traffic to
<code>bookinfo.com</code> and <code>kafka.org-internal</code> is load balanced across ingress
gateways exposing <code>bookinfo.com</code> on any cluster. Traffic from the source
(sidecars) is expected to arrive on the tier1 gateway over Istio mTLS.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.tsb.tetrate.io/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Tier1Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tier1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">g1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workspace</span><span class="p">:</span><span class="w"> </span><span class="l">w1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l">mycompany</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l">myorg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workloadSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">internalServers</span><span class="p">:</span><span class="w"> </span><span class="c"># forwarding gateway (HTTP traffic only)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">network</span><span class="p">:</span><span class="w"> </span><span class="l">vpc-02</span><span class="w"> </span><span class="c"># the target gateway IPs will be automatically determined</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">authentication</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">jwt</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;auth.mycompany.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">jwksUri</span><span class="p">:</span><span class="w"> </span><span class="l">https://auth.company.com/oauth2/jwks</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">issuer</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;auth.othercompany.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">jwksUri</span><span class="p">:</span><span class="w"> </span><span class="l">https://auth.othercompany.com/oauth2/jwks</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">authorization</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">external</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://auth.company.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">includeRequestHeaders</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">authorization</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">bookinfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">bookinfo.com</span><span class="w"> </span><span class="c"># route to any ingress gateway exposing bookinfo.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tcpInternalServers</span><span class="p">:</span><span class="w"> </span><span class="c"># forwarding non-HTTP traffic within the mesh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kafka</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">kafka.org-internal</span><span class="w">
</span></span></span></code></pre></div><p>** NOTE:** If two clusters have direct connectivity, declaring
a tier1 internal server will have no effect.</p>
<p>Tier1 gateways can also be configured to expose hostnames in the
TLS passthrough mode. Tier1 gateway will forward the pasthrough server traffic to
any tier2 pass through servers exposing the same hostname. In other words,
To be able to leverage passthrough at tier1, it is a MUST that passthrough is configured
at t2 IngressGateway as well.</p>
<p>** NOTE:** A hostname like <code>abc.com</code> can only be exposed either in passthrough mode OR
in terminating tls mode(External/Internal servers), not in both the modes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.tsb.tetrate.io/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Tier1Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tier1-tls-gw</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">g1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workspace</span><span class="p">:</span><span class="w"> </span><span class="l">w1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l">mycompany</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l">myorg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workloadSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">passthroughServers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.example.com</span><span class="w">
</span></span></span></code></pre></div><p>The Tier1Gateway above will require the corresponding, at least one or more, IngressGateway(s), e.g.:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.tsb.tetrate.io/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">IngressGateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tls-gw</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">g1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workspace</span><span class="p">:</span><span class="w"> </span><span class="l">w1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l">mycompany</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l">myorg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workloadSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tlsPassthrough</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">route</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;ns1/my-nginx.default.svc.cluster.local&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span></code></pre></div><p>The following example customizes the <code>Extensions</code> field to enable
the execution of the specified WasmExtensions list and details
custom properties for the execution of each extension.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.tsb.tetrate.io/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Tier1Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tier1-tls-gw</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">g1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workspace</span><span class="p">:</span><span class="w"> </span><span class="l">w1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l">mycompany</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l">myorg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workloadSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">externalServers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo-plain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo.com</span><span class="w"> </span><span class="c"># Plaintext and HTTPS redirect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">redirect</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">authority</span><span class="p">:</span><span class="w"> </span><span class="l">movieinfo.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">redirectCode</span><span class="p">:</span><span class="w"> </span><span class="m">301</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">extension</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">fqn</span><span class="p">:</span><span class="w"> </span><span class="l">hello-world</span><span class="w"> </span><span class="c"># fqn of imported extensions in TSB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">foo</span><span class="p">:</span><span class="w"> </span><span class="l">bar</span><span class="w">
</span></span></span></code></pre></div><p>Whenever traffic is to be sent from one cluster to another, one or more of
the following would have to be true for it to succeed:</p>
<ul>
<li>Both clusters belong to the same network.</li>
<li>Destination cluster network is not named.</li>
<li><a href="https://docs.tetrate.io/service-bridge/en-us/refs/tsb/v2/organization_setting#organizationsetting" target="_blank" rel="noopener">Organization Setting</a>
is set up to send traffic from source cluster to destination cluster.</li>
</ul>
<p><code>Tier1Gateway</code> also allows you to apply ModSecurity/Coraza compatible Web
Application Firewall rules to traffic passing through the gateway.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.xcp.tetrate.io/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Tier1Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tier1-waf-gw</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">g1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workspace</span><span class="p">:</span><span class="w"> </span><span class="l">w1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l">mycompany</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l">myorg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workloadSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">passthroughServers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">waf</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">Include @owasp_crs/*.conf</span><span class="w">
</span></span></span></code></pre></div><h2 id="tetrateio-api-tsb-gateway-v2-tier1externalserver">Tier1ExternalServer</h2>
<p>Tier1ExternalServer describes the properties of a server exposed
outside the mesh. Traffic arriving at a Tier1 external server is
usually TLS terminated and then forwarded over Istio mTLS to all
the lower tier2 clusters.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>name</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> A name assigned to the server. The name will be visible in the generated metrics. The name must be
unique across all external servers in the gateway.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>port</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">uint32</a> <br/> <em>REQUIRED</em> <br/> The port where the server is exposed. Note that port 15443 is reserved.</p>
</td>
<td>
<p>uint32 = {<br/>  not_in: <code>0,15443</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>hostname</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> Hostname with which the service can be expected to be accessed by
clients.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>tls</p>
</td>
<td>
<p><a href="../../../tsb/gateway/v2/gateway_common#tetrateio-api-tsb-gateway-v2-servertlssettings">tetrateio.api.tsb.gateway.v2.ServerTLSSettings</a> <br/> TLS certificate info. The gateway will terminate the TLS
connection and forward it to the upstream ingress gateway using
Istio mutual TLS on port 15443.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>clusters</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/gateway_common#tetrateio-api-tsb-gateway-v2-clusterdestination">tetrateio.api.tsb.gateway.v2.ClusterDestination</a> <br/> The destination clusters that contain ingress gateways exposing
the hostname. If omitted, traffic will be automatically load
balanced across all tier2 clusters whose ingress gateways expose
the above hostname. If <code>redirect</code> is configured then this field
cannot be configured.
To do failover and locality based routing among clusters, either omit
the clusters field or omit the weights from all the cluster destinations.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>redirect</p>
</td>
<td>
<p><a href="../../../tsb/gateway/v2/gateway_common#tetrateio-api-tsb-gateway-v2-redirect">tetrateio.api.tsb.gateway.v2.Redirect</a> <br/> Redirect allows configuring HTTP redirect. When this is
configured, the <code>clusters</code> field cannot be configured.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>authentication</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authentication">tetrateio.api.tsb.auth.v2.Authentication</a> <br/> Authentication is used to configure the authentication of end-user
credentials like JWT. It is highly recommended to configure this with TLS</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>authorization</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authorization">tetrateio.api.tsb.auth.v2.Authorization</a> <br/> Authorization is used to configure authorization of end users. It
is highly recommended to configure this with TLS</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>rateLimiting</p>
</td>
<td>
<p><a href="../../../tsb/gateway/v2/gateway_common#tetrateio-api-tsb-gateway-v2-ratelimiting">tetrateio.api.tsb.gateway.v2.RateLimiting</a> <br/> Configuration for rate limiting requests. This configuration is namespaced to a Tier1ExternalServer</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-gateway-v2-tier1gateway">Tier1Gateway</h2>
<p><code>Tier1Gateway</code> configures a workload to act as a tier1 gateway into the mesh.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>workloadSelector</p>
</td>
<td>
<p><a href="../../../tsb/types/v2/types#tetrateio-api-tsb-types-v2-workloadselector">tetrateio.api.tsb.types.v2.WorkloadSelector</a> <br/> <em>REQUIRED</em> <br/> Specify the gateway workloads (pod labels and Kubernetes
namespace) under the gateway group that should be configured with
this gateway. There can be only one gateway for a workload selector in a namespace.</p>
</td>
<td>
<p>message = {<br/>  required: <code>true</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>externalServers</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/tier1_gateway#tetrateio-api-tsb-gateway-v2-tier1externalserver">tetrateio.api.tsb.gateway.v2.Tier1ExternalServer</a> <br/> One or more servers exposed by the gateway externally.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>internalServers</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/tier1_gateway#tetrateio-api-tsb-gateway-v2-tier1internalserver">tetrateio.api.tsb.gateway.v2.Tier1InternalServer</a> <br/> One or more servers exposed by the gateway internally for cross cluster forwarding.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>passthroughServers</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/tier1_gateway#tetrateio-api-tsb-gateway-v2-tier1passthroughserver">tetrateio.api.tsb.gateway.v2.Tier1PassthroughServer</a> <br/> One or more tls passthrough servers exposed by the gateway externally.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>tcpExternalServers</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/tier1_gateway#tetrateio-api-tsb-gateway-v2-tier1tcpexternalserver">tetrateio.api.tsb.gateway.v2.Tier1TCPExternalServer</a> <br/> One or more tcp servers exposed by the gateway externally.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>tcpInternalServers</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/tier1_gateway#tetrateio-api-tsb-gateway-v2-tier1tcpinternalserver">tetrateio.api.tsb.gateway.v2.Tier1TCPInternalServer</a> <br/> One or more tcp servers exposed by the gateway for mesh internal traffic.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>extension</p>
</td>
<td>
<p>List of <a href="../../../tsb/types/v2/types#tetrateio-api-tsb-types-v2-wasmextensionattachment">tetrateio.api.tsb.types.v2.WasmExtensionAttachment</a> <br/> Extensions specifies all the WasmExtensions assigned to this Tier1Gateway
with the specific configuration for each extension. This custom configuration
will override the one configured globally to the extension.
Each extension has a global configuration including enablement and priority
that will condition the execution of the assigned extensions.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>waf</p>
</td>
<td>
<p><a href="../../../tsb/security/v2/waf_settings#tetrateio-api-tsb-security-v2-wafsettings">tetrateio.api.tsb.security.v2.WAFSettings</a> <br/> WAF settings to be enabled for traffic passing through this Tier1 gateway.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>configGenerationMetadata</p>
</td>
<td>
<p><a href="../../../tsb/types/v2/types#tetrateio-api-tsb-types-v2-configgenerationmetadata">tetrateio.api.tsb.types.v2.ConfigGenerationMetadata</a> <br/> Metadata values that will be add into the Istio generated configurations.
When using YAML APIs like<code>tctl</code> or <code>gitops</code>, put them into the <code>metadata.labels</code> or
<code>metadata.annotations</code> instead.
This field is only necessary when using gRPC APIs directly.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-gateway-v2-tier1internalserver">Tier1InternalServer</h2>
<p>Tier1InternalServer describes the properties of a server exposed
within the mesh, for the purposes of forwarding traffic between two
clusters that cannot otherwise directly reach each other. Traffic
arriving at a Tier1 internal server should be over Istio
mTLS. After TLS termination and metrics extraction, it is forwarded
to tier2 clusters based on the selection criteria.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>name</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> A name assigned to the server. The name will be visible in the generated metrics. The name must be
unique across all internal servers in the gateway.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>hostname</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> Hostname with which the service can be expected to be accessed by
sidecars in the mesh.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>clusters</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/gateway_common#tetrateio-api-tsb-gateway-v2-clusterdestination">tetrateio.api.tsb.gateway.v2.ClusterDestination</a> <br/> The destination clusters that contain ingress gateways exposing
the hostname. If omitted, traffic will be automatically load
balanced across all tier2 clusters whose ingress gateways expose
the above hostname.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>authentication</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authentication">tetrateio.api.tsb.auth.v2.Authentication</a> <br/> Authentication is used to configure the authentication of end-user
credentials like JWT.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>authorization</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authorization">tetrateio.api.tsb.auth.v2.Authorization</a> <br/> Authorization is used to configure authorization of end user and traffic.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-gateway-v2-tier1passthroughserver">Tier1PassthroughServer</h2>
<p>Tier1PassthroughServer describes the properties of a server exposed
to the external world. Traffic arriving at a Tier1 passthrough server is
not TLS terminated and rather forwarded over to all the lower tier2 clusters.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>name</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> A name assigned to the server. The name will be visible in the generated metrics. The name must be
unique across all external servers in the gateway.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>port</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">uint32</a> <br/> <em>REQUIRED</em> <br/> The port where the server is exposed. Note that port 15443 is reserved.</p>
</td>
<td>
<p>uint32 = {<br/>  not_in: <code>0,15443</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>hostname</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> Hostname with which the service can be expected to be accessed by
clients.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>clusters</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/gateway_common#tetrateio-api-tsb-gateway-v2-clusterdestination">tetrateio.api.tsb.gateway.v2.ClusterDestination</a> <br/> The destination clusters that contain ingress gateways exposing
the hostname on passthrough servers. If omitted, traffic will be automatically load
balanced across all tier2 clusters whose ingress gateways expose
the above hostname.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-gateway-v2-tier1tcpexternalserver">Tier1TCPExternalServer</h2>
<p>Tier1TCPExternalServer is used to describe the properties of a TCP server
(used for opaque TCP or non-HTTP protocols) exposed to the external world.
If the protocol is known to be HTTP, then please use <code>externalServers</code> as
it allows using HTTP-specific features.</p>
<p>Caveat - Currently, we don&rsquo;t support multicluster routing when Tier2 gateway
settings are specified in the direct mode for TCP services. So please use
the bridged mode.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>name</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> A name assigned to the server. This name is used in the generated metrics. The name
must be unique across all TCP servers in the gateway</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>port</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">uint32</a> <br/> <em>REQUIRED</em> <br/> The port where the server is exposed. Note that the port 15443 is reserved. Also
beware of the conflict among the services using different protocols on the same port.
The conflict occurs in the following scenarios</p>
<ol>
<li>Using plaintext and TLS (passthrough/termination)</li>
<li>Mixing multiple protocols without TLS (HTTP and non-HTTP protocols like Kafka, Zookeeper etc)</li>
<li>Multiple non-HTTP protocols without TLS</li>
</ol>
<p>Valid scenarios (for same port, multiple services)</p>
<ol>
<li>Multiple protocols (HTTP, non-HTTP) with TLS passthrough/termination</li>
<li>Multiple HTTP services</li>
<li>Single non-HTTP service without TLS</li>
</ol>
<p>Note on service port - If a service is exposed on port 6789 in the tier1 gateway,
then it must be exposed on the same port with the same hostname (without wildcard)
in the tier2 gateway as well.</p>
</td>
<td>
<p>uint32 = {<br/>  not_in: <code>0,15443</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>hostname</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> Although hostname or authority does not make sense in the non-HTTP context, this
is used to define the routing rules. Wildcard hostnames are not yet supported.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>clusters</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/gateway_common#tetrateio-api-tsb-gateway-v2-clusterdestination">tetrateio.api.tsb.gateway.v2.ClusterDestination</a> <br/> The destination clusters contain ingress gateways exposing the service.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>tls</p>
</td>
<td>
<p><a href="../../../tsb/gateway/v2/gateway_common#tetrateio-api-tsb-gateway-v2-servertlssettings">tetrateio.api.tsb.gateway.v2.ServerTLSSettings</a> <br/> TLS certificate information to terminate TLS. If passthrough is required, then please
use <code>passthroughServers</code> to specify them.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-gateway-v2-tier1tcpinternalserver">Tier1TCPInternalServer</h2>
<p>Tier1TCPInternalServer is used to describe the properties of a TCP server
which is used exclusively within the mesh.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>name</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> A name assigned to the server. This name is used in the generated metrics. The name
must be unique across all TCP servers in the gateway.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>hostname</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> The name of the service used. Although hostname or authority does not make sense
in the non-HTTP context, this is used for the multicluster routing purposes. Consider
the case where there are two non-HTTP services listening on the same port 6000,
but are hosted on different workloads. Here, the service name is used to distinguish
between the two for routing to the correct workload. We do not support wildcard hostnames
yet. The ports are determined automatically by the cluster updates of the remote edge
clusters. Suppose there is a service called <code>foo.com</code> and the remote cluster says that
it exposes ports 8080 and 8443, then we can route east-west traffic for both the ports
through this server. The changes to the port or protocol settings are picked up automatically.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>clusters</p>
</td>
<td>
<p>List of <a href="../../../tsb/gateway/v2/gateway_common#tetrateio-api-tsb-gateway-v2-clusterdestination">tetrateio.api.tsb.gateway.v2.ClusterDestination</a> <br/> The destination clusters contain ingress gateways exposing the service.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>

          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/tsb/">TSB</a>
  
</div>



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/tsb/refs/tsb/v2/tenant-setting/" rel="next">
    <div class="meta-nav">上一页</div>
    <p>Tenant Setting</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/tsb/refs/tsb/rbac/v2/traffic-access-bindings/" rel="prev">
    <div class="meta-nav">下一页</div>
    <p>Traffic Access Bindings</p></a>
  
</div>

          </div>
          

        <div class="body-footer">
          <p>最近更新于 2024-03-06</p>

          





  

<p class="edit-page">
  <a href="https://github.com/rootsongjc/cloud-native-library//edit/master/content/tsb/refs/tsb/gateway/v2/tier1-gateway.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>



          




          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2017-2024 jimmysong.io all rights reserved</p>
        </div>
    </div>
  </div>

</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  


<script src="/js/vendor-bundle.min.5b2c48a98fb93f10e8d01cff2874cdf3.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.a04788cdfce708339d31c0685377d64e.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">引用</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> 复制
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> 下载
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

  <script src="/js/wowchemy-publication.af9327db0521d4a01354bfc8b77a4324.js" type="module"></script>
<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
