<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
    
    
    
  
  

  <meta name="author" content="宋净超" />

  
  
  
    
  
  <meta name="description" content="Authentication and authorization configs at gateways, security group level
Authentication Field Description Validation Rule jwt
tetrateio.api.tsb.auth.v2.Authentication.JWT oneof authn Authenticate an HTTP request from a JWT Token attached to it.
–
rules
tetrateio.api.tsb.auth.v2.Authentication.Rules oneof authn List of rules how to authenticate an HTTP request.
–
JWT Field Description Validation Rule issuer
string REQUIRED Identifies the issuer that issued the JWT. See issuer A JWT with different iss claim will be rejected.
Example: https://foobar.auth0.com Example: 1234567-compute@developer.gserviceaccount.com
string = { min_len: 1}
audiences
List of string The list of JWT audiences. that are allowed to access. A JWT containing any of these audiences will be accepted." />

  
  <link rel="alternate" hreflang="zh" href="https://lib.jimmysong.io/tsb/refs/tsb/auth/v2/auth/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.2c25b2854625561177dfe556e1065970.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-MP490FS739"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-MP490FS739");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a4b7f65b1839466beaa48d633aa60c1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hud79519197c2c386463324871b321d647_6772_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hud79519197c2c386463324871b321d647_6772_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://lib.jimmysong.io/tsb/refs/tsb/auth/v2/auth/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@jimmysongio" />
    <meta property="twitter:creator" content="@jimmysongio" />
  
  <meta property="og:site_name" content="云原生资料库" />
  <meta property="og:url" content="https://lib.jimmysong.io/tsb/refs/tsb/auth/v2/auth/" />
  <meta property="og:title" content="Auth | 云原生资料库" />
  <meta property="og:description" content="Authentication and authorization configs at gateways, security group level
Authentication Field Description Validation Rule jwt
tetrateio.api.tsb.auth.v2.Authentication.JWT oneof authn Authenticate an HTTP request from a JWT Token attached to it.
–
rules
tetrateio.api.tsb.auth.v2.Authentication.Rules oneof authn List of rules how to authenticate an HTTP request.
–
JWT Field Description Validation Rule issuer
string REQUIRED Identifies the issuer that issued the JWT. See issuer A JWT with different iss claim will be rejected.
Example: https://foobar.auth0.com Example: 1234567-compute@developer.gserviceaccount.com
string = { min_len: 1}
audiences
List of string The list of JWT audiences. that are allowed to access. A JWT containing any of these audiences will be accepted." /><meta property="og:image" content="https://lib.jimmysong.io/media/sharing.png" />
    <meta property="twitter:image" content="https://lib.jimmysong.io/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2023-08-09T12:00:00&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2024-03-06T15:17:26&#43;08:00">
  

  



  

  

  





  <title>Auth | 云原生资料库</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#books"><span>图书</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>教程</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/kubernetes-handbook"><span>Kubernetes 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/istio-fundamentals-zh"><span>Istio 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh"><span>Envoy 基础教程</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://jimmysong.io/blog/" target="_blank" rel="noopener"><span>博客</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://cloudnative.to/" target="_blank" rel="noopener"><span>社区</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://jimmysong.io/contact/" data-toggle="tooltip" data-placement="bottom" title="联系" target="_blank" rel="noopener" aria-label="联系">
                <i class="fab fa-weixin" aria-hidden="true"></i>
              </a>
            </li>
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/jimmysongio" data-toggle="tooltip" data-placement="bottom" title="关注" target="_blank" rel="noopener" aria-label="关注">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        <li class="nav-item">
            <a class="nav-link" href="https://jimmysong.io" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="首页" aria-label="首页"><i class="fas fa-home" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          tsb
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">目录</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#tetrateio-api-tsb-auth-v2-authentication">Authentication</a>
      <ul>
        <li><a href="#tetrateio-api-tsb-auth-v2-authentication-jwt">JWT</a></li>
        <li><a href="#tetrateio-api-tsb-auth-v2-authentication-rules">Rules</a></li>
      </ul>
    </li>
    <li><a href="#tetrateio-api-tsb-auth-v2-authorization">Authorization</a>
      <ul>
        <li><a href="#tetrateio-api-tsb-auth-v2-authorization-externalauthzbackend">ExternalAuthzBackend</a></li>
        <li><a href="#tetrateio-api-tsb-auth-v2-authorization-localauthz">LocalAuthz</a></li>
      </ul>
    </li>
    <li><a href="#tetrateio-api-tsb-auth-v2-clienttlssettings">ClientTLSSettings</a></li>
    <li><a href="#tetrateio-api-tsb-auth-v2-localauthzrule">LocalAuthzRule</a>
      <ul>
        <li><a href="#tetrateio-api-tsb-auth-v2-localauthzrule-httpoperation">HttpOperation</a></li>
      </ul>
    </li>
    <li><a href="#tetrateio-api-tsb-auth-v2-subject">Subject</a>
      <ul>
        <li><a href="#tetrateio-api-tsb-auth-v2-subject-jwtclaims">JWTClaims</a></li>
      </ul>
    </li>
    <li><a href="#tetrateio-api-tsb-auth-v2-tlsfilesource">TLSFileSource</a></li>
    <li><a href="#tetrateio-api-tsb-auth-v2-tlsmode">TLSMode</a></li>
  </ul>
</nav>

      

    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          
            
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
    
  
    
  
    
  
    
  

    <li class="breadcrumb-item">
      <a href="/">
        
          首页
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/tsb/">
        
          TSB 手册
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/tsb/refs/">
        
          API
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/tsb/refs/tsb/">
        
          tsb
        
      </a>
    </li>
  

      <li class="breadcrumb-item active" aria-current="page">
        Auth
      </li>
    </ol>
  </nav>




          

          <h1>Auth</h1>

          <div class="article-style">
            <!-- WARNING: This page is generated. Please take a look at extensions/plugin-service-bridge-api-docs/src/files/doc/page.ejs -->
<p>Authentication and authorization configs at gateways, security group level</p>
<h2 id="tetrateio-api-tsb-auth-v2-authentication">Authentication</h2>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>jwt</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authentication-jwt">tetrateio.api.tsb.auth.v2.Authentication.JWT</a> <em><sup><a href="https://developers.google.com/protocol-buffers/docs/proto3#oneof" target="_blank">oneof</a> authn</sup></em> <br/> Authenticate an HTTP request from a JWT Token attached to it.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>rules</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authentication-rules">tetrateio.api.tsb.auth.v2.Authentication.Rules</a> <em><sup><a href="https://developers.google.com/protocol-buffers/docs/proto3#oneof" target="_blank">oneof</a> authn</sup></em> <br/> List of rules how to authenticate an HTTP request.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h3 id="tetrateio-api-tsb-auth-v2-authentication-jwt">JWT</h3>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>issuer</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> Identifies the issuer that issued the JWT. See
<a href="https://tools.ietf.org/html/rfc7519#section-4.1.1" target="_blank" rel="noopener">issuer</a>
A JWT with different <code>iss</code> claim will be rejected.</p>
<p>Example: <a href="https://foobar.auth0.com" target="_blank" rel="noopener">https://foobar.auth0.com</a>
Example: <a href="mailto:1234567-compute@developer.gserviceaccount.com">1234567-compute@developer.gserviceaccount.com</a></p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>audiences</p>
</td>
<td>
<p>List of <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> The list of JWT
<a href="https://tools.ietf.org/html/rfc7519#section-4.1.3" target="_blank" rel="noopener">audiences</a>.
that are allowed to access. A JWT containing any of these
audiences will be accepted.</p>
<p>The service name will be accepted if audiences is empty.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>jwksUri</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <em><sup><a href="https://developers.google.com/protocol-buffers/docs/proto3#oneof" target="_blank">oneof</a> keys</sup></em> <br/> URL of the provider&rsquo;s public key set to validate signature of
the JWT. See <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata" target="_blank" rel="noopener">OpenID
Discovery</a>.</p>
<p>Optional if the key set document can either (a) be retrieved
from <a href="https://openid.net/specs/openid-connect-discovery-1_0.html" target="_blank" rel="noopener">OpenID
Discovery</a>
of the issuer or (b) inferred from the email domain of the
issuer (e.g. a Google service account).</p>
<p>Example: <code>https://www.googleapis.com/oauth2/v1/certs</code></p>
<p>Note: Only one of jwks_uri and jwks should be used. jwks_uri
will be ignored if it does.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>jwks</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <em><sup><a href="https://developers.google.com/protocol-buffers/docs/proto3#oneof" target="_blank">oneof</a> keys</sup></em> <br/> JSON Web Key Set of public keys to validate signature of the JWT.
See <a href="https://auth0.com/docs/jwks" target="_blank" rel="noopener">https://auth0.com/docs/jwks</a>.</p>
<p>Note: Only one of jwks_uri and jwks should be used. jwks_uri will be ignored if it does.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>outputPayloadToHeader</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> This field specifies the header name to output a successfully verified JWT payload to the
backend. The forwarded data is <code>base64_encoded(jwt_payload_in_JSON)</code>. If it is not specified,
the payload will not be emitted.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>outputClaimToHeaders</p>
</td>
<td>
<p>List of <a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authentication-jwt-claimtoheader">tetrateio.api.tsb.auth.v2.Authentication.JWT.ClaimToHeader</a> <br/> This field specifies a list of operations to copy the claim to HTTP headers on a successfully verified token.
This differs from the <code>output_payload_to_header</code> by allowing outputting individual claims instead of the whole payload.
Only claims of type string, boolean, and integer are supported. Array type claims are not supported at this time.
The header specified in each operation in the list must be unique. Nested claims of type string/int/bool is supported as well.</p>
<pre tabindex="0"><code>  outputClaimToHeaders:
  - header: x-my-company-jwt-group
    claim: my-group
  - header: x-test-environment-flag
    claim: test-flag
  - header: x-jwt-claim-group
    claim: nested.key.group
</code></pre><p>[Experimental] This feature is a experimental feature.</p>
<p>[TODO:Update the status whenever this feature is promoted.]</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>fromHeaders</p>
</td>
<td>
<p>List of <a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authentication-jwt-jwtheader">tetrateio.api.tsb.auth.v2.Authentication.JWT.JWTHeader</a> <br/> This field specifies the locations to extract JWT token.
If no explicit location is specified the following default
locations are tried in order:</p>
<pre><code>1) The Authorization header using the Bearer schema,
   e.g. Authorization: Bearer &lt;token&gt;. (see
   [Authorization Request Header
   Field](https://tools.ietf.org/html/rfc6750#section-2.1))

2) The `access_token` query parameter (see
[URI Query Parameter](https://tools.ietf.org/html/rfc6750#section-2.3))
</code></pre>
<p>List of header locations from which JWT is expected. For example, below is the location spec
if JWT is expected to be found in <code>x-jwt-assertion</code> header, and have <code>Bearer </code> prefix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span><span class="nt">fromHeaders</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">x-jwt-assertion</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Bearer &#34;</span><span class="w">
</span></span></span></code></pre></div><p>Note: Multiple tokens present on the same request are not supported.
The behaviour of authorization policies when there is more than one user identity is undefined</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h4 id="tetrateio-api-tsb-auth-v2-authentication-jwt-claimtoheader">ClaimToHeader</h4>
<p>This message specifies the detail for copying claim to header.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>header</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> The name of the header to be created. The header will be overridden if it already exists in the request.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>claim</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> The name of the claim to be copied from. Only claim of type string/int/bool is supported.
The header will not be there if the claim does not exist or the type of the claim is not supported.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
</table>
<h4 id="tetrateio-api-tsb-auth-v2-authentication-jwt-jwtheader">JWTHeader</h4>
<p>This message specifies a header location to extract JWT token.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>name</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> The HTTP header name.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>prefix</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> The prefix that should be stripped before decoding the token.
For example, for <code>Authorization: Bearer &lt;token&gt;</code>, prefix=<code>Bearer </code> with a space at the end.
If the header doesn&rsquo;t have this exact prefix, it is considered invalid.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h3 id="tetrateio-api-tsb-auth-v2-authentication-rules">Rules</h3>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>jwt</p>
</td>
<td>
<p>List of <a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authentication-jwt">tetrateio.api.tsb.auth.v2.Authentication.JWT</a> <br/> List of rules how to authenticate an HTTP request from a JWT Token attached to it.
A JWT Token, if present in the HTTP request, must satisfy one of the rules defined here.
The order in which rules are being checked at runtime might differ from the order
in which they are defined here.
If the JWT Token doesn&rsquo;t satisfy any of the rules, the request will be rejected.
If the JWT Token does satisfy one of the rules, the identity of the request
will be extracted from the JWT Token.</p>
<p>Notice that an HTTP request without a JWT Token attached to it will NOT be rejected
based on the rules defined here. Remember to define HTTP request authorization settings
to achieve that.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-auth-v2-authorization">Authorization</h2>
<p>Configuration for authorizing a HTTP request</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>external</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authorization-externalauthzbackend">tetrateio.api.tsb.auth.v2.Authorization.ExternalAuthzBackend</a> <em><sup><a href="https://developers.google.com/protocol-buffers/docs/proto3#oneof" target="_blank">oneof</a> authz</sup></em> <br/></p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>local</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-authorization-localauthz">tetrateio.api.tsb.auth.v2.Authorization.LocalAuthz</a> <em><sup><a href="https://developers.google.com/protocol-buffers/docs/proto3#oneof" target="_blank">oneof</a> authz</sup></em> <br/></p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h3 id="tetrateio-api-tsb-auth-v2-authorization-externalauthzbackend">ExternalAuthzBackend</h3>
<p>Use an authorization server running at the specified URI. Support both HTTP and gRPC server.
It is recommended to enable TLS validation (SIMPLE or MUTUAL) to secure traffic
between workload and external authorization server
If you use gRPC, do not set <code>includeRequestHeaders</code></p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>uri</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/></p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>includeRequestHeaders</p>
</td>
<td>
<p>List of <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/></p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>tls</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-clienttlssettings">tetrateio.api.tsb.auth.v2.ClientTLSSettings</a> <br/></p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h3 id="tetrateio-api-tsb-auth-v2-authorization-localauthz">LocalAuthz</h3>
<p>Authorize the request in Envoy based on the JWT claims.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>rules</p>
</td>
<td>
<p>List of <a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-localauthzrule">tetrateio.api.tsb.auth.v2.LocalAuthzRule</a> <br/></p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-auth-v2-clienttlssettings">ClientTLSSettings</h2>
<p>Configure TLS parameters for the client</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>mode</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-tlsmode">tetrateio.api.tsb.auth.v2.TLSMode</a> <br/> Set this to DISABLED to disable TLS (not recommended from the
security perspective), SIMPLE for one-way TLS and MUTUAL for
mutual TLS (where client is required to present its certificate as well)</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>files</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-tlsfilesource">tetrateio.api.tsb.auth.v2.TLSFileSource</a> <em><sup><a href="https://developers.google.com/protocol-buffers/docs/proto3#oneof" target="_blank">oneof</a> tls_key_source</sup></em> <br/> TLS key source from files.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>secretName</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <em><sup><a href="https://developers.google.com/protocol-buffers/docs/proto3#oneof" target="_blank">oneof</a> tls_key_source</sup></em> <br/> TLS key source from a Kubernetes Secret.
This is applicable for gateway workloads.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>subjectAltNames</p>
</td>
<td>
<p>List of <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> Subject alternative names is the list of names that are accepted
as service name as part of TLS handshake</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-auth-v2-localauthzrule">LocalAuthzRule</h2>
<p>LocalAuthzRule</p>
<p>Bindings define the subjects that can access the resource a policy is attached to,
and the conditions that need to be met for that access to be granted.
A policy can have multiple bindings to configure different access controls for specific
subjects.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>name</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> A friendly name to identify the binding.</p>
</td>
<td>
<p>string = {<br/>  min_len: <code>1</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>from</p>
</td>
<td>
<p>List of <a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-subject">tetrateio.api.tsb.auth.v2.Subject</a> <br/> Subjects configure the actors (end users, other services)  that are allowed to access the
target resource.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>to</p>
</td>
<td>
<p>List of <a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-localauthzrule-httpoperation">tetrateio.api.tsb.auth.v2.LocalAuthzRule.HttpOperation</a> <br/> A set of HTTP rules that need to be satisfied by the HTTP requests to get access to the
target resource.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h3 id="tetrateio-api-tsb-auth-v2-localauthzrule-httpoperation">HttpOperation</h3>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>paths</p>
</td>
<td>
<p>List of <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> The request path where the request is made against. E.g. [&quot;/accounts&quot;].</p>
</td>
<td>
<p>repeated = {<br/>  items: <code>{string:{min_len:1}}</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>methods</p>
</td>
<td>
<p>List of <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> The HTTP methods that are allowed by this rule. E.g. [&ldquo;GET&rdquo;, &ldquo;HEAD&rdquo;].</p>
</td>
<td>
<p>repeated = {<br/>  items: <code>{string:{in:[GET,HEAD,POST,PUT,PATCH,DELETE,OPTIONS]}}</code><br/>}<br/></p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-auth-v2-subject">Subject</h2>
<p>Subject</p>
<p>A subject designates an actor (user, service, etc) that attempts to access a target resource.
Subjects can be modeled with JWT tokens, service accounts, and decorated with attributes such as
HTTP request headers, JWT token claims, etc.
The fields that define a subject will be matched to incoming requests, to fully qualify where the
request comes from, and to decide if the given request is allowed or not for the target resource.
All the fields in a subject are evaluated as AND expressions.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>jwt</p>
</td>
<td>
<p><a href="../../../tsb/auth/v2/auth#tetrateio-api-tsb-auth-v2-subject-jwtclaims">tetrateio.api.tsb.auth.v2.Subject.JWTClaims</a> <br/> JWT configuration to identity the subject.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h3 id="tetrateio-api-tsb-auth-v2-subject-jwtclaims">JWTClaims</h3>
<p>JWT based subject</p>
<p>JWT based subjects qualify a subject by matching against a JWT token present in the request.
By default the token is expected to be present in the &lsquo;Authorization&rsquo; HTTP header, with the
&lsquo;Bearer&quot; prefix.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>iss</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/></p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>sub</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/></p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>other</p>
</td>
<td>
<p>map&lt;<a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a>, <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a>&gt; <br/> A set of arbitrary claims that are required to qualify the subject.
E.g. &ldquo;iss&rdquo;: &ldquo;*@foo.com&rdquo;.</p>
</td>
<td>
<p>map = {<br/>  keys: <code>{string:{min_len:1}}</code><br/>}<br/></p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-auth-v2-tlsfilesource">TLSFileSource</h2>
<p>TLSFileSource is used to load the keys and certificates from
files accessible to the workload</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>clientCertificate</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> Certificate file to authenticate the client. This
is mandatory for mutual TLS and must not be
specified for simple (one-way) TLS</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>privateKey</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> Private key file associated with the client certificate.
This is mandatory for mutual TLS and must not be
specified for simple TLS</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>caCertificates</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> File containing CA certificates to verify the certificates
presented by the server. This is mandatory for both simple and
mutual TLS.
Here are some common paths for the system CA bundle on Linux and can be
specified here if the server certificate is signed by a well known authority,
already part of the system CA bundle on the host -
/etc/ssl/certs/ca-certificates.crt (Debian/Ubuntu/Gentoo etc.)
/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem (CentOS/RHEL 7)
/etc/pki/tls/certs/ca-bundle.crt (Fedora/RHEL 6)</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-auth-v2-tlsmode">TLSMode</h2>
<p>Describes how authentication is performed
as part of establishing TLS connection</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th>Number</th>
<th class="description">Description</th>
</tr>
</thead>
<tr>
<td>
<p>DISABLED</p>
</td>
<td>
<p>0</p>
</td>
<td>
<p>TLS is not used and communication is
in plaintext.</p>
</td>
</tr>
<tr>
<td>
<p>SIMPLE</p>
</td>
<td>
<p>1</p>
</td>
<td>
<p>Only the server is authenticated.</p>
</td>
</tr>
<tr>
<td>
<p>MUTUAL</p>
</td>
<td>
<p>2</p>
</td>
<td>
<p>Both the peers in the communication must
present their certificate for TLS authentication</p>
</td>
</tr>
</table>

          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/tsb/">TSB</a>
  
</div>



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/tsb/refs/tsb/q/v2/approvals-service/" rel="next">
    <div class="meta-nav">上一页</div>
    <p>Approvals Service</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/tsb/refs/tsb/gateway/v2/auth/" rel="prev">
    <div class="meta-nav">下一页</div>
    <p>Auth</p></a>
  
</div>

          </div>
          

        <div class="body-footer">
          <p>最近更新于 2024-03-06</p>

          





  

<p class="edit-page">
  <a href="https://github.com/rootsongjc/cloud-native-library//edit/master/content/tsb/refs/tsb/auth/v2/auth.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>



          




          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2017-2024 jimmysong.io all rights reserved</p>
        </div>
    </div>
  </div>

</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  


<script src="/js/vendor-bundle.min.5b2c48a98fb93f10e8d01cff2874cdf3.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.a04788cdfce708339d31c0685377d64e.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">引用</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> 复制
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> 下载
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

  <script src="/js/wowchemy-publication.af9327db0521d4a01354bfc8b77a4324.js" type="module"></script>
<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
