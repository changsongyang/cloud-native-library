<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
    
    
    
  
  

  <meta name="author" content="宋净超" />

  
  
  
    
  
  <meta name="description" content="The WASM extension resource allows defining custom WASM extensions that are packaged in OCI images. The resource allows specifying extension metadata that helps understand how extensions work and how they can be used. Once defined, extensions can be referenced in Ingress and Egress Gateways and Security Groups so that traffic is captured and processed by the extension accordingly. By default, extensions are globally available, but they can be assigned to specific Tenants as well to further control and constraint where in the Organization the extensions are allowed to be used.
apiVersion: extension.tsb.tetrate.io/v2 kind: WasmExtension metadata: organization: org name: wasm-auth spec: allowedIn: - organizations/org/tenants/tenant1 url: oci://docker." />

  
  <link rel="alternate" hreflang="zh" href="https://lib.jimmysong.io/tsb/refs/tsb/extension/v2/wasm-extension/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.2c25b2854625561177dfe556e1065970.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-MP490FS739"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-MP490FS739");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a4b7f65b1839466beaa48d633aa60c1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hud79519197c2c386463324871b321d647_6772_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hud79519197c2c386463324871b321d647_6772_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://lib.jimmysong.io/tsb/refs/tsb/extension/v2/wasm-extension/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@jimmysongio" />
    <meta property="twitter:creator" content="@jimmysongio" />
  
  <meta property="og:site_name" content="云原生资料库" />
  <meta property="og:url" content="https://lib.jimmysong.io/tsb/refs/tsb/extension/v2/wasm-extension/" />
  <meta property="og:title" content="WASM Extension | 云原生资料库" />
  <meta property="og:description" content="The WASM extension resource allows defining custom WASM extensions that are packaged in OCI images. The resource allows specifying extension metadata that helps understand how extensions work and how they can be used. Once defined, extensions can be referenced in Ingress and Egress Gateways and Security Groups so that traffic is captured and processed by the extension accordingly. By default, extensions are globally available, but they can be assigned to specific Tenants as well to further control and constraint where in the Organization the extensions are allowed to be used.
apiVersion: extension.tsb.tetrate.io/v2 kind: WasmExtension metadata: organization: org name: wasm-auth spec: allowedIn: - organizations/org/tenants/tenant1 url: oci://docker." /><meta property="og:image" content="https://lib.jimmysong.io/media/sharing.png" />
    <meta property="twitter:image" content="https://lib.jimmysong.io/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2023-08-09T12:00:00&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2024-03-06T15:17:26&#43;08:00">
  

  



  

  

  





  <title>WASM Extension | 云原生资料库</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#books"><span>图书</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>教程</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/kubernetes-handbook"><span>Kubernetes 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/istio-fundamentals-zh"><span>Istio 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh"><span>Envoy 基础教程</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://jimmysong.io/blog/" target="_blank" rel="noopener"><span>博客</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://cloudnative.to/" target="_blank" rel="noopener"><span>社区</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://jimmysong.io/contact/" data-toggle="tooltip" data-placement="bottom" title="联系" target="_blank" rel="noopener" aria-label="联系">
                <i class="fab fa-weixin" aria-hidden="true"></i>
              </a>
            </li>
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/jimmysongio" data-toggle="tooltip" data-placement="bottom" title="关注" target="_blank" rel="noopener" aria-label="关注">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        <li class="nav-item">
            <a class="nav-link" href="https://jimmysong.io" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="首页" aria-label="首页"><i class="fas fa-home" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          tsb
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">目录</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#tetrateio-api-tsb-extension-v2-envvar">EnvVar</a></li>
    <li><a href="#tetrateio-api-tsb-extension-v2-globaltrafficselector">GlobalTrafficSelector</a></li>
    <li><a href="#tetrateio-api-tsb-extension-v2-vmconfig">VmConfig</a></li>
    <li><a href="#tetrateio-api-tsb-extension-v2-wasmextension">WasmExtension</a></li>
    <li><a href="#tetrateio-api-tsb-extension-v2-envvaluesource">EnvValueSource</a>
      <ul>
        <li><a href="#tetrateio-api-tsb-extension-v2-wasmextension-pluginphase">PluginPhase</a></li>
        <li><a href="#tetrateio-api-tsb-extension-v2-wasmextension-pullpolicy">PullPolicy</a></li>
      </ul>
    </li>
  </ul>
</nav>

      

    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          
            
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
    
  
    
  
    
  
    
  

    <li class="breadcrumb-item">
      <a href="/">
        
          首页
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/tsb/">
        
          TSB 手册
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/tsb/refs/">
        
          API
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/tsb/refs/tsb/">
        
          tsb
        
      </a>
    </li>
  

      <li class="breadcrumb-item active" aria-current="page">
        WASM Extension
      </li>
    </ol>
  </nav>




          

          <h1>WASM Extension</h1>

          <div class="article-style">
            <!-- WARNING: This page is generated. Please take a look at extensions/plugin-service-bridge-api-docs/src/files/doc/page.ejs -->
<p>The WASM extension resource allows defining custom WASM extensions that are packaged in OCI images.
The resource allows specifying extension metadata that helps understand how extensions work and how they can be used.
Once defined, extensions can be referenced in Ingress and Egress Gateways and Security Groups so that traffic
is captured and processed by the extension accordingly.
By default, extensions are globally available, but they can be assigned to specific Tenants as well
to further control and constraint where in the Organization the extensions are allowed to be used.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extension.tsb.tetrate.io/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">WasmExtension</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l">org</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">wasm-auth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allowedIn</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">organizations/org/tenants/tenant1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">oci://docker.io/example/my-wasm-extension:1.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l">https://github.com/example/wasm-extension</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    Long description for the extension such as an
</span></span></span><span class="line"><span class="cl"><span class="sd">    entire README file</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">phase</span><span class="p">:</span><span class="w"> </span><span class="l">AUTHZ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">some_key</span><span class="p">:</span><span class="w"> </span><span class="l">some_value</span><span class="w">
</span></span></span></code></pre></div><p>WASM extensions can also reference HTTP endpoints:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extension.tsb.tetrate.io/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">WasmExtension</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l">org</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">wasm-http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">http://tetrate.io/my-extension.wasm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l">https://github.com/example/wasm-extension</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    Long description for the extension such as an
</span></span></span><span class="line"><span class="cl"><span class="sd">    entire README file</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">phase</span><span class="p">:</span><span class="w"> </span><span class="l">AUTHZ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">some_key</span><span class="p">:</span><span class="w"> </span><span class="l">some_value</span><span class="w">
</span></span></span></code></pre></div><h2 id="tetrateio-api-tsb-extension-v2-envvar">EnvVar</h2>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>name</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> Name of the environment variable. Must be a C_IDENTIFIER, by following this regex: [A-Za-z_][A-Za-z0-9_]*</p>
</td>
<td>
<p>string = {<br/>  pattern: <code>[A-Za-z_][A-Za-z0-9_]*</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>valueFrom</p>
</td>
<td>
<p><a href="../../../tsb/extension/v2/wasm_extension#tetrateio-api-tsb-extension-v2-envvaluesource">tetrateio.api.tsb.extension.v2.EnvValueSource</a> <br/> <em>REQUIRED</em> <br/> Source for the environment variable&rsquo;s value.</p>
</td>
<td>
<p>enum = {<br/>  defined_only: <code>true</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>value</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> Value for the environment variable.
Note that if <code>value_from</code> is <code>HOST</code>, it will be ignored.
Defaults to &ldquo;&rdquo;.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-extension-v2-globaltrafficselector">GlobalTrafficSelector</h2>
<p>GlobalTrafficSelector provides a mechanism to select a specific traffic flow
for which this Wasm Extension will be enabled. This setting applies to all WASM
Extension attachments. These selectors can be overridden at attachments.
When all the sub conditions in the TrafficSelector are satisfied, the
traffic will be selected.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>mode</p>
</td>
<td>
<p><a href="../../../tsb/types/v2/types#tetrateio-api-tsb-types-v2-workloadmode">tetrateio.api.tsb.types.v2.WorkloadMode</a> <br/> Criteria for selecting traffic by their direction.
Note that CLIENT and SERVER are analogous to OUTBOUND and INBOUND,
respectively.
For the gateway, the field should be CLIENT or CLIENT_AND_SERVER.
If not specified, the default value is CLIENT_AND_SERVER.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-extension-v2-vmconfig">VmConfig</h2>
<p>Configuration for a Wasm VM.
more details can be found <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/wasm/v3/wasm.proto#extensions-wasm-v3-vmconfig" target="_blank" rel="noopener">here</a>.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>env</p>
</td>
<td>
<p>List of <a href="../../../tsb/extension/v2/wasm_extension#tetrateio-api-tsb-extension-v2-envvar">tetrateio.api.tsb.extension.v2.EnvVar</a> <br/> Specifies environment variables to be injected to this VM.
Note that if a key does not exist, it will be ignored.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-extension-v2-wasmextension">WasmExtension</h2>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th class="description">Description</th>
<th>Validation Rule</th>
</tr>
</thead>
<tr>
<td>
<p>allowedIn</p>
</td>
<td>
<p>List of <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> List of fqns where this extension is allowed to run.
If it is empty, the extension can be used across the entire organization.
Currently only Tenant resources are considered.</p>
</td>
<td>
<p>repeated = {<br/>  items: <code>{string:{min_len:1}}</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>image</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> Deprecated. Use the <code>url</code> field instead.
Repository and tag of the OCI image containing the WASM extension.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>source</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> Source to find the code for the WASM extension</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>phase</p>
</td>
<td>
<p><a href="../../../tsb/extension/v2/wasm_extension#tetrateio-api-tsb-extension-v2-wasmextension-pluginphase">tetrateio.api.tsb.extension.v2.WasmExtension.PluginPhase</a> <br/> The phase in the filter chain where the extension will be injected.
<a href="https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/#PluginPhase" target="_blank" rel="noopener">https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/#PluginPhase</a></p>
</td>
<td>
<p>enum = {<br/>  defined_only: <code>true</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>priority</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">int32</a> <br/> Determines the ordering of WasmExtensions in the same phase.
When multiple WasmExtensions are applied to the same workload in the same phase, they will be applied by priority, in descending order.
If no priority is assigned it will use the default 0 value.
In case of several extensions having the same priority in the same phase, the fqn will be used to sort them.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>config</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#google.protobuf.Struct" target="_blank" rel="noopener">google.protobuf.Struct</a> <br/> Configuration parameters sent to the WASM plugin execution
The configuration can be overwritten when instantiating the extensions in IngressGateways or Security groups.
The config is serialized using proto3 JSON marshaling and passed to proxy_on_configure when the host environment starts the plugin.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>imagePullPolicy</p>
</td>
<td>
<p><a href="../../../tsb/extension/v2/wasm_extension#tetrateio-api-tsb-extension-v2-wasmextension-pullpolicy">tetrateio.api.tsb.extension.v2.WasmExtension.PullPolicy</a> <br/> The pull behaviour to be applied when fetching Wasm module by either
OCI image or http/https. Only relevant when referencing Wasm module without
any digest, including the digest in OCI image URL or sha256 field in <code>vm_config</code>.
Defaults to IfNotPresent, except when an OCI image is referenced in the <code>url</code>
and the <code>latest</code> tag is used, in which case <code>Always</code> is the default,
mirroring K8s behaviour.</p>
</td>
<td>
<p>enum = {<br/>  defined_only: <code>true</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>imagePullSecret</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> Credentials to use for OCI image pulling.
Name of a K8s Secret that contains a docker pull secret which is to be used
to authenticate against the registry when pulling the image.
If TSB is configured to use the WASM download proxy, this secret must exist in
the <code>istio-system</code> namespace of each cluster that has applications that use the
extension. If the downlaod proxy is disabled, the secret must exist in each
application namespace that is using the extension.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>vmConfig</p>
</td>
<td>
<p><a href="../../../tsb/extension/v2/wasm_extension#tetrateio-api-tsb-extension-v2-vmconfig">tetrateio.api.tsb.extension.v2.VmConfig</a> <br/> VM Configuration sent to the WASM plugin execution</p>
</td>
<td>
<p>–</p>
</td>
</tr>
<tr>
<td>
<p>url</p>
</td>
<td>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" target="_blank" rel="noopener">string</a> <br/> <em>REQUIRED</em> <br/> URL of a Wasm module or OCI container. If no scheme is present, defaults to oci://, referencing an OCI image.
Other valid schemes are file:// for referencing .wasm module files present locally within the proxy container,
and http[s]:// for .wasm module files hosted remotely.</p>
</td>
<td>
<p>string = {<br/>  pattern: <code>^(oci|https?|file)://</code><br/>  ignore_empty: <code>true</code><br/>}<br/></p>
</td>
</tr>
<tr>
<td>
<p>match</p>
</td>
<td>
<p><a href="../../../tsb/extension/v2/wasm_extension#tetrateio-api-tsb-extension-v2-globaltrafficselector">tetrateio.api.tsb.extension.v2.GlobalTrafficSelector</a> <br/> Specifies the criteria to determine which traffic is passed to WasmExtension.
These settings are propagated to all WASMExtension Attachments. It can be overridden
at attachment points.
If a traffic satisfies the TrafficSelector,
the traffic passes to the WasmExtension.</p>
</td>
<td>
<p>–</p>
</td>
</tr>
</table>
<h2 id="tetrateio-api-tsb-extension-v2-envvaluesource">EnvValueSource</h2>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th>Number</th>
<th class="description">Description</th>
</tr>
</thead>
<tr>
<td>
<p>INLINE</p>
</td>
<td>
<p>0</p>
</td>
<td>
<p>Explicitly given key-value pairs to be injected to this VM.</p>
</td>
</tr>
<tr>
<td>
<p>HOST</p>
</td>
<td>
<p>1</p>
</td>
<td>
<p>Istio-proxy's* environment variables exposed to this VM.</p>
</td>
</tr>
</table>
<h3 id="tetrateio-api-tsb-extension-v2-wasmextension-pluginphase">PluginPhase</h3>
<p>Plugin phases following Istio definition: <a href="https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/#PluginPhase" target="_blank" rel="noopener">https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/#PluginPhase</a></p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th>Number</th>
<th class="description">Description</th>
</tr>
</thead>
<tr>
<td>
<p>UNSPECIFIED_PHASE</p>
</td>
<td>
<p>0</p>
</td>
<td>
<p>Control plane decides where to insert the plugin. This will generally be at the end of the filter chain, right before the Router.
Do not specify PluginPhase if the plugin is independent of others.</p>
</td>
</tr>
<tr>
<td>
<p>AUTHN</p>
</td>
<td>
<p>1</p>
</td>
<td>
<p>Insert plugin before Istio authentication filters.</p>
</td>
</tr>
<tr>
<td>
<p>AUTHZ</p>
</td>
<td>
<p>2</p>
</td>
<td>
<p>Insert plugin before Istio authorization filters and after Istio authentication filters.</p>
</td>
</tr>
<tr>
<td>
<p>STATS</p>
</td>
<td>
<p>3</p>
</td>
<td>
<p>Insert plugin before Istio stats filters and after Istio authorization filters.</p>
</td>
</tr>
</table>
<h3 id="tetrateio-api-tsb-extension-v2-wasmextension-pullpolicy">PullPolicy</h3>
<p>The pull behaviour to be applied when fetching a WASM module,
mirroring K8s behaviour.</p>
<div class="generated-table"></div>
<table>
<thead>
<tr>
<th>Field</th>
<th>Number</th>
<th class="description">Description</th>
</tr>
</thead>
<tr>
<td>
<p>UNSPECIFIED_POLICY</p>
</td>
<td>
<p>0</p>
</td>
<td>
<p>Defaults to IfNotPresent, except for OCI images with tag <code>latest</code>, for which
the default will be Always.</p>
</td>
</tr>
<tr>
<td>
<p>IfNotPresent</p>
</td>
<td>
<p>1</p>
</td>
<td>
<p>If an existing version of the image has been pulled before, that
will be used. If no version of the image is present locally, we
will pull the latest version.</p>
</td>
</tr>
<tr>
<td>
<p>Always</p>
</td>
<td>
<p>2</p>
</td>
<td>
<p>We will always pull the latest version of an image when changing
this plugin. Note that the change includes <code>metadata</code> field as well.</p>
</td>
</tr>
</table>

          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/tsb/">TSB</a>
  
</div>



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/tsb/refs/tsb/security/v2/waf-settings/" rel="next">
    <div class="meta-nav">上一页</div>
    <p>WAF Settings</p></a>
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1"  href="/tsb/refs/tsb/extension/v2/wasm-service/" rel="prev">
    <div class="meta-nav">下一页</div>
    <p>WasmExtension Service</p></a>
  
</div>

          </div>
          

        <div class="body-footer">
          <p>最近更新于 2024-03-06</p>

          





  

<p class="edit-page">
  <a href="https://github.com/rootsongjc/cloud-native-library//edit/master/content/tsb/refs/tsb/extension/v2/wasm-extension.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>



          




          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2017-2024 jimmysong.io all rights reserved</p>
        </div>
    </div>
  </div>

</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  


<script src="/js/vendor-bundle.min.5b2c48a98fb93f10e8d01cff2874cdf3.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.a04788cdfce708339d31c0685377d64e.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">引用</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> 复制
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> 下载
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

  <script src="/js/wowchemy-publication.af9327db0521d4a01354bfc8b77a4324.js" type="module"></script>
<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
