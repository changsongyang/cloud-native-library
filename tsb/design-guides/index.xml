<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>设计指南 | 云原生资料库</title>
    <link>https://lib.jimmysong.io/tsb/design-guides/</link>
      <atom:link href="https://lib.jimmysong.io/tsb/design-guides/index.xml" rel="self" type="application/rss+xml" />
    <description>设计指南</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Wed, 09 Aug 2023 12:00:00 +0800</lastBuildDate>
    <image>
      <url>https://lib.jimmysong.io/media/sharing.png</url>
      <title>设计指南</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/</link>
    </image>
    
    <item>
      <title>Edge Gateway Introduction</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/ha-multicluster/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/design-guides/ha-multicluster/</guid>
      <description>&lt;h1 id=&#34;introducing-high-availability-clusters-with-tetrate-edge-gateway&#34;&gt;Introducing High Availability Clusters with Tetrate Edge Gateway&lt;/h1&gt;
&lt;p&gt;&lt;em&gt;This Design Guide explains how to configure a High Availability deployment that spans multiple workload clusters in multiple cloud regions&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Business-Critical and Large-Scale services may need to be deployed across two or more regions, for scalability and high-availability purposes.  This Design Guide explains how this can be achieved with Tetrate&amp;rsquo;s Edge Gateway solution, which provides a front-end tier of highly-available load balancing proxies that accept traffic and forward them to workload clusters.&lt;/p&gt;
&lt;h2 id=&#34;introducing-tetrates-edge-gateway-solution&#34;&gt;Introducing Tetrate&amp;rsquo;s Edge Gateway solution&lt;/h2&gt;
&lt;p&gt;There are several ways that administrators can configure their production environments to distribute traffic across two or more workload clusters.&lt;/p&gt;
&lt;h3 id=&#34;common-ha-patterns&#34;&gt;Common HA Patterns&lt;/h3&gt;
&lt;p&gt;For simple, small-scale deployments, several patterns are often seen:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Global Server Load Balancing (GSLB)&lt;/strong&gt;.  With a GSLB system, each workload cluster is given a public endpoint (IP address), and DNS is used to control which endpoint a user is directed to.  The GSLB system performs health checks on each endpoint and takes failed clusters out-of-rotation, and it may also perform additional load-balancing measures such as proximity routing (send a client to the closest cluster) or load-based routing (send a client to the best-performing cluster).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GSLB solutions most commonly use DNS to control how clients are assigned to data-centers.  DNS-based control has the disadvantage that clients and intermediate servers will cache DNS entries for a period of time, so failover or re-assignment is not immediate and clients may incur downtime as a result.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Content-Delivery Network (CDN)&lt;/strong&gt;.  Many CDNs are capable of load-balancing traffic across two or more &lt;em&gt;origin&lt;/em&gt; servers, and provide a reliable, globally-distributed front-end for HTTP-based services.  A CDN-based configuration can be secured by configuring the origin servers to only accept traffic from the CDN PoPs (points of presence), and the CDN can then apply additional security measures such as volumetric DDoS prevention or web application firewalling.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CDNs are best suited for web content that can be cached and distributed globally, where the administrator wishes to minimise the load on their origin servers and minimise page load time.  Many of the optimization capabilities of a CDN are not applicable to API or other dynamic content.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Cloud-Based Load Balancers&lt;/strong&gt;.  When operating a single-vendor Cloud solution, you may wish to consider your cloud-providers solution for multi-regoin high availability.  Such solutions are often based on a combination of DNS manipulation (GSLB) and CDN-like proxies (e.g. AWS CloudFront), and they may offer the reliability, security and operational convenience that you require for your business-critical services.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;tetrate-edge-gateway&#34;&gt;Tetrate Edge Gateway&lt;/h3&gt;
&lt;p&gt;Tetrate&amp;rsquo;s Edge Gateway is a front-end proxy that is deployed to manage traffic and distribute it across multiple back-end workload clusters.  It is tightly-integrated into the Tetrate Management Plane, offering an effective and simple user experience, and scales to very large numbers of clusters, regions and levels of traffic.&lt;/p&gt;
&lt;p&gt;In particular, the Edge Gateway deployment pattern:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Supports both public and private IP addresses&lt;/strong&gt;, bridging from public to private if necessary.  An Edge Gateway deployment can reduce the number of public IP endpoints, which in turn reduces the attack surface and potentially the cost&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Consolidates the functionality of the workload cluster Ingress Gateway&lt;/strong&gt;, bringing it forward and closer to the client.  Performing rate limiting or authorization at the Edge reduces the load on the Workload clusters&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Secures the entire data-path&lt;/strong&gt;, from the very first Edge Gateway to the destination service, using Tetrate&amp;rsquo;s mTLS and tunneling capabilities&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Can be optimized&lt;/strong&gt; to reduce failover time and eliminate unnecessary hops in a failover scenario&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;making-the-edge-gateways-highly-available&#34;&gt;Making the Edge Gateways highly-available&lt;/h3&gt;
&lt;p&gt;The Edge Gateway pattern is a two-tier pattern, where the Edge Gateways provide a first tier of load-balancing in front of a tier of Ingress Gateways in Workload clusters.&lt;/p&gt;
&lt;p&gt;The Edge Gateways manage failover in the Workload clusters, and you can use any of the above solutions, such as a DNS-based GSLB solution, to manage the (less frequent) [edge-failover](failover of Edge Gateways).&lt;/p&gt;
&lt;h2 id=&#34;in-this-design-guide&#34;&gt;In this Design Guide&lt;/h2&gt;
&lt;p&gt;This design guide explains how to service critical services from multiple regions, with a configuration optimized for high availability and scalability.  The initial design for the solution brief uses the following architecture:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Two separate cloud regions, potentially spanning multiple different cloud providers&lt;/li&gt;
&lt;li&gt;One ‘Edge Gateway’ receiving internet traffic&lt;/li&gt;
&lt;li&gt;Two ‘Workload Clusters’, one in each region, hosting the named service&lt;/li&gt;
&lt;li&gt;A single named service accessed through a single DNS name&lt;/li&gt;
&lt;li&gt;A third-party DNS service to distribute traffic to the Edge Gateway&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Begin with the &lt;a href=&#34;demo-1&#34;&gt;Getting Started Documentation&lt;/a&gt; to create this example deployment.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Understanding HA</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/ha-dr-mp/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/design-guides/ha-dr-mp/</guid>
      <description>&lt;h1 id=&#34;understanding-ha-and-dr-for-the-tetrate-management-plane&#34;&gt;Understanding HA and DR for the Tetrate Management Plane&lt;/h1&gt;
&lt;p&gt;&lt;em&gt;This guide describes the DR scenarios and impact for the Tetrate Management Plane.  It applies to both Tetrate Service Bridge (TSB) and Tetrate Service Express (TSE).&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The design of the Tetrate Management Plane (and the distributed control plane architecture) provides the following attributes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Architecture is loosely coupled&lt;/strong&gt;: Tetrate architecture by design is loosely coupled and self-healing, meaning that the &amp;lsquo;blast radius&amp;rsquo; of failures is limited, and the platform quickly settles on a good configuration when components recover.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;All Tetrate components are stateless and can recover from failure:&lt;/strong&gt; The only exceptions are the Postgres DB (configuration and audit logs) and ElasticSearch DB (metrics), plus secrets in the K8s cluster&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Apps and Services are not affected:&lt;/strong&gt; Failures in any management or control plane component do not affect the correct operation or security of applications and services running in the workload clusters.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;High Availability:&lt;/strong&gt; We recommend running workloads in a redundant, HA fashion. A redundant, HA management plane is possible, but brings limited benefits in Tetrate’s loosely-coupled architecture, at the cost of resource usage and additional complexity.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;high-availability-and-dr-with-tetrate&#34;&gt;High-Availability and DR with Tetrate&lt;/h2&gt;
&lt;h3 id=&#34;workloads-and-dataplane-ha&#34;&gt;Workloads and Dataplane HA&lt;/h3&gt;
&lt;p&gt;Tetrate can help you to manage and operate multiple production clusters across regions and clouds, to create a redundant dataplane.  Capabilities such as Tetrate&amp;rsquo;s Edge and East-West gateways, plus integration with GSLB solutions such as &lt;a href=&#34;https://docs.tetrate.io/service-express/integrations/route53&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Amazon Route 53&lt;/a&gt; provide high-availability for production workloads in the event of failure in Workload clusters for any reason.&lt;/p&gt;
&lt;p&gt;:::warning Istio multi-region DR configurations&lt;/p&gt;
&lt;p&gt;Tetrate&amp;rsquo;s solution does not rely on any of the &lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/deployment-models/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;multi-region DR configurations&lt;/a&gt; for the Istio dataplane.  These are required when no higher-level control plane is in place, and they add significant complexity and additional failure scenarios.  Tetrate&amp;rsquo;s Control Plane architecture means that single istio-per-cluster deployments are entirely sufficient and provide better isolation in the event of a failure.  Furthermore, smaller failure domains make progressive upgrades easier and less risky.&lt;/p&gt;
&lt;p&gt;:::&lt;/p&gt;
&lt;h3 id=&#34;management-and-control-plane-ha&#34;&gt;Management and Control Plane HA&lt;/h3&gt;
&lt;p&gt;Most components in the Tetrate Management and Control Planes can recover from failures, re-sync configuration and resume correct operations without any user interaction.&lt;/p&gt;
&lt;p&gt;The Central Control Plane cannot operate in a redundant fashion, but achieves high availability by virtue of caching all configuration in the local Kubernetes API server (tsb namespace), and re-syncing from the Management Plane and from remote Edge Control Plane instance whenever needed.  Any failures in the Central Control Plane are quickly recovered from with no lasting effects.&lt;/p&gt;
&lt;p&gt;The Management Plane maintains configuration and stores audit logs in a PostgreSQL database:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;When deploying TSB, customers provide and maintain a suitable PostgreSQL instance&lt;/li&gt;
&lt;li&gt;When deploying TSE, a simple PostgreSQL instance is included and is managed by TSE. This can be replaced with a customer-provided instance&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Tetrate share the following advice:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Maintain a highly-available PostgreSQL database for Management Plane configuration&lt;/li&gt;
&lt;li&gt;Maintain periodic backups of the database if necessary&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For a detailed description of the various failure and recovery scenarios, read the &lt;a href=&#34;scenarios&#34;&gt;Failure Scenarios&lt;/a&gt; explanations.&lt;/p&gt;
&lt;h3 id=&#34;management-plane-dr&#34;&gt;Management Plane DR&lt;/h3&gt;
&lt;p&gt;If redundancy of the Management Plane (separate from the database) is required, it is possible to run two Management Plane instances in an active-standby configuration, as described in the &lt;a href=&#34;dr-managementplane&#34;&gt;Management Plane DR&lt;/a&gt; explanation.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
