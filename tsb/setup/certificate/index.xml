<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>证书安装 | 云原生资料库</title>
    <link>https://lib.jimmysong.io/tsb/setup/certificate/</link>
      <atom:link href="https://lib.jimmysong.io/tsb/setup/certificate/index.xml" rel="self" type="application/rss+xml" />
    <description>证书安装</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Wed, 09 Aug 2023 12:00:00 +0800</lastBuildDate>
    <image>
      <url>https://lib.jimmysong.io/media/sharing.png</url>
      <title>证书安装</title>
      <link>https://lib.jimmysong.io/tsb/setup/certificate/</link>
    </image>
    
    <item>
      <title>Automated Certificate Management</title>
      <link>https://lib.jimmysong.io/tsb/setup/certificate/automated-certificate-management/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/certificate/automated-certificate-management/</guid>
      <description>&lt;p&gt;TSB supports automated certificate management for TSB components. You can enable TSB to provision a self signed root CA that will be used to issue certificates such as TLS certificates for TSB management plane, &lt;a href=&#34;./certificate-requirements&#34;&gt;internal certificates&lt;/a&gt; for communication between control plane to management plane and intermediate CA certificates for application clusters that will be used by Istio in the cluster to issue certificates for application workloads.&lt;/p&gt;
&lt;p&gt;:::note External Root CA
TSB&amp;rsquo;s automated certificate management currently does not support using an external root CA. Support for external root CA will be added in a future release.
:::&lt;/p&gt;
&lt;h2 id=&#34;enable-automated-certificate-management&#34;&gt;Enable Automated Certificate Management&lt;/h2&gt;
&lt;p&gt;To enable automated certificate management, you need to set the &lt;code&gt;certIssuer&lt;/code&gt; field in the  TSB management plane CR or helm values:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certIssuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selfSigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsbCerts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterIntermediateCAs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;certIssuer&lt;/code&gt; field is a map of certificate issuers that you want to enable. Currently, TSB supports the following issuers:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;selfSigned&lt;/code&gt;: This will provision a self signed root CA that will be used to issue certificates for TSB components.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tsbCerts&lt;/code&gt;: This will provision TSB TLS certificates for TSB endpoint and also TSB internal certificates.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;clusterIntermediateCAs&lt;/code&gt;: This will provision intermediate CA certificates for application clusters that will be used by Istio in the cluster to issue certificates for application workloads.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To enable automated cluster intermediate CA certificate management, you also need to set the &lt;code&gt;centralProvidedCaCert&lt;/code&gt; field in the  TSB control plane CR or helm values:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;centralProvidedCaCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;using-external-certificate-management&#34;&gt;Using External Certificate Management&lt;/h2&gt;
&lt;p&gt;If you want to use external certificate provisioning, you need to remove the relevant issuer from the &lt;code&gt;certIssuer&lt;/code&gt; field in the TSB management plane CR or helm values to avoid conflict. For examples:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;To use Let&amp;rsquo;s Encrypt to provision TSB TLS certificate, remove &lt;code&gt;tsbCerts&lt;/code&gt; from the &lt;code&gt;certIssuer&lt;/code&gt; field. Note that if you disable this, then you also need to need provision TSB &lt;a href=&#34;./certificate-requirements&#34;&gt;internal certificates&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;To use AWS PCA to provision cluster intermediate CA, remove &lt;code&gt;clusterIntermediateCAs&lt;/code&gt; from the &lt;code&gt;certIssuer&lt;/code&gt; field and set &lt;code&gt;centralProvidedCaCert&lt;/code&gt; to &lt;code&gt;false&lt;/code&gt; in the  TSB control plane CR or helm values.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you plan to use external certificate management for both &lt;code&gt;tsbCerts&lt;/code&gt; and &lt;code&gt;clusterIntermediateCAs&lt;/code&gt;, then you can remove the &lt;code&gt;certIssuer&lt;/code&gt; field from the TSB management plane CR or helm values.&lt;/p&gt;
&lt;h2 id=&#34;certificate-rotation&#34;&gt;Certificate Rotation&lt;/h2&gt;
&lt;p&gt;TSB will automatically rotate certificates for TSB components and application clusters. Cluster intermediate CA certificates will be rotated every 1 year. TSB TLS and internal certificates will be rotated every 90 days. Currently TSB don&amp;rsquo;t provide a way to configure the rotation period.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Internal Certificates Requirements</title>
      <link>https://lib.jimmysong.io/tsb/setup/certificate/certificate-requirements/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/certificate/certificate-requirements/</guid>
      <description>&lt;p&gt;Before you continue, make sure you:  &lt;br /&gt;
✓ Understand &lt;a href=&#34;./certificate-setup&#34;&gt;the 4 types of certificates&lt;/a&gt; in TSB particularly &lt;a href=&#34;./certificate-setup#tsb-internal-certificates&#34;&gt;internal certificates&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;:::note
Please note that the certificates described here are solely used for the communication between TSB components,
and thus are not part of your workloads&amp;rsquo; certificates that are typically managed by Istio or application TLS certificates.
:::&lt;/p&gt;
&lt;p&gt;:::warning
In case you have installed &lt;code&gt;cert-manager&lt;/code&gt; in the management plane cluster, you can use tctl
to automatically install required issuer and certificate in the management plane and create control
plane certificate. Please see the documentations for &lt;a href=&#34;../self_managed/management-plane-installation&#34;&gt;Management Plane Installation&lt;/a&gt; and
&lt;a href=&#34;../self_managed/onboarding-clusters&#34;&gt;Onboarding Clusters&lt;/a&gt; for more details.
:::&lt;/p&gt;
&lt;p&gt;To use JWT authentication with regular (non-mutual) TLS, the XCP central certificate must include its address in its subject alternate names (SANs). This will either be a DNS name or an IP address.&lt;/p&gt;
&lt;p&gt;Similar with mTLS above, XCP central in the management plane uses the certificate stored in a secret named &lt;code&gt;xcp-central-cert&lt;/code&gt;
in the management plane namespace (which defaults to &lt;code&gt;tsb&lt;/code&gt;). The secret must contain data for the
standard &lt;code&gt;tls.crt&lt;/code&gt;, &lt;code&gt;tls.key&lt;/code&gt;, and &lt;code&gt;ca.crt&lt;/code&gt; fields.&lt;/p&gt;
&lt;p&gt;Below is an example of XCP central certificate as &lt;code&gt;cert-manager&lt;/code&gt; resource if you are using IP address.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xcp-central-cert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tsb&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xcp-central-cert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ipAddresses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;a.b.c.d &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;## &amp;lt;--- IP Address here&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;issuerRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xcp-identity-issuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Issuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;30000h&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Or, if you are using domain names, edit the field &lt;code&gt;spec.dnsNames&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cert-manager.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Certificate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xcp-central-cert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tsb&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xcp-central-cert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dnsNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;example-tsb.tetrate.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;## &amp;lt;-- DNS name here&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;issuerRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xcp-identity-issuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Issuer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;30000h&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:::warning DNS name when creating certificate with tctl
If you use tctl to automatically install required issuer and certificate, XCP central cert will have &lt;code&gt;central.xcp.tetrate.io&lt;/code&gt; as the DNS name.
:::&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Types of Certificates</title>
      <link>https://lib.jimmysong.io/tsb/setup/certificate/certificate-setup/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/certificate/certificate-setup/</guid>
      <description>&lt;p&gt;:::note
Since 1.7, TSB supports automated certificate management for TSB management plane TLS certificates, internal certificates and intermediate Istio CA certificates. Go to &lt;a href=&#34;./automated-certificate-management&#34;&gt;Automated Certificate Management&lt;/a&gt; for more details.
:::&lt;/p&gt;
&lt;p&gt;There are 4 types of certificates that TSB operator needs to be aware of:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;#tsb-internal-certificates&#34;&gt;TSB Internal Certificates&lt;/a&gt; - Certificates that are used for TSB internal components to trust each other.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#application-tls-certificates&#34;&gt;Application TLS Certificates&lt;/a&gt; - Certificates that will be available to the application user web-browser or tools.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#intermediate-istio-ca-certificates&#34;&gt;Intermediate Istio CA Certificates&lt;/a&gt; - Intermediate CA certificate for issuing Istio workload leaf certificates.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#workload-leaf-certificates&#34;&gt;Workload Leaf Certificates&lt;/a&gt; - Certificates issued to every proxy and gateway.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;These certificates and their relation to TSB components and your application are shown in the following image&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;../../assets/setup/certificates-in-tsb.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;tsb-internal-certificates&#34;&gt;TSB Internal Certificates&lt;/h2&gt;
&lt;p&gt;TSB&amp;rsquo;s global control plane (XCP) distributes configuration from the management plane to control plane clusters. XCP is composed of XCP central and XCP edge. XCP central is deployed in the management plane where TSB server interact with it through a component called MPC. XCP edge is deployed in each of the onboarded clusters where user applications run. TSB internal certificates (highlighted green in image above) are used for securing communication between XCP central, XCP edge, MPC component. TSB uses JWT with TLS for secure the communication. You will need to prepare these certificates before deploying TSB.&lt;/p&gt;
&lt;h2 id=&#34;application-tls-certificates&#34;&gt;Application TLS Certificates&lt;/h2&gt;
&lt;p&gt;Application TLS certificates (highlighted purple in image above) are used by client applications that should trust to access the application.&lt;/p&gt;
&lt;p&gt;Every publicly accessible HTTPS service exposed by your application should have TLS certificates mounted as Kubernetes secrets. TLS certificates for your application must be available when the application is published.&lt;/p&gt;
&lt;p&gt;While technically not an &amp;ldquo;application&amp;rdquo; you will also need to set up the TLS certificates for the command line tools to access the TSB Management Plane, as well as for you to access the TSB UI via a web browser. TSB TLS certificate must be available before TSB deployment.&lt;/p&gt;
&lt;h2 id=&#34;intermediate-istio-ca-certificates&#34;&gt;Intermediate Istio CA Certificates&lt;/h2&gt;
&lt;p&gt;Intermediate Istio CA certificates (highlighted cyan in image above) is mounted in &lt;code&gt;cacerts&lt;/code&gt; secret on every Control Plane so that Istio workloads leaf certificates can be issued. By default &lt;code&gt;istiod&lt;/code&gt; acts as a leaf certificate issuer by using Intermediate CA certificate to sign leaf certificates.&lt;/p&gt;
&lt;p&gt;The certificate should be signed (or verifiable) by the enterprise Root CA for intra-service communication. The cluster specific Intermediate CA should be available during TSB Control Plane deployment.&lt;/p&gt;
&lt;p&gt;For a demo example on setting up Intermediate Istio CA in multi-clusters setup, refer to &lt;a href=&#34;https://istio.io/latest/docs/tasks/security/cert-management/plugin-ca-cert&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For a production environment, It is highly recommended to use production ready PKI infrastructure such as the following, and follow the industry best practices:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Using AWS Private CA as enterprise CA to create Intermediate CAs (not an automated process)&lt;/li&gt;
&lt;li&gt;Integrate existing CA (e.g. &lt;a href=&#34;https://aws.amazon.com/certificate-manager/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS Certificate Manager&lt;/a&gt;, &lt;a href=&#34;https://www.vaultproject.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HashiCorp Vault&lt;/a&gt;) with &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes CSR API&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Usually the enterprise security team is in charge of these types of certificates.&lt;/p&gt;
&lt;h2 id=&#34;workload-leaf-certificates&#34;&gt;Workload Leaf Certificates&lt;/h2&gt;
&lt;p&gt;Leaf certificates (highlighted yellow in image above) are issued to every proxy and gateway (or per workload). These are short lived certificates (by default 24 hour and can be changed by setting using &lt;a href=&#34;../../refs/install/controlplane/v1alpha1/spec#istio&#34;&gt;&lt;code&gt;defaultWorkloadCertTTL&lt;/code&gt; in &lt;code&gt;ControlPlane&lt;/code&gt; CR&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s important to understand that these certificates are automatically rotated and are &lt;strong&gt;not&lt;/strong&gt; managed by TSB. Istiod is responsible for issuing and rotating the certificates using the Enterprise Intermediate certificates.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
