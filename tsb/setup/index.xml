<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>安装与升级 | 云原生资料库</title>
    <link>https://lib.jimmysong.io/tsb/setup/</link>
      <atom:link href="https://lib.jimmysong.io/tsb/setup/index.xml" rel="self" type="application/rss+xml" />
    <description>安装与升级</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Wed, 09 Aug 2023 12:00:00 +0800</lastBuildDate>
    <image>
      <url>https://lib.jimmysong.io/media/sharing.png</url>
      <title>安装与升级</title>
      <link>https://lib.jimmysong.io/tsb/setup/</link>
    </image>
    
    <item>
      <title>先决条件和下载</title>
      <link>https://lib.jimmysong.io/tsb/setup/requirements-and-download/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/requirements-and-download/</guid>
      <description>&lt;p&gt;本页面提供了开始使用 Tetrate Service Bridge（TSB）安装所需的先决条件和下载说明的全面概述。&lt;/p&gt;
&lt;p&gt;要有效地管理 TSB 服务网格，需要对 Kubernetes 和 Docker 仓库操作有深入的了解。我们建议咨询它们各自的支持文档以获取额外的指导。&lt;/p&gt;
&lt;h2 id=&#34;先决条件&#34;&gt;先决条件&lt;/h2&gt;
&lt;p&gt;你可以安装用于生产的 TSB，也可以安装用于演示配置文件以快速了解 TSB。请查看以下表格中的每个要求：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;生产 TSB&lt;/th&gt;
&lt;th&gt;演示/快速入门TSB&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Kubernetes 集群：&lt;/strong&gt;&lt;br /&gt;EKS 1.21 - 1.24&lt;br /&gt;GKE 1.21 - 1.24&lt;br /&gt;AKS 1.21 - 1.24（包括 Azure Stack HCI）&lt;br /&gt;OpenShift 4.7 - 4.11&lt;br /&gt;Docker UCP 3.2.5 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Docker UCP 3.2.5 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;私有 Docker 注册表（HTTPS）&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tetrate 存储库帐户和 API 密钥（如果你尚未拥有此内容，请联系 Tetrate）&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Docker 引擎 18.03.01 或更高版本，具有对私有 Docker 注册表的推送访问权限&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PostgreSQL 11.1 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（v14.4）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Elasticsearch 6.x 或 7.x&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（v7.8.1）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Redis 6.2 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（v7.0.5）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LDAP 服务器或 OIDC 提供程序&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（OpenLDAP v2.6）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Cert-manager：&lt;/br&gt;cert-manager v1.7.2 或更高版本&lt;/td&gt;
&lt;td&gt;✓&lt;/td&gt;
&lt;td&gt;打包（cert-manager v1.10.0）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;cert-manager 用法&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    &lt;a href=&#34;https://cert-manager.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cert-manager&lt;/a&gt; 用于为 TSB webhook、TSB 内部通信和 Istio 控制平面与外部 CA 集成等颁发和管理证书。
&lt;/div&gt;

&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;cert-manager 版本&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    cert-manager 1.4.0 是使用 TSB 1.5 所需的最低版本。它具有特性标志，用于签署 K8S CSR 请求，支持 Kubernetes 1.16-1.21。前往&lt;a href=&#34;https://cert-manager.io/docs/installation/supported-releases/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cert-manager 受支持的版本&lt;/a&gt;以获取有关受支持的 Kubernetes 和 OpenShift 版本的更多信息。
&lt;/div&gt;

&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;生产安装注意事项&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    你的 Kubernetes 集群的大小取决于平台部署要求。基本的 TSB 安装不会消耗太多额外的资源。存储的大小非常取决于应用程序集群的大小、工作负载的数量（及其请求率）以及可观察性配置（采样率、数据保留期等）。有关更多信息，请参见我们的容量规划指南。
&lt;/div&gt;

&lt;p&gt;当运行自托管时，你的组织可能会对上述环境和应用程序施加额外的（安全）限制、可用性和灾难恢复要求。有关如何调整 TSB 安装和配置的详细信息，请参阅操作员参考指南以及我们的文档中的 how to 部分，在其中可以找到有关配置选项、常见部署方案和解决方案的描述。&lt;/p&gt;
&lt;h3 id=&#34;身份标识提供者&#34;&gt;身份标识提供者&lt;/h3&gt;
&lt;p&gt;TSB 需要标识提供程序（IdP）作为用户来源。此标识提供程序用于用户身份验证以及定期将现有用户和组的信息同步到平台中。TSB 可以与 LDAP 或任何符合 OIDC 的标识提供程序集成。&lt;/p&gt;
&lt;p&gt;要使用 LDAP，你必须弄清楚如何查询 LDAP，以便 TSB 可以将其用于身份验证和用户和组的同步。有关 LDAP 配置的更多详细信息，请参见 LDAP 作为标识提供程序。&lt;/p&gt;
&lt;p&gt;要使用 OIDC，请在你的 IdP 中创建 OIDC 客户端。启用授权代码流以使用 UI 登录，并启用设备授权以使用设备代码使用 tctl 登录。有关更多信息和示例，请参见如何设置 Azure AD 作为 TSB 标识提供程序。&lt;/p&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;OIDC IdP 同步&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    TSB 支持 Azure AD 用于同步用户和组。如果你使用其他 IdP，则必须创建同步作业，将从你的 IdP 获取用户和团队并使用同步 API 将它们同步到 TSB 中。有关更多详细信息，请参见用户同步。
&lt;/div&gt;

&lt;h3 id=&#34;数据和遥测存储&#34;&gt;数据和遥测存储&lt;/h3&gt;
&lt;p&gt;TSB 需要外部数据和遥测存储。TSB 使用 PostgreSQL 作为数据存储和 Elasticsearch 作为遥测存储。&lt;/p&gt;
&lt;div class=&#34;alert-warnning-title&#34;&gt;
    &lt;p&gt;Demo 存储&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-warnning&#34;&gt;
    演示安装将部署 PostgreSQL、Elasticsearch 和 LDAP 服务器作为标识提供程序，其中填充了模拟用户和团队。演示存储不适用于生产使用。请确保为你的生产环境提供适当的 PostgreSQL、Elasticsearch 和标识提供程序。
&lt;/div&gt;

&lt;h3 id=&#34;证书提供者&#34;&gt;证书提供者&lt;/h3&gt;
&lt;p&gt;TSB 1.5 需要证书提供者来支持内部 TSB 组件的证书颁发，例如 Webhook 证书和其他用途。此证书提供者必须在管理平面集群和所有控制平面集群中都可用。&lt;/p&gt;
&lt;p&gt;TSB 支持&lt;code&gt;cert-manager&lt;/code&gt;作为其中一个受支持的提供者。它可以为你管理&lt;code&gt;cert-manager&lt;/code&gt;安装的生命周期。要在集群中配置&lt;code&gt;cert-manager&lt;/code&gt;的安装，请将以下部分作为&lt;code&gt;ManagementPlane&lt;/code&gt;或&lt;code&gt;ControlPlane&lt;/code&gt; CR 的一部分添加：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;   components:
     internalCertProvider:
       certManager:
         managed: INTERNAL
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;你还可以使用任何支持&lt;code&gt;kube-CSR&lt;/code&gt; API 的证书提供者。要使用自定义提供者，请参阅以下部分 Internal Cert Provider&lt;/p&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;现有的 cert-manager 安装&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    如果你已经使用 cert-manager 作为集群的一部分，则可以将&lt;code&gt;ManagementPlane&lt;/code&gt;或&lt;code&gt;ControlPlane&lt;/code&gt; CR 中的&lt;code&gt;managed&lt;/code&gt;字段设置为&lt;code&gt;EXTERNAL&lt;/code&gt;，使 TSB 利用现有的 cert-manager 安装。如果将&lt;code&gt;managed&lt;/code&gt;字段设置为&lt;code&gt;INTERNAL&lt;/code&gt;，则 TSB 操作员会在找到已安装的 cert-manager 时失败，以确保它不覆盖现有的 cert-manager 安装。
&lt;/div&gt;

&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;cert-manager Kube-CSR&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    TSB 使用 kubernetes CSR 资源为各种 Webhook 颁发证书。如果你的配置使用外部 cert-manager 安装，请确保 cert-manager 可以签署 Kubernetes CSR 请求。例如，在 cert-manager 1.7.2 中，通过设置此特性标志 &lt;code&gt;ExperimentalCertificateSigningRequestControllers=true&lt;/code&gt;启用此功能。对于使用内部托管的 cert-manager 的 TSB 管理安装，此配置已作为安装的一部分设置。
&lt;/div&gt;

&lt;h2 id=&#34;下载-tctl&#34;&gt;下载 tctl&lt;/h2&gt;
&lt;p&gt;设置 TSB 的初始步骤是安装我们的 TSB CLI 工具，称为&lt;code&gt;tctl&lt;/code&gt;。使用&lt;code&gt;tctl&lt;/code&gt;，你可以执行 TSB 安装（或升级），使用 YAML 对象与 TSB API 进行交互，并将 TSB 无缝集成到 GitOps 工作流程中。&lt;/p&gt;
&lt;p&gt;请按照 CLI 参考页面中概述的说明下载和安装&lt;code&gt;tctl&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&#34;同步-tetrate-service-bridge-镜像&#34;&gt;同步 Tetrate Service Bridge 镜像&lt;/h2&gt;
&lt;p&gt;安装了&lt;code&gt;tctl&lt;/code&gt;之后，你可以检索必要的容器镜像并将它们上传到你的私有 Docker 注册表。&lt;code&gt;tctl&lt;/code&gt;工具通过&lt;code&gt;image-sync&lt;/code&gt;命令简化了此过程，该命令下载与当前&lt;code&gt;tctl&lt;/code&gt;版本对应的图像版本，并将其推送到你的 Docker 注册表。使用你的 Tetrate 存储库帐户凭据和指定你的私有 Docker 注册表的&lt;code&gt;registry&lt;/code&gt;参数使用&lt;code&gt;username&lt;/code&gt;和&lt;code&gt;apikey&lt;/code&gt;参数。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl install image-sync --username &amp;lt;user-name&amp;gt; &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;   --apikey &amp;lt;api-key&amp;gt; --registry &amp;lt;registry-location&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在初始执行期间，你需要接受最终用户许可协议（EULA）。如果你在没有交互式终端访问权限的环境中运行 TSB 安装，例如 CI / CD 流程，请将&lt;code&gt;--accept-eula&lt;/code&gt;标志附加到上述命令中。&lt;/p&gt;
&lt;h3 id=&#34;在-kind-集群中加载演示镜像&#34;&gt;在 Kind 集群中加载演示镜像&lt;/h3&gt;
&lt;p&gt;对于本地&lt;a href=&#34;https://kind.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kind&lt;/a&gt;集群中的&lt;code&gt;demo&lt;/code&gt;配置文件安装，请使用以下命令直接将镜像加载到 kind 节点中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#使用我们的“用户名”和“apikey”登录到Docker注册表&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker login containers.dl.tetrate.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#拉取所有docker镜像&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;tctl install image-sync --just-print --raw&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; docker pull &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#将镜像加载到kind节点中&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;tctl install image-sync --just-print --raw&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; kind load docker-image &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;安装&#34;&gt;安装&lt;/h2&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;集群配置文件&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    在操作多集群 TSB 环境时，与多个 Kubernetes 集群的交互变得普遍。虽然文档没有明确引用&lt;code&gt;kubectl&lt;/code&gt;配置上下文和&lt;code&gt;tctl&lt;/code&gt; config 配置文件，但这些选择是特定于环境的。确保选择了正确的&lt;code&gt;kubectl&lt;/code&gt;上下文和&lt;code&gt;tctl&lt;/code&gt;配置文件作为默认值，或在使用这些工具执行命令时使用显式参数。
&lt;/div&gt;

&lt;p&gt;要使用 Helm Chart 继续进行安装，请参阅 Helm 安装指南。&lt;/p&gt;
&lt;p&gt;要使用&lt;code&gt;tctl&lt;/code&gt;进行安装，请继续查看 tctl 安装指南。&lt;/p&gt;
&lt;p&gt;有关演示安装过程的详细说明，请转到演示安装指南。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Connect to TSB with tctl</title>
      <link>https://lib.jimmysong.io/tsb/setup/tctl-connect/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/tctl-connect/</guid>
      <description>&lt;p&gt;In this page you&amp;rsquo;ll learn to connect to TSB with the &lt;code&gt;tctl&lt;/code&gt; CLI and some basics of using the CLI.&lt;/p&gt;
&lt;p&gt;Before you start: &lt;br /&gt;
✓ &lt;a href=&#34;../setup/self_managed/management-plane-installation&#34;&gt;Install the TSB management plane&lt;/a&gt; (self-managed Only) &lt;br /&gt;
✓ &lt;a href=&#34;../setup/requirements-and-download#download&#34;&gt;Download&lt;/a&gt; Tetrate Service Bridge CLI (&lt;code&gt;tctl&lt;/code&gt;)&lt;br /&gt;
✓ Get your TSB&amp;rsquo;s &lt;code&gt;organization&lt;/code&gt; name - you can find this logging in to the TSB UI or configured at installation time in the TSB &lt;code&gt;ManagementPlane&lt;/code&gt; CR&lt;br /&gt;&lt;/p&gt;
&lt;p&gt;TSB provides a UI, but most examples in this site - and most scripting and automation - will use the &lt;code&gt;tctl&lt;/code&gt; CLI. This document will cover how to get logged in so you can use the CLI, as well as steps to update your credentials.&lt;/p&gt;
&lt;h2 id=&#34;overview&#34;&gt;Overview&lt;/h2&gt;
&lt;p&gt;There are three ways to configure &lt;code&gt;tctl&lt;/code&gt;: using &lt;code&gt;tctl login&lt;/code&gt;, downloading the a credential bundle from the UI, or to manually configure it. Each method is described in detail in the rest of this document.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The preferred method is connecting to TSB with &lt;code&gt;tctl login&lt;/code&gt;, using the &lt;code&gt;default&lt;/code&gt; profile:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config clusters &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; default --bridge-address &lt;span class=&#34;nv&#34;&gt;$TSB_ADDRESS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl login
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Organization: tetrate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Tenant:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Username: admin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Password: *****
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Login Successful!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# We&amp;#39;re ready to go:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl get tenants
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME          DISPLAY NAME    DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tetrate       Tetrate         Default tenant
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;A second easy way to connect with &lt;code&gt;tctl&lt;/code&gt; is to download the bundle from the TSB UI and &lt;code&gt;tctl config import&lt;/code&gt; it:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles import ~/Downloads/tctl-&amp;lt;your username&amp;gt;.config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles set-current &amp;lt;your username&amp;gt;-tsb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# We&amp;#39;re ready to go:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl get tenants
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME          DISPLAY NAME    DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tetrate       Tetrate         Default tenant
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;And finally you can create your own &lt;code&gt;user&lt;/code&gt;, &lt;code&gt;cluster&lt;/code&gt;, and &lt;code&gt;profile&lt;/code&gt; (with slightly different flags for LDAP vs OIDC) to log in:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config clusters &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-cluster --bridge-address &lt;span class=&#34;nv&#34;&gt;$TSB_ADDRESS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# For OIDC&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; --token &lt;span class=&#34;nv&#34;&gt;$TSB_BEARER_TOKEN&lt;/span&gt; --refresh-token &lt;span class=&#34;nv&#34;&gt;$TSB_REFRESH_TOKEN&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Or for LDAP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# tctl config users set tsb-how-to-user --org $TCTL_LOGIN_ORG --username $TCTL_LOGIN_USERNAME --password $TCTL_LOGIN_PASSWORD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to --cluster tsb-how-to-cluster --username tsb-how-to-user
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles set-current tsb-how-to
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# We&amp;#39;re ready to go:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl get tenants
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME          DISPLAY NAME    DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tetrate       Tetrate         Default tenant
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If you logged in with a username and password, you should &lt;code&gt;tctl login&lt;/code&gt; to exchange your password for a set of OIDC tokens. After this you can use &lt;code&gt;tctl&lt;/code&gt; at will. For example to discover &lt;code&gt;tenants&lt;/code&gt; in TSB, simply execute &lt;code&gt;tctl get tenants&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;log-in-with-tctl-login&#34;&gt;Log in with &lt;code&gt;tctl login&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;The easiest way to get connected to TSB is to use the &lt;code&gt;tctl login&lt;/code&gt; command, which will handle exchanging credentials for OIDC tokens for you, and ensure no plaintext passwords are persisted to disk.&lt;/p&gt;
&lt;p&gt;To do this, first we need to configure &lt;code&gt;tctl&lt;/code&gt; with the address of our TSB instance. It&amp;rsquo;s easiest to use the &lt;code&gt;default&lt;/code&gt; profile for this - if you don&amp;rsquo;t want to use the &lt;code&gt;default&lt;/code&gt; profile, skip ahead to the &lt;a href=&#34;#configure-tctl-manually&#34;&gt;Configure &lt;code&gt;tctl&lt;/code&gt; Manually section&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&#34;get-tsbs-address&#34;&gt;Get TSB&amp;rsquo;s Address&lt;/h3&gt;
&lt;p&gt;If your kubeconfig is pointed at the management plane cluster, you can get the address from the Kubernetes service:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_ADDRESS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get svc -n tsb envoy --output &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;:8443
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Many organizations will expose TSB&amp;rsquo;s UI (and therefore API) via DNS; you should use that instead of the raw IP address.&lt;/p&gt;
&lt;h3 id=&#34;configure-the-default-profile&#34;&gt;Configure the default profile&lt;/h3&gt;
&lt;p&gt;With TSB&amp;rsquo;s address in hand, we&amp;rsquo;ll configure &lt;code&gt;tctl&lt;/code&gt; to connect to it:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config clusters &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; default --bridge-address &lt;span class=&#34;nv&#34;&gt;$TSB_ADDRESS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;log-in-with-oidc&#34;&gt;Log in with OIDC&lt;/h3&gt;
&lt;p&gt;To log in with OIDC, we can use the OIDC device code flow, which is built into &lt;code&gt;tctl&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl login --use-device-code
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Organization: tetrate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Tenant:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: GGBD-NJPR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Open browser page https://www.google.com/device and enter the code
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Login Successful!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:::note OIDC in the browser
This will open up your browser for you to complete the OIDC login flow and generate tokens.
:::&lt;/p&gt;
&lt;h3 id=&#34;log-in-with-username-and-password&#34;&gt;Log in with Username and Password&lt;/h3&gt;
&lt;p&gt;Log in, providing your username and password:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Organization: tetrate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Tenant:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Username: admin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Password: *****
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Login Successful!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;download-tctl-config-from-tsb&#34;&gt;Download &lt;code&gt;tctl&lt;/code&gt; Config from TSB&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;tctl&lt;/code&gt; works with a config file to connect to a TSB instance, similar to kubeconfig for connecting to a Kubernetes API server. The easiest way to get connected with &lt;code&gt;tctl&lt;/code&gt; is to download that config file from the TSB UI, following the instructions in the webpage. To get to those credentials, log in to the TSB UI in your browser, then in the top right corner click on your user name and under select &lt;code&gt;Actions&lt;/code&gt; &amp;gt; &lt;code&gt;Show token information&lt;/code&gt; &amp;gt; &lt;code&gt;Download tctl Config&lt;/code&gt;. This will download a file named &lt;code&gt;tctl-&amp;lt;your username&amp;gt;.config.yaml&lt;/code&gt;. You can then import this into &lt;code&gt;tctl&lt;/code&gt;, saving it permanently:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles import /path/to/tctl-&amp;lt;your username&amp;gt;.config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles set-current &amp;lt;your username&amp;gt;-tsb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:::note
&lt;code&gt;tctl&lt;/code&gt; stores configuration in your file system&amp;rsquo;s default configuration directory (&lt;a href=&#34;https://pkg.go.dev/os#UserConfigDir&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;as determined by Golang&lt;/a&gt;). This would be &lt;code&gt;$HOME/.config/tetrate/tctl/tctl_config&lt;/code&gt; on Linux, &lt;code&gt;$HOME/Library/Application\ Support/tetrate/tctl/tctl_config&lt;/code&gt; on Darwin, or &lt;code&gt;%AppData%/tetrate/tctl/tctl_config&lt;/code&gt; on Windows. This is where your password or tokens would persist. When you import a config file, &lt;code&gt;tctl&lt;/code&gt; adds the credentials from that file to the existing credentials in its configuration directory.
:::&lt;/p&gt;
&lt;h2 id=&#34;configure-tctl-manually&#34;&gt;Configure &lt;code&gt;tctl&lt;/code&gt; Manually&lt;/h2&gt;
&lt;p&gt;:::note TSB Organization Name
In the examples below, it is assumed that you have saved your organization name saved in the environment variable &lt;code&gt;$TCTL_LOGIN_ORG&lt;/code&gt;. If you just completed the demo installation, the demo organization name is &lt;code&gt;tetrate&lt;/code&gt;. You can execute the following to save the value in the environment variable: &lt;code&gt;export TCTL_LOGIN_ORG=tetrate&lt;/code&gt;.
:::&lt;/p&gt;
&lt;p&gt;To log in with &lt;code&gt;tctl&lt;/code&gt;, you must first configure a &lt;em&gt;cluster&lt;/em&gt; (&lt;code&gt;tctl config clusters&lt;/code&gt;), then a &lt;em&gt;user&lt;/em&gt; (&lt;code&gt;tctl config users&lt;/code&gt;), then combine the two into a &lt;em&gt;profile&lt;/em&gt;, which you  will be able to use to persist your settings, just like a kubeconfig profile (&lt;code&gt;tctl config profiles set-current ...&lt;/code&gt;). With that &lt;em&gt;profile&lt;/em&gt;, you can use the &lt;code&gt;tctl login&lt;/code&gt; command to configure the credentials and persist to disk any tokens we need to continue to connect to TSB.&lt;/p&gt;
&lt;h3 id=&#34;pick-a-name-for-your-profile&#34;&gt;Pick a name for your profile&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;tctl&lt;/code&gt; has a &lt;em&gt;default&lt;/em&gt; profile just like &lt;code&gt;kubectl&lt;/code&gt; which you can use for the commands below, or you can pick your own. For this how-to, create a profile named &lt;em&gt;&lt;code&gt;tsb-how-to&lt;/code&gt;&lt;/em&gt; (but any name works, including &lt;em&gt;default&lt;/em&gt;).&lt;/p&gt;
&lt;h3 id=&#34;configure-the-tctl-cluster&#34;&gt;Configure the &lt;code&gt;tctl&lt;/code&gt; Cluster&lt;/h3&gt;
&lt;p&gt;Both the UI and TSB&amp;rsquo;s APIs are exposed on the same address and port. To configure &lt;code&gt;tctl&lt;/code&gt;, you will need that address to get started.&lt;/p&gt;
&lt;h4 id=&#34;get-tsbs-address-1&#34;&gt;Get TSB&amp;rsquo;s Address&lt;/h4&gt;
&lt;p&gt;If your kubeconfig is pointed at the management plane cluster, you can get the address from the Kubernetes service:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_ADDRESS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get svc -n tsb envoy --output &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;:8443
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Many organizations will expose TSB&amp;rsquo;s UI (and therefore API) via DNS; you should use that instead of the raw IP address.&lt;/p&gt;
&lt;h4 id=&#34;create-a-tctl-cluster&#34;&gt;Create a &lt;code&gt;tctl&lt;/code&gt; Cluster&lt;/h4&gt;
&lt;p&gt;Once you have obtained the address (&lt;code&gt;$TSB_ADDRESS&lt;/code&gt;) you can create a &lt;em&gt;cluster&lt;/em&gt; in &lt;code&gt;tctl&lt;/code&gt;&amp;rsquo;s config. Name the cluster &lt;code&gt;tsb-how-to-cluster&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config clusters &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-cluster --bridge-address &lt;span class=&#34;nv&#34;&gt;$TSB_ADDRESS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:::note &lt;code&gt;tctl&lt;/code&gt; Object Names
You could use the same name for the cluster as for the profile itself (e.g. &lt;code&gt;tctl config clusters set tsb-how-to --bridge-address $TSB_ADDRESS&lt;/code&gt;). This example uses a different name to make it easier to follow along.
:::&lt;/p&gt;
&lt;h3 id=&#34;set-tctls-user&#34;&gt;Set &lt;code&gt;tctl&lt;/code&gt;&amp;rsquo;s User&lt;/h3&gt;
&lt;p&gt;First you need to know the username you are logging in with. This will depend on exactly how TSB is installed: if you&amp;rsquo;re using OIDC, this will be your corporate email; if you&amp;rsquo;re using LDAP it&amp;rsquo;ll be your usual LDAP login username; finally you can log in with TSB&amp;rsquo;s default administrative account, if it&amp;rsquo;s not disabled in your installation.&lt;/p&gt;
&lt;h4 id=&#34;login-for-oidc-users&#34;&gt;Login for OIDC Users&lt;/h4&gt;
&lt;p&gt;To log in to TSB with OIDC credentials, log in to the TSB UI in your browser, then in the top right corner click on your user name and under select &lt;code&gt;Actions&lt;/code&gt; &amp;gt; &lt;code&gt;Show token information&lt;/code&gt;. From that page, copy down the Bearer Token and Refresh Token, exporting them as &lt;code&gt;TSB_BEARER_TOKEN&lt;/code&gt; and &lt;code&gt;TSB_REFRESH_TOKEN&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_BEARER_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;HHVMW2.qhf9jBL1fMCazBe1umanDr5sNEuFcKtClAUxeWA...redacted
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TSB_REFRESH_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;AJWXL6VmGUmvYfn43601RG.Bw+xr0IVQ43swidqAt1tHf...redacted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --token &lt;span class=&#34;nv&#34;&gt;$TSB_BEARER_TOKEN&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --refresh-token &lt;span class=&#34;nv&#34;&gt;$TSB_REFRESH_TOKEN&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;login-for-ldap-username--password-users&#34;&gt;Login for LDAP (username + password) Users&lt;/h4&gt;
&lt;p&gt;For LDAP logins, you need a username and password; you can configure these and environment variables, or pass them in via the CLI:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_USERNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;demo-user@tetrate.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_PASSWORD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;your password&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --username &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_USERNAME&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --password &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_PASSWORD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:::warning Username + Password Logins Write Password to disk
When you configure a user with a username and password, that password is written to disk. To ensure that credential is not saved to disk, you need to &lt;code&gt;tctl login&lt;/code&gt; after setting up your cluster, user, and profile.
:::&lt;/p&gt;
&lt;h4 id=&#34;login-for-the-admin-user&#34;&gt;Login for the Admin User&lt;/h4&gt;
&lt;p&gt;You can log in as the default administrative user with the same username and password scheme as an LDAP account:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_USERNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;admin &lt;span class=&#34;c1&#34;&gt;# this is hard-coded&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TCTL_LOGIN_PASSWORD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;lt;your password&amp;gt; &lt;span class=&#34;c1&#34;&gt;# you created this during management plane install&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --org &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_ORG&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --username &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_USERNAME&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --password &lt;span class=&#34;nv&#34;&gt;$TCTL_LOGIN_PASSWORD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:::warning
It is recommend that you disable the admin user in all deployments of TSB. The primary use case for the admin user is for a platform owner to log in and configure their IdP so the rest of the organization can log in with OIDC or LDAP.&lt;/p&gt;
&lt;p&gt;Finally, because this is a username and password login, you need to &lt;code&gt;tctl login&lt;/code&gt; to exchange the password for a token for future access and to ensure the password is not saved to disk.
:::&lt;/p&gt;
&lt;h3 id=&#34;create-your-tctl-profile&#34;&gt;Create your &lt;code&gt;tctl&lt;/code&gt; Profile&lt;/h3&gt;
&lt;p&gt;A &lt;em&gt;profile&lt;/em&gt; ties a &lt;em&gt;cluster&lt;/em&gt; and a &lt;em&gt;user&lt;/em&gt; together so that they can be used to connect to a TSB instance. Connect the &lt;em&gt;cluster&lt;/em&gt; and &lt;em&gt;user&lt;/em&gt; you just created together into a &lt;em&gt;profile&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to --cluster tsb-how-to-cluster --username tsb-how-to-user
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;use-the-new-profile&#34;&gt;Use the new Profile&lt;/h3&gt;
&lt;p&gt;Configure &lt;code&gt;tctl&lt;/code&gt; to use the profile you just created to connect to TSB:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles set-current tsb-how-to
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;At this point, you&amp;rsquo;re good to go: &lt;code&gt;tctl&lt;/code&gt; has TSB&amp;rsquo;s location and your credentials - you can use it to interact with TSB!&lt;/p&gt;
&lt;h3 id=&#34;verify-the-config&#34;&gt;Verify the Config&lt;/h3&gt;
&lt;p&gt;As a sanity check, after finishing the following steps you can list your &lt;code&gt;tctl&lt;/code&gt; profiles, and you should see something like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config profiles list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CURRENT   NAME         CLUSTER             ACCOUNT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          default      default             default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*         tsb-how-to   tsb-how-to-cluster  tsb-how-to-user
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;using-tctl-to-find-your-tenant&#34;&gt;Using &lt;code&gt;tctl&lt;/code&gt; to find your Tenant&lt;/h3&gt;
&lt;p&gt;The final bit of setup you can do to make your life easier with &lt;code&gt;tctl&lt;/code&gt; is to fill in your &lt;code&gt;tenant&lt;/code&gt;, if you have not already done so.  Use &lt;code&gt;tctl&lt;/code&gt; to ask TSB which tenants exist. For most users, there will be exactly one result returned - which is the tenant you want to be using. For users with multiple tenants, you&amp;rsquo;ll need to talk with your platform team to determine which is the correct to use for you.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl get tenants
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME          DISPLAY NAME    DESCRIPTION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tetrate       Tetrate         Default tenant
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With your tenant in hand, you can save it to your user:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl config users &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; tsb-how-to-user --tenant &amp;lt;your tenant&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;log-in-with-tctl&#34;&gt;Log in with &lt;code&gt;tctl&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;When you log in with username and password, both are persisted to disk. This is not desirable, as your password is stored in plaintext. To remove the password from &lt;code&gt;tctl&lt;/code&gt;&amp;rsquo;s config file, you can use &lt;a href=&#34;../reference/cli/reference/login&#34;&gt;&lt;code&gt;tctl login&lt;/code&gt;&lt;/a&gt;, which will exchange your credentials for a set of OAuth tokens and write those to disk instead.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>资源消耗与容量规划</title>
      <link>https://lib.jimmysong.io/tsb/setup/resource-planning/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/resource-planning/</guid>
      <description>&lt;p&gt;本文描述了 Tetrate Service Bridge (TSB) 在管理平面和控制平面的容量规划的保守指南。&lt;/p&gt;
&lt;p&gt;这些参数适用于生产环境的安装：如果您使用类似演示的环境，TSB 将以最小的资源运行。&lt;/p&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;注意事项&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    &lt;p&gt;本文描述的资源配置指南非常保守。&lt;/p&gt;
&lt;p&gt;另请注意，本文描述的资源配置适用于 &lt;em&gt;垂直&lt;/em&gt; 资源扩展。相同 TSB 组件的多个副本不会共享负载，因此您不能期望多个组件的合并资源产生相同的效果。TSB 组件的副本应仅用于实现高可用性。&lt;/p&gt;

&lt;/div&gt;

&lt;h2 id=&#34;推荐的基线生产安装资源要求&#34;&gt;推荐的基线生产安装资源要求&lt;/h2&gt;
&lt;p&gt;对于一个具有 1 个注册集群和该集群内部部署的 1 个服务的 TSB 基线安装，建议如下资源。&lt;/p&gt;
&lt;p&gt;再次强调，下面描述的内存量非常保守。此外，vCPU 数量给出的实际性能会根据您的基础设施而波动。建议您在您的环境中验证结果。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;组件&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;vCPU 数量&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;内存 MiB&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;TSB 服务器 &lt;em&gt;(管理平面)&lt;/em&gt; &lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;512&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP 中央组件 &lt;sup&gt;2&lt;/sup&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;128&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Edge&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;128&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Front Envoy&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IAM&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;128&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB UI&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;256&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5192&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OTEL 收集器&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1024&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;sup&gt;1&lt;/sup&gt; 包括 Kubernetes  Operator 和持久数据协调过程。&lt;/p&gt;
&lt;p&gt;&lt;sup&gt;2&lt;/sup&gt; 包括 Kubernetes  Operator 。&lt;/p&gt;
&lt;h2 id=&#34;推荐的扩展资源参数&#34;&gt;推荐的扩展资源参数&lt;/h2&gt;
&lt;p&gt;TSB 栈主要受 CPU 限制。通过 XCP 注册的附加集群会使 CPU 利用率增加约 ~4%。&lt;/p&gt;
&lt;p&gt;对内存使用情况的附加注册集群或附加部署的工作负载服务的影响几乎可以忽略不计。同样，对于大多数 TSB 组件的资源消耗，额外集群或工作负载的影响几乎可以忽略不计，但 TSB、XCP 中央组件、TSB UI 和 IAM 则是值得注意的例外。&lt;/p&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;注意&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    作为能见度堆栈的一部分（例如 OTel/OAP 等），其资源利用取决于请求，因此资源扩展应遵循用户请求速率统计。一般而言，建议使用超过 1 个 vCPU。还要注意，可见度堆栈的性能主要受 Elasticsearch 性能限制。
&lt;/div&gt;

&lt;p&gt;因此，我们建议为部署的工作流程垂直扩展组件 1 个 vCPU：&lt;/p&gt;
&lt;h3 id=&#34;管理平面&#34;&gt;管理平面&lt;/h3&gt;
&lt;p&gt;除了 OAP 外，所有组件都不需要进行任何资源调整。 这些组件的架构和测试支持非常大的集群。&lt;/p&gt;
&lt;p&gt;在管理平面的 OAP 需要额外的 CPU 和内存，每 1000 个服务需要约 100 毫核的 CPU 和 1024 MiB 的内存。例如，从所有 TSB 集群中聚合的 4000 个服务将总共需要大约 400 毫核的 CPU 和 4096 MiB 的内存。&lt;/p&gt;
&lt;h2 id=&#34;控制平面资源要求&#34;&gt;控制平面资源要求&lt;/h2&gt;
&lt;p&gt;以下表格显示了 TSB 控制平面的典型峰值资源利用情况，假设如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;带有 Sidecar 的 50 个服务&lt;/li&gt;
&lt;li&gt;整个集群的流量为 500 个存储库&lt;/li&gt;
&lt;li&gt;OAP 的跟踪采样率为流量的 1%&lt;/li&gt;
&lt;li&gt;对于每个工作负载的每个请求都捕获度量值。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;请注意，平均 CPU 利用率将是典型峰值值的一部分。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;组件&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;典型峰值 CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;典型峰值内存 (Mi)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Istiod&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;300m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;250Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2500m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2500Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Edge&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio  Operator  - 控制平面&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio  Operator  - 数据平面&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;150m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB 控制平面 Operator&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB 数据平面 Operator&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;150m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OTEL 收集器&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;每个入口网关的-tsbistio--operator-资源使用情况&#34;&gt;每个入口网关的 TSB/Istio  Operator 资源使用情况&lt;/h2&gt;
&lt;p&gt;以下表格显示了每个入口网关使用的 TSB  Operator 和 Istio  Operator 的资源。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;入口网关&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;TSB  Operator  CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;TSB  Operator 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Istio  Operator  CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Istio  Operator 内存 (Mi)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;10m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;45Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;50&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2600m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;125Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1100m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;120Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3500m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;200Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1300m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;175Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;150&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3800m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;250Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1400m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;200Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;200&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4000m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;325Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1400m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;250Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;250&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4700m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;325Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1750m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;300Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;300&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5000m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;475Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1750m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;400Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;组件资源利用&#34;&gt;组件资源利用&lt;/h2&gt;
&lt;p&gt;以下表格将展示 TSB 的不同组件如何随着 4000 个服务的规模增长并以 60 rpm 峰值，这是根据来自管理平面和控制平面的信息进行划分的。&lt;/p&gt;
&lt;h3 id=&#34;管理平面-1&#34;&gt;管理平面&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;服务&lt;/th&gt;
&lt;th&gt;入口网关&lt;/th&gt;
&lt;th&gt;流量(rpm)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;中央 CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;中央内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;MPC CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;MPC 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OAP CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OAP 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Otel CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Otel 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;TSB CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;TSB 内存 (Mi)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;39Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;30Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;37m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;408Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;22m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;108Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;14m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;57Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;400&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;42Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;15m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;31Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;116m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;736Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;24m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;123Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;50m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;63Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;800&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;54Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;24m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;34Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;43m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;909Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;26m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;127Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;85m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;75Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1200&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;59Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;32m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;41Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;28m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1141Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;27m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;210Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;213m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;78Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1600&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;63Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;44m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;48Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;209m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1475Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;29m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;249Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;113m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;86Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2000&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;73Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;41m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;51Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;51m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1655Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;24m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;319Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;211m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;91Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2400&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;84Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;72m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;62Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;57m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1910Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;29m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;381Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;227m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;97Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2800&lt;/td&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;90Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;73m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;65Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;43m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2136Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;16m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;466Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;275m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;104Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3200&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;106Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;85m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;78Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;89m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2600Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;43m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;574Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;382m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;108Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3600&lt;/td&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;123Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;94m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;71Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;245m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2772Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;37m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;578Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;625m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;115Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4000&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;147Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;90m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;81Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;521m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3224Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;15m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;704Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;508m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;122Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;注意&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    IAM 将在 5m/32Mi，LDAP 在 1m/12Mi，XCP  Operator 在 3m 和 23Mi 时达到峰值。
&lt;/div&gt;

&lt;h3 id=&#34;控制平面&#34;&gt;控制平面&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;服务&lt;/th&gt;
&lt;th&gt;入口网关&lt;/th&gt;
&lt;th&gt;流量(rpm)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;边缘 CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;边缘内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Istiod CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Istiod 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OAP CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OAP 内存 (Mi)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Otel CPU (m)&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Otel 内存 (Mi)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;67Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;6m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;110Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;55m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;439Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;16m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;74Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;400&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;97Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;33m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;182Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;334m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1138Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;18m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;75Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;800&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;153Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;35m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;249Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;653m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1640Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;21m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;85Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1200&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;192Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;68m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;286Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;815m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2238Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;23m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;164Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1600&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;238Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;84m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;324Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1217m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2766Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;20m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;202Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2000&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;280Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;84m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;357Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1364m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3351Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;17m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;267Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2400&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;15m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;270Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;98m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;370Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1658m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3921Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;19m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;331Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2800&lt;/td&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;310Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;334m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;450Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2062m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4493Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;19m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;406Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3200&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;6m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;352Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;243m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;470Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2406m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4866Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;20m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;506Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3600&lt;/td&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;22m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;386Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;130m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;489Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2606m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5346Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;20m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;512Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4000&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;60 rpm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;501Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;138m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;523Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2904m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;6128Mi&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;20m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;620Mi&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;注意&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    Metric Server 将在 4m/24Mi，Onboarding Operator 在 4m/24Mi，XCP-Operator 在 3m/22Mi 时达到峰值。
&lt;/div&gt;

</description>
    </item>
    
    <item>
      <title>TSB 组件</title>
      <link>https://lib.jimmysong.io/tsb/setup/components/</link>
      <pubDate>Tue, 19 Sep 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/components/</guid>
      <description>&lt;p&gt;本页面将详细解释 TSB 组件和您必须提供和连接以运行 TSB 的外部依赖项。&lt;/p&gt;
&lt;p&gt;在继续之前，请确保您已经：&lt;/p&gt;
&lt;p&gt;查看了 &lt;a href=&#34;../../concepts/architecture&#34;&gt;TSB 架构&lt;/a&gt; 并理解了 &lt;a href=&#34;../../concepts/architecture#overall-architecture&#34;&gt;TSB 的四个层次&lt;/a&gt;：数据平面（Envoy 代理）、本地控制平面（Istio）、全局控制平面（XCP）和管理平面（TSB 本身）。&lt;/p&gt;
&lt;h2 id=&#34;管理平面&#34;&gt;管理平面&lt;/h2&gt;
&lt;p&gt;下图显示了管理平面（MP）组件：&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-tsb-管理平面组件&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;../../assets/setup/management-plane.png&#34; alt=&#34;TSB 管理平面组件&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      TSB 管理平面组件
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;front-envoy 端口&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    默认 Envoy 网关（或前置 Envoy）端口是 8443，可以由用户配置（例如更改为 443）。如果更改了默认端口，则通过前置 Envoy 进行通信的组件需要相应地进行调整以匹配用户定义的值。
&lt;/div&gt;

&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;front-envoy 作为 Elasticsearch 代理&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    TSB 的前置 Envoy 可以作为配置在 &lt;code&gt;ManagementPlane&lt;/code&gt; CR 中的 Elasticsearch 的代理。
要使用此功能，请在 &lt;code&gt;ControlPlane&lt;/code&gt; CR 中将 Elastic 主机和端口设置为 TSB 前置 Envoy 主机和端口。然后，来自控制平面 OAP 到 Elasticsearch 的流量将通过前置 Envoy 进行传递。
&lt;/div&gt;

&lt;p&gt;在管理平面中有两个运行的 Operator，用于管理 TSB 组件的生命周期：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Operator 名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;TSB 管理平面 Operator&lt;/td&gt;
&lt;td&gt;用于管理管理平面中 TSB 组件生命周期的 Operator。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Central Operator&lt;/td&gt;
&lt;td&gt;用于管理 XCP 中央的生命周期的 Operator。TSB 管理平面 Operator 部署 XCP  Operator 和该 Operator 的 CRD，将 XCP 中央的管理交给它们。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;以下是管理平面组件。有关更多参考，请查看 &lt;a href=&#34;../../refs/install/managementplane/v1alpha1/spec&#34;&gt;管理平面安装 API&lt;/a&gt;。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;组件名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Envoy Gateway（front-envoy）&lt;/td&gt;
&lt;td&gt;为 TSB API 和 UI 提供单一入口点。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IAM&lt;/td&gt;
&lt;td&gt;前置 Envoy 的外部授权。IAM 决定是否允许或拒绝对 TSB API 的传入请求。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TSB API Server&lt;/td&gt;
&lt;td&gt;TSB 的核心。存储将被发送到控制平面的配置。使用 NGAC 进行访问决策。将 PostgreSQL 用作后端存储。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Web UI&lt;/td&gt;
&lt;td&gt;提供 UI 组件。具有帮助连接到各种 TSB 组件（API 服务器、OAP）的 BFF（前端后端）。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MPC（MP Controller）&lt;/td&gt;
&lt;td&gt;在 TSB API 和 XCP 中央之间提供双向配置和集群状态同步。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Central&lt;/td&gt;
&lt;td&gt;协调多集群发现。将配置发送到所有连接的在集群中运行的 XCP Edge。接收来自 XCP 边缘的集群状态和配置状态更新。此组件由 XCP 中央 Operator 管理。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP（SkyWalking）&lt;/td&gt;
&lt;td&gt;用于 UI 查询以从所有集群的 OAP 获取聚合指标和跟踪。使用 Elasticsearch 作为后端存储。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OTEL Collector&lt;/td&gt;
&lt;td&gt;从管理平面中的不同组件中收集指标。从每个控制平面的 OpenTelemetry（OTEL）收集器接收指标。请注意，OTEL 收集器严格用于 TSB 组件监视，而不是您的应用程序。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;teamsync&lt;/td&gt;
&lt;td&gt;使用 LDAP 和 Azure AD 作为 IdP 时创建。从 IdP 检索用户和组并将其同步到 TSB 存储中。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cert-manager&lt;/td&gt;
&lt;td&gt;使用 &lt;code&gt;INTERNAL&lt;/code&gt; cert-manager 时创建。&lt;code&gt;cert-manager&lt;/code&gt; 为内部 TSB 组件提供证书，例如 Webhook 证书等的目的。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;控制平面&#34;&gt;控制平面&lt;/h2&gt;
&lt;p&gt;下图显示了控制平面（CP）组件以及数据平面（DP）。&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;../../assets/setup/control-plane.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;有四个 Operator 运行在控制平面中，用于管理 TSB 组件的生命周期：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Operator 名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;TSB Control Plane Operator&lt;/td&gt;
&lt;td&gt;用于管理控制平面中 TSB 控制平面组件生命周期的 Operator。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XCP Edge Operator&lt;/td&gt;
&lt;td&gt;用于管理 XCP 边缘的生命周期的 Operator。TSB 控制平面 Operator 部署 XCP  Operator 和该 Operator 的 CRD，将 XCP 边缘的管理交给它们。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio  Operator&lt;/td&gt;
&lt;td&gt;用于管理 Istio 控制平面的生命周期的 Operator。TSB 控制平面 Operator 部署 Istio  Operator 和该 Operator 的 CRD，将 Istio 组件的管理交给它们。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Onboarding  Operator&lt;/td&gt;
&lt;td&gt;用于管理所需组件的生命周期，以将 VM 工作负载（也称为网格扩展）纳入网格。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;修订的控制平面&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    TSB 1.5 引入了修订的控制平面。当您使用修订的控制平面时，由 XCP 边缘 Operator 部署 Istio  Operator，而不是 TSB 控制平面 Operator。要了解有关修订的控制平面的更多信息，请转到 &lt;a href=&#34;../../setup/isolation-boundaries&#34;&gt;Istio 隔离边界&lt;/a&gt;。
&lt;/div&gt;

&lt;p&gt;以下是控制平面组件。有关更多参考，请查看 &lt;a href=&#34;../../refs/install/controlplane/v1alpha1/spec&#34;&gt;控制平面安装 API&lt;/a&gt;。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;组件名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;XCP edge&lt;/td&gt;
&lt;td&gt;接收来自 XCP 中央的配置并将其转化为 Istio 配置。向 XCP 中央发送关于配置状态和集群清单的更新。由 XCP 边缘 Operator 管理。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istiod&lt;/td&gt;
&lt;td&gt;提供服务发现、将配置分发到 Envoy 代理以及工作负载证书管理的 Istio 组件。由 Istio  Operator 管理。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OAP（SkyWalking）&lt;/td&gt;
&lt;td&gt;接收来自集群中所有 Istio sidecar 和网关的访问日志和跟踪。处理这些访问日志并生成指标。指标和跟踪将被发送到 Elasticsearch。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OTEL Collector&lt;/td&gt;
&lt;td&gt;从控制平面中的不同 TSB 组件中收集指标。将指标导出到同一 pod 中的 Prometheus 导出器以及通过前置 Envoy 到管理平面的 OTEL 收集器。请注意，OTEL 收集器严格用于 TSB 组件监视，而不是您的应用程序。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SkyWalking HPA&lt;/td&gt;
&lt;td&gt;提供外部指标适配器，Kubernetes 水平 Pod 自动缩放（HPA）控制器可以从中检索指标。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;速率限制服务器&lt;/td&gt;
&lt;td&gt;提供内建的速率限制功能的可选组件。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;VM Gateway&lt;/td&gt;
&lt;td&gt;在启用网格扩展时部署。VM 网关提供与在 VM 中运行的 sidecar 的 Istiod 和 OAP 的连接。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Onboarding Plane&lt;/td&gt;
&lt;td&gt;在启用网格扩展时部署。VM 中的 Onboarding 代理将连接到此组件，以便将外部网格工作负载（例如在 VM 中运行的工作负载）纳入网格。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Onboarding Repository&lt;/td&gt;
&lt;td&gt;在启用网格扩展时部署。一个 HTTP 服务器，提供登记代理和 Istio Sidecar 的 DEB 和 RPM 包。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cert-manager&lt;/td&gt;
&lt;td&gt;使用 &lt;code&gt;INTERNAL&lt;/code&gt; cert-manager 时创建。&lt;code&gt;cert-manager&lt;/code&gt; 为内部 TSB 组件提供证书，例如 Webhook 证书等的目的。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;数据平面&#34;&gt;数据平面&lt;/h2&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;修订的控制平面&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    TSB 1.5 引入了修订的控制平面。当您使用修订的控制平面时，不再需要 Data Plane  Operator 来管理 Istio 网关。要了解有关修订的控制平面的更多信息，请转到 &lt;a href=&#34;../../setup/isolation-boundaries&#34;&gt;Istio 隔离边界&lt;/a&gt;。
&lt;/div&gt;

&lt;p&gt;在数据平面中有两个运行的 Operator，用于管理网关部署的生命周期：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Operator 名称&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;TSB Data Plane Operator&lt;/td&gt;
&lt;td&gt;用于管理 TSB 数据平面组件生命周期的 Operator。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Istio  Operator&lt;/td&gt;
&lt;td&gt;根据 &lt;a href=&#34;../../refs/install/dataplane/v1alpha1/spec&#34;&gt;数据平面安装 API&lt;/a&gt; 中指定的 Gateway CR 来管理 Istio 网关的生命周期的 Operator。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>Firewall Information</title>
      <link>https://lib.jimmysong.io/tsb/setup/firewall-information/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/firewall-information/</guid>
      <description>&lt;p&gt;If your environment has strict network policies that prevent any unauthorized
communication between two namespaces, you may need to add one or more exceptions
to your network policies to allow communication between the sidecars and the
local Istio Control Plane, as well as between the local Istio Control Plane and
the TSB management plane.&lt;/p&gt;
&lt;p&gt;The following information can be used to derive the appropriate set of firewall
rules.&lt;/p&gt;
&lt;h2 id=&#34;communication-between-tsb-control-plane-and-workloads&#34;&gt;Communication between TSB, Control Plane and Workloads&lt;/h2&gt;
&lt;h3 id=&#34;between-istio-and-tsb&#34;&gt;Between Istio and TSB&lt;/h3&gt;
&lt;p&gt;:::note TSB Load Balancer port
TSB Load Balancer (also known as &lt;code&gt;front-envoy&lt;/code&gt;) has default port 8443. This port value is user configurable.
For example, it can be changed to 443. If the default port is changed, then all components that communicate via &lt;code&gt;front-envoy&lt;/code&gt; need to be adjusted accordingly to match the user-defined value of the &lt;code&gt;front-envoy&lt;/code&gt; port.
:::&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Source&lt;/th&gt;
&lt;th&gt;Destination&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;xcp-edge.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;TSB Load Balancer IP, port &lt;code&gt;9443&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;oap.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;TSB Load Balancer IP, port &lt;code&gt;8443&lt;/code&gt; or user defined &lt;code&gt;front-envoy&lt;/code&gt; port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;otel-collector.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;TSB Load Balancer IP, port &lt;code&gt;8443&lt;/code&gt; or user defined &lt;code&gt;front-envoy&lt;/code&gt; port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;oap.istio-system&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Elasticsearch target IP and port &lt;br /&gt; &lt;em&gt;(If using demo deployment of Elasticsearch or using front-envoy as Elasticsearch proxy, change to TSB Load Balancer IP, port &lt;code&gt;8443&lt;/code&gt; or user defined &lt;code&gt;front-envoy&lt;/code&gt; port)&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;between-sidecars-on-k8s-and-istio-control-plane&#34;&gt;Between Sidecars on k8s and Istio Control Plane&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Source&lt;/th&gt;
&lt;th&gt;Destination&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Sidecars or load balancers in any application namespace or &lt;br /&gt; shared load balancer in any namespace to access Istio Pilot xDS server.&lt;/td&gt;
&lt;td&gt;&lt;code&gt;istiod.istio-system&lt;/code&gt;, port &lt;code&gt;15012&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Sidecars or load balancers in any application namespace or &lt;br /&gt; shared load balancer in any namespace to access SkyWalking OAP metrics server.&lt;/td&gt;
&lt;td&gt;&lt;code&gt;oap.istio-system&lt;/code&gt;, port &lt;code&gt;11800&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Sidecars or load balancers in any application namespace or &lt;br /&gt; shared load balancer in any namespace to access SkyWalking OAP trace server.&lt;/td&gt;
&lt;td&gt;&lt;code&gt;oap.istio-system&lt;/code&gt;, port &lt;code&gt;9411&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;between-sidecars-on-vms-and-istio-control-plane&#34;&gt;Between Sidecars on VMs and Istio Control Plane&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Source&lt;/th&gt;
&lt;th&gt;Destination&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Sidecars on VMs to access Istio Pilot xDS server,&lt;br /&gt; SkyWalking OAP metrics server, trace server&lt;/td&gt;
&lt;td&gt;VM Gateway (&lt;code&gt;vmgateway.istio-system&lt;/code&gt;) Load Balancer IP,&lt;br /&gt; port &lt;code&gt;15443&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;between-sidecars-on-vms-and-workloads-on-k8s&#34;&gt;Between Sidecars on VMs and workloads on k8s&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Source&lt;/th&gt;
&lt;th&gt;Destination&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Sidecars on VMs to access workloads on k8s&lt;/td&gt;
&lt;td&gt;Either k8s pods directly,&lt;br /&gt;Or VM Gateway (&lt;code&gt;vmgateway.istio-system&lt;/code&gt;) Load Balancer IP,&lt;br /&gt; port &lt;code&gt;15443&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;between-workloads-on-k8s-and-sidecars-on-vms&#34;&gt;Between workloads on k8s and Sidecars on VMs&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Source&lt;/th&gt;
&lt;th&gt;Destination&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;k8s pods to access workloads on VMs&lt;/td&gt;
&lt;td&gt;VM IP&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;between-workloads-in-cluster-a-and-workloads-in-cluster-b&#34;&gt;Between workloads in cluster A and workloads in cluster B&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Source&lt;/th&gt;
&lt;th&gt;Destination&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;k8s pods or VMs (cluster A)&lt;/td&gt;
&lt;td&gt;per-Service Gateway Load Balancer IP,&lt;br /&gt; port &lt;code&gt;15443&lt;/code&gt; (cluster B)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;k8s pods or VMs (cluster B)&lt;/td&gt;
&lt;td&gt;per-Service Gateway Load Balancer IP,&lt;br /&gt; port &lt;code&gt;15443&lt;/code&gt; (cluster A)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;:::danger Shared Load Balancers
If you are using a shared load balancer, then the load balancer envoy will need
to be able to talk to all attached applications and their services. Since this
information is not known in advance, we cannot provide definitive information on
the ports to open in a firewall.
:::&lt;/p&gt;
&lt;h2 id=&#34;tsb-components-ports&#34;&gt;TSB components ports&lt;/h2&gt;
&lt;p&gt;Following are ports and protocols used by TSB components.&lt;/p&gt;
&lt;h3 id=&#34;cert-manager&#34;&gt;Cert manager&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Port&lt;/th&gt;
&lt;th&gt;Protocol&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;10250&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;management-plane&#34;&gt;Management plane&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Port&lt;/th&gt;
&lt;th&gt;Protocol&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Management plane operator &lt;br /&gt;&lt;code&gt;tsb-operator-management-plane.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook container port, forwarded from 443&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;TSB API server &lt;code&gt;tsb.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8000&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;HTTP API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;42422&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Open Telemetry &lt;code&gt;otel-collector.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9090&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9091&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Collector endpoint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;13133&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;TSB front-envoy &lt;code&gt;envoy.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8443&lt;/td&gt;
&lt;td&gt;HTTP/GRPC&lt;/td&gt;
&lt;td&gt;TSB HTTP and GRPC API port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;TCP&lt;/td&gt;
&lt;td&gt;XCP port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;IAM &lt;code&gt;iamserver.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8000&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;HTTP API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;42422&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;MPC &lt;code&gt;mpc.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;42422&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;OAP &lt;code&gt;oap.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11800&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12800&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;REST API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1234&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9411&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Trace query&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9412&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Trace collect&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;TSB UI &lt;code&gt;web.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;HTTP service port and health check&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;XCP operator central &lt;br /&gt;&lt;code&gt;xcp-operator-central.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;XCP central &lt;code&gt;central.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8090&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Debug interface&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook container port, forwarded from 443&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;control-plane&#34;&gt;Control plane&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Port&lt;/th&gt;
&lt;th&gt;Protocol&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Control plane operator &lt;br /&gt;&lt;code&gt;tsb-operator-control-plane.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook container port, forwarded from 443&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Open Telemetry &lt;code&gt;otel-collector.tsb&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9090&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9091&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Collector endpoint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;13133&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;OAP &lt;code&gt;oap.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11800&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12800&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;REST API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1234&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15021&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Envoy sidecar health check&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15020&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Envoy sidecar Merged Prometheus telemetry from Istio agent, Envoy, and application&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9411&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Trace query&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9412&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Trace collect&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Istio operator &lt;br /&gt;&lt;code&gt;istio-operator.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Istiod &lt;code&gt;istiod.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Debug interface&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15010&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;XDS and CA services (Plaintext, only for secure networks)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15012&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;XDS and CA services (TLS and mTLS, recommended for production use)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15014&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Control plane monitoring&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15017&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook container port, forwarded from 443&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;XCP operator central &lt;br /&gt;&lt;code&gt;xcp-operator-edge.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;XCP central &lt;code&gt;edge.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8090&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Debug interface&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9080&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;GRPC API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook container port, forwarded from 443&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Onboarding operator &lt;br /&gt;&lt;code&gt;onboarding-operator.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook container port, forwarded from 443&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Onboarding repository &lt;br /&gt;&lt;code&gt;onboarding-repository.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;HTTP service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Onboarding plane &lt;br /&gt;&lt;code&gt;onboarding-plane.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8443&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Onboarding API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9082&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;VM Gateway &lt;code&gt;vmgateway.istio-system&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15021&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Health checks&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15012&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Istiod&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11800&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;OAP Metrics&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9411&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Tracing&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;mTLS traffic port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;HTTPS port&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;data-plane&#34;&gt;Data plane&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Port&lt;/th&gt;
&lt;th&gt;Protocol&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Data plane operator &lt;br /&gt;&lt;code&gt;tsb-operator-data-plane.istio-gateway&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook container port, forwarded from 443&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Istio operator &lt;br /&gt;&lt;code&gt;istio-operator.istio-gateway&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8383&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Prometheus telemetry&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Istiod &lt;code&gt;istiod.istio-gateway&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhooks service port&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8080&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Debug interface&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15010&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;XDS and CA services (Plaintext, only for secure networks)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15012&lt;/td&gt;
&lt;td&gt;GRPC&lt;/td&gt;
&lt;td&gt;XDS and CA services (TLS and mTLS, recommended for production use)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15014&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;Control plane monitoring&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15017&lt;/td&gt;
&lt;td&gt;HTTPS&lt;/td&gt;
&lt;td&gt;Webhook container port, forwarded from 443&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;sidecars&#34;&gt;Sidecars&lt;/h3&gt;
&lt;p&gt;Refer to &lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/#ports-used-by-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ports used by Istio&lt;/a&gt; for list of ports and protocols used by Istio sidecar proxy (Envoy).&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio 隔离边界</title>
      <link>https://lib.jimmysong.io/tsb/setup/isolation-boundaries/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/isolation-boundaries/</guid>
      <description>&lt;p&gt;Istio 隔离边界可以在 Kubernetes 集群内或跨多个集群中运行多个由 TSB（Tetrate Service Bridge）管理的 Istio 环境。这些 Istio 环境在服务发现和配置分发方面彼此隔离。隔离边界带来了以下几个好处：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;强大的网络隔离默认提供了在高度受管制的环境中严格且易于演示的安全性。&lt;/li&gt;
&lt;li&gt;在集群内运行不同的 Istio 版本允许你在同一集群中支持传统和现代应用程序。&lt;/li&gt;
&lt;li&gt;金丝雀发布提供了在测试和部署 TSB 升级时的灵活性。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;安装&#34;&gt;安装&lt;/h2&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;升级&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    要从非修订的控制平面升级到修订的控制平面，请按照 &lt;a href=&#34;../../upgrades/non-revisioned-to-revisioned&#34;&gt;非修订到修订的升级&lt;/a&gt; 中提到的步骤进行操作。
&lt;/div&gt;

&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;OpenShift&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    如果你使用 OpenShift，请将以下 &lt;code&gt;kubectl&lt;/code&gt; 命令替换为 &lt;code&gt;oc&lt;/code&gt;。
&lt;/div&gt;

&lt;p&gt;对于全新安装，你可以按照使用 &lt;a href=&#34;../../setup/self-managed/onboarding-clusters&#34;&gt;tctl&lt;/a&gt; 或 &lt;a href=&#34;../../setup/helm/controlplane&#34;&gt;helm&lt;/a&gt; 来加入控制平面集群的标准步骤，以及以下更改进行操作：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;通过将 &lt;code&gt;ISTIO_ISOLATION_BOUNDARIES&lt;/code&gt; 设置为 &lt;code&gt;true&lt;/code&gt; 在 TSB 控制平面 Operator 中启用隔离边界。&lt;/li&gt;
&lt;li&gt;在 &lt;code&gt;ControlPlane&lt;/code&gt; CR 或控制平面 Helm 值中添加隔离边界定义。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在以下示例中，你将使用 Helm 启用隔离边界来加入一个集群。&lt;/p&gt;
&lt;h3 id=&#34;使用-helm-安装&#34;&gt;使用 Helm 安装&lt;/h3&gt;
&lt;p&gt;按照 &lt;a href=&#34;../../setup/helm/controlplane#installation&#34;&gt;使用 Helm 安装控制平面&lt;/a&gt; 中的说明，使用以下 Helm 值来启用 Istio 隔离边界。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ISTIO_ISOLATION_BOUNDARIES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;managementPlane&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;cluster-name-in-tsb&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-address&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-port&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;telemetryStore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;elastic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-address&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;tsb-port&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;elastic-version&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selfSigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;is-elastic-use-self-signed-certificate&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterServiceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterFQN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;organizations/jupiter/clusters/&amp;lt;cluster-name-in-tsb&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;JWK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;$JWK&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;安装步骤完成后，请查看 &lt;code&gt;istio-system&lt;/code&gt; 命名空间中的 &lt;code&gt;deployments&lt;/code&gt;、&lt;code&gt;configmaps&lt;/code&gt; 和 &lt;code&gt;webhooks&lt;/code&gt;。所有属于修订的 Istio 控制平面的资源都将在名称中具有 &lt;code&gt;revisions.name&lt;/code&gt; 作为后缀。这些资源将存在于配置在 &lt;code&gt;isolationBoundaries&lt;/code&gt; 下的每个修订中。&lt;/p&gt;
&lt;p&gt;控制平面 Operator 会验证跨隔离边界的修订名称是否唯一。此修订名称值将用于配置修订的命名空间并启动修订的数据平面网关。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get deployment -n istio-system &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep stable
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
istio-operator-dev-stable             1/1     1            1           2d1h
istio-operator-qa-stable              1/1     1            1           45h
istiod-dev-stable                     1/1     1            1           2d1h
istiod-qa-stable                      1/1     1            1           45h
&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get configmap -n istio-system &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep stable
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
istio-dev-stable                      2      2d1h
istio-qa-stable                       2      45h
istio-sidecar-injector-dev-stable     2      2d1h
istio-sidecar-injector-qa-stable      2      45h
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;使用-tctl-安装&#34;&gt;使用 tctl 安装&lt;/h3&gt;
&lt;p&gt;如果你更喜欢使用 &lt;a href=&#34;../self-managed/onboarding-clusters&#34;&gt;tctl 安装&lt;/a&gt;，你可以使用以下命令生成启用 Istio 隔离边界的集群 Operator。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl install manifest cluster-operators &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --registry &amp;lt;registry-location&amp;gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --set &lt;span class=&#34;s2&#34;&gt;&amp;#34;operator.deployment.env[0].name=ISTIO_ISOLATION_BOUNDARIES&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --set &lt;span class=&#34;s2&#34;&gt;&amp;#34;operator.deployment.env[0].value=true&amp;#34;&lt;/span&gt; &amp;gt; clusteroperators.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后，在你的 &lt;code&gt;ControlPlane&lt;/code&gt; CR 或 Helm 值中使用以下方式更新 &lt;code&gt;xcp&lt;/code&gt; 组件与 &lt;code&gt;isolationBoundaries&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;无论你选择哪种安装方式，使用隔离边界的示例都是相同的。&lt;/p&gt;
&lt;h3 id=&#34;在修订中指定-tsb-版本&#34;&gt;在修订中指定 TSB 版本&lt;/h3&gt;
&lt;p&gt;Istio 隔离边界还提供了一种控制用于部署控制平面组件和数据平面代理的 Istio 版本的方式。可以在隔离边界配置中指定如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsbVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.6.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsbVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.6.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;使用这些配置，会部署两个修订的控制平面，使用相应的 TSB 发布的 Istio 镜像。
在单个隔离边界中具有多个修订有助于从一个 &lt;code&gt;tsbVersion&lt;/code&gt; 升级到另一个 &lt;code&gt;tsbVersion&lt;/code&gt; 中的特定隔离边界的工作负载。有关更多详细信息，请参阅 &lt;a href=&#34;../../upgrades/revisioned-to-revisioned&#34;&gt;修订到修订的升级&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;如果将 &lt;code&gt;tsbVersion&lt;/code&gt; 字段留空，则 &lt;code&gt;ControlPlane&lt;/code&gt; 资源将默认为当前 TSB 发布的版本。&lt;/p&gt;
&lt;h2 id=&#34;使用隔离边界和修订&#34;&gt;使用隔离边界和修订&lt;/h2&gt;
&lt;h3 id=&#34;应用部署&#34;&gt;应用部署&lt;/h3&gt;
&lt;p&gt;现在可以在具有修订标签的适当命名空间中部署工作负载。修订标签 &lt;code&gt;istio.io/rev&lt;/code&gt; 确定了代理用于连接服务发现和 xDS 更新的修订控制平面。确保如下配置工作负载命名空间：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这些命名空间中的应用程序 Pod 将被注入 Istio 代理配置，使它们能够连接到相应的修订 Istio 控制平面。&lt;/p&gt;
&lt;h3 id=&#34;vm-工作负载入网&#34;&gt;VM 工作负载入网&lt;/h3&gt;
&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;单一隔离边界&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    &lt;a href=&#34;../../workload-onboarding/guides&#34;&gt;工作负载入网&lt;/a&gt; 仅支持单一隔离边界。多个隔离边界的支持将在后续版本中提供。
&lt;/div&gt;

&lt;p&gt;默认情况下，工作负载入网将使用非修订的 Istio 控制平面。要使用修订的控制平面，你需要使用 &lt;a href=&#34;../../workload-onboarding/guides/setup#installing-istio-sidecar-for-revisioned-istio&#34;&gt;修订链接&lt;/a&gt; 从 TSB 工作负载入网存储库下载 Istio Sidecar。&lt;/p&gt;
&lt;p&gt;你还需要在 VM 的 &lt;code&gt;/etc/onboarding-agent/agent.config.yaml&lt;/code&gt; 中更新 &lt;a href=&#34;../../refs/onboarding/config/agent/v1alpha1/agent-configuration&#34;&gt;代理配置&lt;/a&gt; 以添加修订值。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;config.agent.onboarding.tetrate.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AgentConfiguration&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revision&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后重新启动入网代理。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl restart onboarding-agent
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果你使用 cloud-init 来配置 VM，请在 cloud-init 文件中添加上述 &lt;code&gt;AgentConfiguration&lt;/code&gt;。由于文件 &lt;code&gt;/etc/onboarding-agent/agent.config.yaml&lt;/code&gt; 可能提前创建，因此对于基于 Debian 的操作系统，需要在非交互式安装时安装入网代理时传递 &lt;code&gt;-o Dpkg::Options::=&amp;quot;--force-confold&amp;quot;&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install -y -o Dpkg::Options::&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--force-confold&amp;#34;&lt;/span&gt; ./onboarding-agent.deb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;工作区配置&#34;&gt;工作区配置&lt;/h3&gt;
&lt;p&gt;可以通过指定隔离边界名称来配置每个工作区，如下所示：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Workspace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tetrate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tetrate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-ws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/qa-bookinfo&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Workspace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tetrate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tetrate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-ws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/dev-bookinfo&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;设置&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    &lt;p&gt;在 Brownfiled 设置中，现有的工作区将不会配置为任何特定的隔离边界。在这种情况下，如果启用并配置了 Istio 隔离边界，则工作区将视为属于一个名为 &amp;ldquo;global&amp;rdquo; 的隔离边界。如果未在 &lt;code&gt;ControlPlane&lt;/code&gt; CR 中配置此 &amp;ldquo;global&amp;rdquo; 隔离边界，则工作区将不属于任何隔离边界。因此，建议为未在其规范中指定任何隔离边界的工作区创建一个名为 &amp;ldquo;global&amp;rdquo; 的备用隔离边界。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;global&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3 id=&#34;网关部署&#34;&gt;网关部署&lt;/h3&gt;
&lt;p&gt;对于每个网关（入口/出口/Tier1）资源，必须设置属于所需隔离边界的 &lt;code&gt;revision&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;例如，在你的入口网关部署中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.tetrate.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IngressGateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tsb-gateway-dev-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revision&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable        &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 修订值&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;应用后，这将导致 &lt;strong&gt;修订的&lt;/strong&gt; 网关部署。&lt;/p&gt;
&lt;h3 id=&#34;istio-隔离&#34;&gt;Istio 隔离&lt;/h3&gt;
&lt;p&gt;在单个/多个集群中设置多个隔离边界允许用户运行在服务发现方面分隔的多个网格环境。这意味着一个隔离边界中的服务仅对相同隔离边界中的客户端可发现，从而允许流量流向相同隔离边界中的服务。通过隔离边界分离的服务将无法发现彼此，从而导致不跨边界流量。&lt;/p&gt;
&lt;p&gt;作为一个简单的示例，考虑以下隔离边界配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;xcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;isolationBoundaries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-testing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;revisions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这对应于三个单独的命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt;、&lt;code&gt;dev-bookinfo-testing&lt;/code&gt; 和 &lt;code&gt;qa-bookinfo&lt;/code&gt;，适当附加修订标签。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-testing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-bookinfo-testing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dev-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio.io/rev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;qa-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;请注意，命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 和 &lt;code&gt;dev-bookinfo-testing&lt;/code&gt; 属于同一个隔离边界 &lt;code&gt;dev&lt;/code&gt;，而命名空间 &lt;code&gt;qa-bookinfo&lt;/code&gt; 属于隔离边界 &lt;code&gt;qa&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;该配置将对集群产生以下影响：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 中的服务将被命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 和 &lt;code&gt;dev-bookinfo-testing&lt;/code&gt; 中运行的代理发现。这是因为命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 和 &lt;code&gt;dev-bookinfo-testing&lt;/code&gt; 都属于同一个隔离边界。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 中的服务将不会被命名空间 &lt;code&gt;qa-bookinfo&lt;/code&gt; 中运行的代理发现。这是因为命名空间 &lt;code&gt;dev-bookinfo&lt;/code&gt; 和 &lt;code&gt;qa-bookinfo&lt;/code&gt; 属于不同的隔离边界。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;以及其他命名空间的情况类似。&lt;/p&gt;
&lt;h3 id=&#34;严格隔离&#34;&gt;严格隔离&lt;/h3&gt;
&lt;p&gt;如果一个来自一个隔离边界的服务尝试与另一个隔离边界的服务通信，则 &amp;ldquo;客户端&amp;rdquo; 端代理将处理出站流量以确定是否流向网格外部。默认情况下，允许此流量，但可以通过在 &lt;code&gt;IstioOperator&lt;/code&gt; 资源 mesh 配置中使用 &lt;code&gt;outboundTrafficPolicy&lt;/code&gt; 来限制它。
默认情况下，这个 &lt;code&gt;outboundTrafficPolicy&lt;/code&gt; 的值设置为&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;outboundTrafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ALLOW_ANY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;为了限制跨隔离边界流量，你可以将 &lt;code&gt;.outboundTrafficPolicy.mode&lt;/code&gt; 设置为 &lt;code&gt;REGISTRY_ONLY&lt;/code&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首先列出 &lt;code&gt;istio-system&lt;/code&gt; 命名空间中的 &lt;code&gt;IstioOperator&lt;/code&gt; 资源。&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get iop -n istio-system | grep xcp-iop
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
xcp-iop-dev-stable               stable   HEALTHY     25h
xcp-iop-dev-testing              stable   HEALTHY     25h
xcp-iop-qa-stable                stable   HEALTHY     25h
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;选择要设置策略配置的 &lt;code&gt;IstioOperator&lt;/code&gt; 资源名称。我们将使用上面的 TSB 控制平面 Helm 值进行修订，以及以下用于 &lt;code&gt;istio&lt;/code&gt; 组件的覆盖：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kubeSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;overlays&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xcp-iop-dev-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.meshConfig.outboundTrafficPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;REGISTRY_ONLY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;可以通过附加的方式以类似的方式为其他 &lt;code&gt;IstioOperator&lt;/code&gt; 执行此操作。&lt;/p&gt;
&lt;h2 id=&#34;故障排除&#34;&gt;故障排除&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;查找位于 &lt;code&gt;istio-system&lt;/code&gt; 命名空间中与 TSB &lt;code&gt;IngressGateway&lt;/code&gt;、&lt;code&gt;EgressGateway&lt;/code&gt;、&lt;code&gt;Tier1Gateway&lt;/code&gt; 资源相对应的 &lt;code&gt;ingressdeployment&lt;/code&gt;、&lt;code&gt;egressdeployment&lt;/code&gt;、&lt;code&gt;tier1deployment&lt;/code&gt; 资源。&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get ingressdeployment -n istio-system
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
NAME                       AGE
tsb-gateway-dev-bookinfo   3h10min
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果缺少这些资源，则 TSB 控制平面运算符未协调 TSB 网关资源到相应的 XCP 资源。首先，重新验证 TSB 控制平面运算符和网关资源之间的修订匹配。接下来，Operator 日志应该提供一些线索。&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;查找位于 &lt;code&gt;istio-system&lt;/code&gt; 命名空间中的相应 &lt;code&gt;IstioOperator&lt;/code&gt; 资源。例如：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get iop -n istio-system | grep dev-stable
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
xcp-iop-dev-stable               dev-stable   HEALTHY     25h
xcpgw-tsb-dev-gateway-bookinfo   dev-stable   HEALTHY     3h14min
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果缺少这些资源，则 &lt;code&gt;xcp-operator-edge&lt;/code&gt; 日志应该提供一些线索。&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;
&lt;p&gt;如果上述两点都没问题，网关部署/服务仍然没有部署或部署配置与 &lt;code&gt;IstioOperator&lt;/code&gt; 资源中配置的不符，则 Istio 运算符部署日志应该提供一些线索。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;要调试 Istio 代理的服务发现以及服务之间的流量，以下 &lt;code&gt;istioctl&lt;/code&gt; 命令非常有用：&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;istioctl pc endpoints -n &amp;lt;namespace&amp;gt; deploy/&amp;lt;deployment-name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
ENDPOINT                                                STATUS      OUTLIER CHECK     CLUSTER
10.20.0.36:8090                                         HEALTHY     OK                outbound|80||echo.echo.svc.cluster.local
10.255.20.128:15443                                     HEALTHY     OK                outbound|80||echo.tetrate.io
...
127.0.0.1:15000                                         HEALTHY     OK                prometheus_stats
127.0.0.1:15020                                         HEALTHY     OK                agent
unix://./etc/istio/proxy/XDS                            HEALTHY     OK                xds-grpc
unix://./var/run/secrets/workload-spiffe-uds/socket     HEALTHY     OK                sds-grpc
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;和&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;istioctl pc routes -n &amp;lt;namespace&amp;gt; deploy/&amp;lt;deployment-name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 输出
NAME                                                        DOMAINS                                                         MATCH                  VIRTUAL SERVICE
80                                                          echo, echo.echo + 1 more...

                                   *                       dev/echo.echo
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;你可以根据特定的部署和命名空间替换 &lt;code&gt;&amp;lt;namespace&amp;gt;&lt;/code&gt; 和 &lt;code&gt;&amp;lt;deployment-name&amp;gt;&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;这将显示特定部署的终结点和路由，以及它们的状态。你可以查看与特定服务和端点之间的流量匹配的路由规则。这些命令可帮助你排除服务发现问题或配置问题。&lt;/p&gt;
&lt;h3 id=&#34;注意事项&#34;&gt;注意事项&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;隔离边界的最大数量由 TSB 控制平面配置决定。有关详细信息，请参阅控制平面配置。&lt;/li&gt;
&lt;li&gt;修订的控制平面的可用性与非修订的控制平面一样，通过删除对应的 TSB 控制平面资源来禁用。&lt;/li&gt;
&lt;li&gt;默认情况下，每个 Istio 控制平面版本都使用相同的内部 CA。将 Istio 控制平面升级到新版本时，可能会创建新的 CA。如果你有运行中的 mTLS 流量，请确保进行测试以验证在 CA 更改后是否仍然能够正常工作。有关详细信息，请参阅修订到修订的升级。&lt;/li&gt;
&lt;li&gt;如果你想跨隔离边界运行 mTLS 流量，则需要确保 TSB 控制平面支持跨隔离边界的 mTLS 流量。这需要将跨边界服务的根证书添加到 TSB 控制平面的根证书存储库中。有关详细信息，请参阅部署资源的数据平面和 &lt;a href=&#34;../../setup/self-managed/deploy-certs&#34;&gt;部署证书&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;如果你要在生产环境中使用 Istio 隔离边界，请在生产环境之前仔细测试你的配置。Istio 隔离边界是一个强大的功能，但也复杂，需要精心设计和配置以满足你的需求。&lt;/li&gt;
&lt;li&gt;如果你使用的是 Istio 1.9.0 版本或更高版本，请注意 Istio 资源中的一些字段名称可能发生了变化。请查看 Istio 的官方文档，以了解与你使用的 Istio 版本相关的详细信息。&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Repository secrets</title>
      <link>https://lib.jimmysong.io/tsb/setup/remote-registry/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/remote-registry/</guid>
      <description>&lt;p&gt;Starting with version 1.5, TSB provides an automated way to obtain images from a remote private Docker container repository by defining &lt;code&gt;imagePullSecrets&lt;/code&gt; in &lt;a href=&#34;../refs/install/managementplane/v1alpha1/spec#tetrateio-api-install-managementplane-v1alpha1-managementplanespec&#34;&gt;ManagementPlane&lt;/a&gt; and &lt;a href=&#34;../refs/install/controlplane/v1alpha1/spec#tetrateio-api-install-controlplane-v1alpha1-controlplanespec&#34;&gt;ControlPlane&lt;/a&gt; CRs.
If &lt;code&gt;imagePullSecrets&lt;/code&gt; is defined, the required ServiceAccounts will be patched with the credentials from the secret, allowing for secure access to the containers that are stored in the remote private repository. The following steps outline the configuration process:&lt;/p&gt;
&lt;h2 id=&#34;synchronizing-images&#34;&gt;Synchronizing images&lt;/h2&gt;
&lt;p&gt;TSB images are located in Tetrate&amp;rsquo;s repository and only available for copying to your repository (no direct download to any environment is allowed). The first step is to transfer the images to your repository. To synchronize the images, you need to use &lt;code&gt;tctl install image-sync&lt;/code&gt; per the &lt;a href=&#34;../setup/requirements-and-download#sync-tetrate-service-bridge-images&#34;&gt;documentation&lt;/a&gt; (a license key provided by Tetrate is required).&lt;/p&gt;
&lt;h2 id=&#34;obtain-json-key-for-the-private-repository&#34;&gt;Obtain JSON key for the private repository&lt;/h2&gt;
&lt;p&gt;The secret that is specified as &lt;code&gt;imagePullSecrets&lt;/code&gt; will store credentials that allow kubernetes to pull the required containers from the private repository. The way to obtain the credentials depends on the repository. Please refer to the following links to get some guidance on major cloud providers - &lt;a href=&#34;https://medium.com/clarusway/how-to-use-images-from-a-private-container-registry-for-kubernetes-aws-ecr-hosted-private-13a759e2c4ea&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS&lt;/a&gt;, &lt;a href=&#34;https://blog.container-solutions.com/using-google-container-registry-with-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP&lt;/a&gt; and &lt;a href=&#34;https://learn.microsoft.com/en-us/azure/container-registry/container-registry-auth-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Azure&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;create-secrets-in-every-namespace-used-by-tsb&#34;&gt;Create secrets in every namespace used by TSB&lt;/h2&gt;
&lt;p&gt;As stated in the &lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/secret/#details&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes documentation&lt;/a&gt;, secrets can only be accessed by pods within the same namespace they are created in. Therefore, a separate secret must be created for each namespace used by TSB. Note that the available namespaces may vary depending on the Kubernetes platform.&lt;/p&gt;
&lt;p&gt;Currently, the following namespaces require a separate secret:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;For the TSB Management Plane cluster &lt;code&gt;tsb&lt;/code&gt; and &lt;code&gt;cert-manager&lt;/code&gt; (if using the internal TSB packaged cert-manager)&lt;/li&gt;
&lt;li&gt;For the TSB Control Plane cluster &lt;code&gt;istio-system&lt;/code&gt;, &lt;code&gt;istio-gateway&lt;/code&gt;, &lt;code&gt;cert-manager&lt;/code&gt; (if using the internal TSB packaged cert-manager)  and &lt;code&gt;kube-system&lt;/code&gt; (if using Istio CNI)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;:::note Additional namespaces
The list provided above is not exhaustive. Additional namespaces may be used for TSB components on different platforms and therefore will require a separate secret to be created. To check if there are any pods experiencing issues obtaining the container image, use the command &lt;code&gt;kubectl get pods -A | grep ImagePullBackOff&lt;/code&gt;.
:::&lt;/p&gt;
&lt;h2 id=&#34;application-namespaces&#34;&gt;Application namespaces&lt;/h2&gt;
&lt;p&gt;To make sure that istio enabled application, can download images. The repository credentials secret is required to be present in every application namespace with istio-sidecar enabled pods and ingress gateways.&lt;/p&gt;
&lt;h2 id=&#34;install-tsb&#34;&gt;Install TSB&lt;/h2&gt;
&lt;p&gt;To install TSB, use your preferred method, but ensure that the ManagementPlane and ControlPlane CRs have &lt;code&gt;imagePullSecrets&lt;/code&gt; configured as follows:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullSecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;secret name created in previous step&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;patch-operator-serviceaccounts&#34;&gt;Patch operator ServiceAccounts&lt;/h2&gt;
&lt;p&gt;Images of TSB Operators require credentials before the operators are able to propagate the &lt;code&gt;imagePullSecrets&lt;/code&gt; to the rest of components.&lt;/p&gt;
&lt;p&gt;The steps are the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Patch the ServiceAccounts for TSB operator in &lt;code&gt;istio-system&lt;/code&gt; and &lt;code&gt;istio-gateway&lt;/code&gt; namespaces:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl patch serviceaccount tsb-operator-control-plane -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;imagePullSecrets&amp;#34;: [{&amp;#34;name&amp;#34;: &amp;#34;&amp;lt;secret name created per steps above&amp;gt;&amp;#34;}]}&amp;#39;&lt;/span&gt; -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl patch serviceaccount tsb-operator-data-plane -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;imagePullSecrets&amp;#34;: [{&amp;#34;name&amp;#34;: &amp;#34;&amp;lt;secret name created per steps above&amp;gt;&amp;#34;}]}&amp;#39;&lt;/span&gt; -n istio-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Restart the operators in these namespaces:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete pod -n istio-system -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tsb-operator 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete pod -n istio-gateway -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tsb-operator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete pod -n istio-gateway -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istio-operator
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;:::note Helm chart installation
Steps to create secrets and define the &lt;code&gt;imagePullSecrets&lt;/code&gt; can be automated using &lt;a href=&#34;./helm&#34;&gt;Helm installation&lt;/a&gt;
:::
:::note Sequence of steps
It&amp;rsquo;s very important that the Kubernetes secret for the private repository is created before installing TSB. Following this proper sequence will allow for efficient deployment and will minimize any downtime.
:::&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Migration from tctl to Helm</title>
      <link>https://lib.jimmysong.io/tsb/setup/migrate-tctl-to-helm/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/setup/migrate-tctl-to-helm/</guid>
      <description>&lt;p&gt;This document will cover how to migrate a live installation of TSB using tctl and migrate to helm. The document assumes that &lt;a href=&#34;https://helm.sh/docs/intro/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm is already installed&lt;/a&gt; in the system.&lt;/p&gt;
&lt;p&gt;Before you get started, make sure you:&lt;br /&gt;
✓ Familiarize yourself with &lt;a href=&#34;../concepts/toc&#34;&gt;TSB concepts&lt;/a&gt; &lt;br /&gt;
✓ Install the TSB environment. You can use &lt;a href=&#34;self_managed/demo-installation&#34;&gt;TSB demo&lt;/a&gt; for quick install&lt;br /&gt;
✓ Completed &lt;a href=&#34;../quickstart&#34;&gt;TSB usage quickstart&lt;/a&gt;.&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&#34;preparation-of-the-helm-charts&#34;&gt;Preparation of the helm charts&lt;/h2&gt;
&lt;p&gt;Before hand you must be familiar with Helm. Follow the &lt;a href=&#34;helm/helm&#34;&gt;prerequisites&lt;/a&gt; in our guide with installing TSB with Helm.&lt;/p&gt;
&lt;h2 id=&#34;migrate-management-plane&#34;&gt;Migrate Management Plane&lt;/h2&gt;
&lt;p&gt;Migrating the current installation requires only labeling and annotating the resources of the plane installation. All other components will be upgraded and managed by the tsb-operator.
Here is list of commands to annotate every resource that will be managed by Helm.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl -n tsb label deployment tsb-operator-management-plane &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n tsb annotate deployment tsb-operator-management-plane &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl -n tsb annotate service tsb-operator-management-plane &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl -n tsb annotate sa tsb-operator-management-plane &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl -n tsb label secret elastic-credentials &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n tsb annotate secret elastic-credentials &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl -n tsb label secret es-certs &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n tsb annotate secret es-certs &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl -n tsb label secret ldap-credentials &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n tsb annotate secret ldap-credentials &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl -n tsb label secret postgres-credentials &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n tsb annotate secret postgres-credentials &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl -n tsb label secret admin-credentials &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n tsb annotate secret admin-credentials &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl annotate clusterrole tsb-operator-management-plane-tsb &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl annotate clusterrolebinding tsb-operator-management-plane-tsb &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;

kubectl -n tsb label managementplane managementplane &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n tsb annotate managementplane managementplane &amp;#34;meta.helm.sh/release-name=mp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=tsb&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;:::note Attention
release-name and release-namespace should match the release name and namespace used in the helm install command.
:::&lt;/p&gt;
&lt;p&gt;After all the resources are labeled correctly then proceed with the installation of the release:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;###Example
helm upgrade mp tetrate-tsb-helm/managementplane --install --namespace tsb -f upgrade-mpt1/helm/values-mp.yaml --set image.registry=${HUB} --set image.tag=${TSB_VERSION} --set spec.hub=${HUB} 

###Output:
Release &amp;#34;mp&amp;#34; does not exist. Installing it now.


NAME: mp
LAST DEPLOYED: Thu May 25 11:03:18 2023
NAMESPACE: tsb
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
Thank you for installing the TSB Management plane 1.5.11.
Chart: managementplane
Version: 1.5.11

Your Management Plane is ready to be used.
Next step might be to onboard the cluster from the control plane.
You could choose between:
 - install `controlplane` chart
 - manually following # TODO url to docs.

# Discover the TSB entrypoint

Check the IP for the envoy loadbalancer service.

This is one example. Consider a time for the service to be ready:
kubectl get svc -n &amp;#34;tsb&amp;#34; envoy --output jsonpath=&amp;#39;{.status.loadBalancer.ingress[0].ip}&amp;#39;

# Configure the TCTL admin profile, using the IP in the previous step.

# Setup the TSB address as follows. If specific settings are needed to trust the certificate configured in TSB,
# refer to the `tctl config clusters set --help` command to see all the available options.
tctl config clusters set helm --bridge-address &amp;lt;IP&amp;gt;:8443

tctl config users set helm --username admin --password &amp;#34;NotAPassword&amp;#34; --org &amp;#34;tetrate&amp;#34;
tctl config profiles set helm --cluster helm --username helm
tctl config profiles set-current helm 
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;migrate-control-plane&#34;&gt;Migrate Control Plane&lt;/h2&gt;
&lt;p&gt;The procedure is the same, only a few resources and secrets are changed&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl -n istio-system label deployment tsb-operator-control-plane &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n istio-system annotate deployment tsb-operator-control-plane &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;

kubectl -n istio-system annotate service tsb-operator-control-plane &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;

kubectl -n istio-system annotate sa tsb-operator-control-plane &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;

kubectl -n istio-system label secret elastic-credentials &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n istio-system annotate secret elastic-credentials &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;

kubectl -n istio-system label secret cluster-service-account &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n istio-system annotate secret cluster-service-account &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;

kubectl -n istio-system label secret mp-certs &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n istio-system annotate secret mp-certs &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;

kubectl -n istio-system label secret xcp-central-ca-bundle &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n istio-system annotate secret xcp-central-ca-bundle &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;

kubectl annotate clusterrole tsb-operator-control-plane-istio-system &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;

kubectl annotate clusterrolebinding tsb-operator-control-plane-istio-system &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;

kubectl -n istio-system label controlplane  controlplane &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n istio-system annotate controlplane controlplane &amp;#34;meta.helm.sh/release-name=cp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-system&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Verify and check that release-name and release-namespace points to the one in the release installation:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;###Example
helm upgrade cp tetrate-tsb-helm/controlplane --install --namespace istio-system -f upgrade-mpt1/helm/values-cp.yaml  --set image.registry=${HUB} --set image.tag=${TSB_VERSION} --set spec.hub=${HUB} --set spec.managementPlane.host=${TSB_HOST} --set-file secrets.clusterServiceAccount.JWK=/tmp/upgrade-mpt1.jwk

###Output
Release &amp;#34;cp&amp;#34; does not exist. Installing it now.
NAME: cp
LAST DEPLOYED: Thu May 25 11:21:18 2023
NAMESPACE: istio-system
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
Thank you for installing the TSB Control Plane 1.5.11.
Chart: controlplane
Version: 1.5.11
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;migrate-data-plane&#34;&gt;Migrate Data Plane&lt;/h2&gt;
&lt;p&gt;This is the last plane, and have fewer resources to annotate:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl -n istio-gateway label deployment tsb-operator-data-plane &amp;#34;app.kubernetes.io/managed-by=Helm&amp;#34;
kubectl -n istio-gateway annotate deployment tsb-operator-data-plane &amp;#34;meta.helm.sh/release-name=dp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;

kubectl -n istio-gateway annotate service tsb-operator-data-plane &amp;#34;meta.helm.sh/release-name=dp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;

kubectl -n istio-gateway annotate sa tsb-operator-data-plane &amp;#34;meta.helm.sh/release-name=dp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;

kubectl annotate clusterrole tsb-operator-data-plane-istio-gateway &amp;#34;meta.helm.sh/release-name=dp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;

kubectl annotate clusterrolebinding tsb-operator-data-plane-istio-gateway &amp;#34;meta.helm.sh/release-name=dp&amp;#34; &amp;#34;meta.helm.sh/release-namespace=istio-gateway&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Proceed to install the release:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;###Example
helm upgrade dp tetrate-tsb-helm/dataplane --install --namespace istio-gateway --create-namespace --set image.registry=${HUB} --set image.tag=${TSB_VERSION}

###Output
Release &amp;#34;dp&amp;#34; does not exist. Installing it now.

NAME: dp
LAST DEPLOYED: Thu May 25 11:29:11 2023
NAMESPACE: istio-gateway
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
Thank you for installing the TSB Data Plane 1.5.11.
Chart: dataplane
Version: 1.5.11
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
  </channel>
</rss>
